/**
 * Jax
 * Root namespace containing all Jax data
 **/
var Jax={PRODUCTION:1,VERSION:"2.0.12",webgl_not_supported_path:null,getGlobal:function(){var e;return typeof global!="undefined"?e=global:e=window,Jax.getGlobal=function(){return e},Jax.getGlobal()},reraise:function(e,t){throw e._stack?t._stack=e._stack:e.stack&&(t._stack=e.stack),t},click_speed:.2};Jax.environment=Jax.PRODUCTION,Jax.default_shader="basic",typeof window=="undefined"&&(Jax.getGlobal().window=Jax.getGlobal()),Jax.Compatibility=function(){var e=1,t=1;return{offsetTop:e,offsetLeft:t}}(),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)t.push(n);return t}),Array.prototype.clear=Array.prototype.clear||function(){return this.splice(0,this.length),this},typeof KeyEvent=="undefined"&&(KeyEvent={fake:!0,DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}),function(){var rsplit=function(e,t){var n=t.exec(e),r=new Array,i,s,o;while(n!=null)i=n.index,s=t.lastIndex,i!=0&&(o=e.substring(0,i),r.push(e.substring(0,i)),e=e.slice(i)),r.push(n[0]),e=e.slice(n[0].length),n=t.exec(e);return!e==""&&r.push(e),r},chop=function(e){return e.substr(0,e.length-1)},extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};EJS=function(e){e=typeof e=="string"?{view:e}:e,this.set_options(e);if(e.precompiled){this.template={},this.template.process=e.precompiled,EJS.update(this.name,this);return}if(e.element){if(typeof e.element=="string"){var t=e.element;e.element=document.getElementById(e.element);if(e.element==null)throw t+"does not exist!"}e.element.value?this.text=e.element.value:this.text=e.element.innerHTML,this.name=e.element.id,this.type="["}else if(e.url){e.url=EJS.endExt(e.url,this.extMatch),this.name=this.name?this.name:e.url;var n=e.url,r=EJS.get(this.name,this.cache);if(r)return r;if(r==EJS.INVALID_PATH)return null;try{this.text=EJS.request(n+(this.cache?"":"?"+Math.random()))}catch(i){}if(this.text==null)throw{type:"EJS",message:"There is no template at "+n}}var r=new EJS.Compiler(this.text,this.type);r.compile(e,this.name),EJS.update(this.name,this),this.template=r},EJS.prototype={render:function(e,t){e=e||{},this._extra_helpers=t;var n=new EJS.Helpers(e,t||{});return this.template.process.call(e,e,n)},update:function(element,options){typeof element=="string"&&(element=document.getElementById(element));if(options==null)return _template=this,function(e){EJS.prototype.update.call(_template,element,e)};typeof options=="string"?(params={},params.url=options,_template=this,params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)},EJS.ajax_request(params)):element.innerHTML=this.render(options)},out:function(){return this.template.out},set_options:function(e){this.type=e.type||EJS.type,this.cache=e.cache!=null?e.cache:EJS.cache,this.text=e.text||null,this.name=e.name||null,this.ext=e.ext||EJS.ext,this.extMatch=new RegExp(this.ext.replace(/\./,"."))}},EJS.endExt=function(e,t){return e?(t.lastIndex=0,e+(t.test(e)?"":this.ext)):null},EJS.Scanner=function(e,t,n){extend(this,{left_delimiter:t+"%",right_delimiter:"%"+n,double_left:t+"%%",double_right:"%%"+n,left_equal:t+"%=",left_comment:t+"%#"}),this.SplitRegexp=t=="["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)"),this.source=e,this.stag=null,this.lines=0},EJS.Scanner.to_text=function(e){return e==null||e===undefined?"":e instanceof Date?e.toDateString():e.toString?e.toString():""},EJS.Scanner.prototype={scan:function(e){scanline=this.scanline,regex=this.SplitRegexp;if(!this.source==""){var t=rsplit(this.source,/\n/);for(var n=0;n<t.length;n++){var r=t[n];this.scanline(r,regex,e)}}},scanline:function(e,t,n){this.lines++;var r=rsplit(e,t);for(var i=0;i<r.length;i++){var s=r[i];if(s!=null)try{n(s,this)}catch(o){throw{type:"EJS.Scanner",line:this.lines}}}}},EJS.Buffer=function(e,t){this.line=new Array,this.script="",this.pre_cmd=e,this.post_cmd=t;for(var n=0;n<this.pre_cmd.length;n++)this.push(e[n])},EJS.Buffer.prototype={push:function(e){this.line.push(e)},cr:function(){this.script=this.script+this.line.join("; "),this.line=new Array,this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var e=0;e<this.post_cmd.length;e++)this.push(pre_cmd[e]);this.script=this.script+this.line.join("; "),line=null}}},EJS.Compiler=function(e,t){this.pre_cmd=["var ___ViewO = [];"],this.post_cmd=new Array,this.source=" ",e!=null&&(typeof e=="string"?(e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),this.source=e):e.innerHTML&&(this.source=e.innerHTML),typeof this.source!="string"&&(this.source="")),t=t||"<";var n=">";switch(t){case"[":n="]";break;case"<":break;default:throw t+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,t,n),this.out=""},EJS.Compiler.prototype={compile:function(options,name){options=options||{},this.out="";var put_cmd="___ViewO.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(this.pre_cmd,this.post_cmd),content="",clean=function(e){return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/"/g,'\\"'),e};this.scanner.scan(function(e,t){if(t.stag==null)switch(e){case"\n":content+="\n",buff.push(put_cmd+'"'+clean(content)+'");'),buff.cr(),content="";break;case t.left_delimiter:case t.left_equal:case t.left_comment:t.stag=e,content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),content="";break;case t.double_left:content+=t.left_delimiter;break;default:content+=e}else switch(e){case t.right_delimiter:switch(t.stag){case t.left_delimiter:content[content.length-1]=="\n"?(content=chop(content),buff.push(content),buff.cr()):buff.push(content);break;case t.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))")}t.stag=null,content="";break;case t.double_right:content+=t.right_delimiter;break;default:content+=e}}),content.length>0&&buff.push(put_cmd+'"'+clean(content)+'")'),buff.close(),this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";try{eval(to_be_evaled)}catch(e){if(typeof JSLINT=="undefined")throw e;JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if(error.reason!="Unnecessary semicolon."){error.line++;var e=new Error;throw e.lineNumber=error.line,e.message=error.reason,options.view&&(e.fileName=options.view),e}}}}},EJS.config=function(e){EJS.cache=e.cache!=null?e.cache:EJS.cache,EJS.type=e.type!=null?e.type:EJS.type,EJS.ext=e.ext!=null?e.ext:EJS.ext;var t=EJS.templates_directory||{};EJS.templates_directory=t,EJS.get=function(e,n){return n==0?null:t[e]?t[e]:null},EJS.update=function(e,n){if(e==null)return;t[e]=n},EJS.INVALID_PATH=-1},EJS.config({cache:!0,type:"<",ext:".ejs"}),EJS.Helpers=function(e,t){this._data=e,this._extras=t,extend(this,t)},EJS.Helpers.prototype={view:function(e,t,n){return n||(n=this._extras),t||(t=this._data),(new EJS(e)).render(t,n)},to_text:function(e,t){return e==null||e===undefined?t||"":e instanceof Date?e.toDateString():e.toString?e.toString().replace(/\n/g,"<br />").replace(/''/g,"'"):""}},EJS.newRequest=function(){var e=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var t=0;t<e.length;t++)try{var n=e[t]();if(n!=null)return n}catch(r){continue}},EJS.request=function(e){var t=new EJS.newRequest;t.open("GET",e,!1);try{t.send(null)}catch(n){return null}return t.status==404||t.status==2||t.status==0&&t.responseText==""?null:t.responseText},EJS.ajax_request=function(e){e.method=e.method?e.method:"GET";var t=new EJS.newRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200?e.onComplete(t):e.onComplete(t))},t.open(e.method,e.url),t.send(null)}}(),"use strict",function(){var e=typeof exports!="undefined"?global:window;e.glMatrixArrayType=e.MatrixArray=null,e.vec3={},e.mat3={},e.mat4={},e.quat4={},e.setMatrixArrayType=function(e){return glMatrixArrayType=MatrixArray=e},e.determineMatrixArrayType=function(){return setMatrixArrayType(typeof Float32Array!="undefined"?Float32Array:Array)},determineMatrixArrayType()}(),vec3.create=function(e){var t=new MatrixArray(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},vec3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},vec3.add=function(e,t,n){return!n||e===n?(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e):(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n)},vec3.subtract=function(e,t,n){return!n||e===n?(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e):(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n)},vec3.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},vec3.scale=function(e,t,n){return!n||e===n?(e[0]*=t,e[1]*=t,e[2]*=t,e):(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n)},vec3.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=Math.sqrt(n*n+r*r+i*i);return s?s===1?(t[0]=n,t[1]=r,t[2]=i,t):(s=1/s,t[0]=n*s,t[1]=r*s,t[2]=i*s,t):(t[0]=0,t[1]=0,t[2]=0,t)},vec3.cross=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2];return n[0]=i*a-s*u,n[1]=s*o-r*a,n[2]=r*u-i*o,n},vec3.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},vec3.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],o=Math.sqrt(r*r+i*i+s*s);return o?(o=1/o,n[0]=r*o,n[1]=i*o,n[2]=s*o,n):(n[0]=0,n[1]=0,n[2]=0,n)},vec3.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r},vec3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},mat3.create=function(e){var t=new MatrixArray(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]),t},mat3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mat3.identity=function(e){return e||(e=mat3.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},mat3.toMat4=function(e,t){return t||(t=mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},mat3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},mat4.create=function(e){var t=new MatrixArray(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},mat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mat4.identity=function(e){return e||(e=mat4.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},mat4.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15];return p*l*u*i-f*d*u*i-p*o*c*i+s*d*c*i+f*o*v*i-s*l*v*i-p*l*r*a+f*d*r*a+p*n*c*a-t*d*c*a-f*n*v*a+t*l*v*a+p*o*r*h-s*d*r*h-p*n*u*h+t*d*u*h+s*n*v*h-t*o*v*h-f*o*r*m+s*l*r*m+f*n*u*m-t*l*u*m-s*n*c*m+t*o*c*m},mat4.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T,M;return O?(M=1/O,t[0]=(u*A-a*L+f*k)*M,t[1]=(-r*A+i*L-s*k)*M,t[2]=(v*x-m*S+g*E)*M,t[3]=(-c*x+h*S-p*E)*M,t[4]=(-o*A+a*C-f*N)*M,t[5]=(n*A-i*C+s*N)*M,t[6]=(-d*x+m*w-g*b)*M,t[7]=(l*x-h*w+p*b)*M,t[8]=(o*L-u*C+f*T)*M,t[9]=(-n*L+r*C-s*T)*M,t[10]=(d*S-v*w+g*y)*M,t[11]=(-l*S+c*w-p*y)*M,t[12]=(-o*k+u*N-a*T)*M,t[13]=(n*k-r*N+i*T)*M,t[14]=(-d*E+v*b-m*y)*M,t[15]=(l*E-c*b+h*y)*M,t):null},mat4.toRotationMat=function(e,t){return t||(t=mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.toMat3=function(e,t){return t||(t=mat3.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mat4.toInverseMat3=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],u=e[6],a=e[8],f=e[9],l=e[10],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p,v;return d?(v=1/d,t||(t=mat3.create()),t[0]=c*v,t[1]=(-l*r+i*f)*v,t[2]=(u*r-i*o)*v,t[3]=h*v,t[4]=(l*n-i*a)*v,t[5]=(-u*n+i*s)*v,t[6]=p*v,t[7]=(-f*n+r*a)*v,t[8]=(o*n-r*s)*v,t):null},mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=t[0],w=t[1],E=t[2],S=t[3],x=t[4],T=t[5],N=t[6],C=t[7],k=t[8],L=t[9],A=t[10],O=t[11],M=t[12],_=t[13],D=t[14],P=t[15];return n[0]=b*r+w*u+E*c+S*v,n[1]=b*i+w*a+E*h+S*m,n[2]=b*s+w*f+E*p+S*g,n[3]=b*o+w*l+E*d+S*y,n[4]=x*r+T*u+N*c+C*v,n[5]=x*i+T*a+N*h+C*m,n[6]=x*s+T*f+N*p+C*g,n[7]=x*o+T*l+N*d+C*y,n[8]=k*r+L*u+A*c+O*v,n[9]=k*i+L*a+A*h+O*m,n[10]=k*s+L*f+A*p+O*g,n[11]=k*o+L*l+A*d+O*y,n[12]=M*r+_*u+D*c+P*v,n[13]=M*i+_*a+D*h+P*m,n[14]=M*s+_*f+D*p+P*g,n[15]=M*o+_*l+D*d+P*y,n},mat4.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12],n[1]=e[1]*r+e[5]*i+e[9]*s+e[13],n[2]=e[2]*r+e[6]*i+e[10]*s+e[14],n},mat4.multiplyVec4=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=t[3];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12]*o,n[1]=e[1]*r+e[5]*i+e[9]*s+e[13]*o,n[2]=e[2]*r+e[6]*i+e[10]*s+e[14]*o,n[3]=e[3]*r+e[7]*i+e[11]*s+e[15]*o,n},mat4.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o,u,a,f,l,c,h,p,d,v,m,g;return!n||e===n?(e[12]=e[0]*r+e[4]*i+e[8]*s+e[12],e[13]=e[1]*r+e[5]*i+e[9]*s+e[13],e[14]=e[2]*r+e[6]*i+e[10]*s+e[14],e[15]=e[3]*r+e[7]*i+e[11]*s+e[15],e):(o=e[0],u=e[1],a=e[2],f=e[3],l=e[4],c=e[5],h=e[6],p=e[7],d=e[8],v=e[9],m=e[10],g=e[11],n[0]=o,n[1]=u,n[2]=a,n[3]=f,n[4]=l,n[5]=c,n[6]=h,n[7]=p,n[8]=d,n[9]=v,n[10]=m,n[11]=g,n[12]=o*r+l*i+d*s+e[12],n[13]=u*r+c*i+v*s+e[13],n[14]=a*r+h*i+m*s+e[14],n[15]=f*r+p*i+g*s+e[15],n)},mat4.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2];return!n||e===n?(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=s,e[9]*=s,e[10]*=s,e[11]*=s,e):(n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n)},mat4.rotate=function(e,t,n,r){var i=n[0],s=n[1],o=n[2],u=Math.sqrt(i*i+s*s+o*o),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;return u?(u!==1&&(u=1/u,i*=u,s*=u,o*=u),a=Math.sin(t),f=Math.cos(t),l=1-f,c=e[0],h=e[1],p=e[2],d=e[3],v=e[4],m=e[5],g=e[6],y=e[7],b=e[8],w=e[9],E=e[10],S=e[11],x=i*i*l+f,T=s*i*l+o*a,N=o*i*l-s*a,C=i*s*l-o*a,k=s*s*l+f,L=o*s*l+i*a,A=i*o*l+s*a,O=s*o*l-i*a,M=o*o*l+f,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=c*x+v*T+b*N,r[1]=h*x+m*T+w*N,r[2]=p*x+g*T+E*N,r[3]=d*x+y*T+S*N,r[4]=c*C+v*k+b*L,r[5]=h*C+m*k+w*L,r[6]=p*C+g*k+E*L,r[7]=d*C+y*k+S*L,r[8]=c*A+v*O+b*M,r[9]=h*A+m*O+w*M,r[10]=p*A+g*O+E*M,r[11]=d*A+y*O+S*M,r):null},mat4.rotateX=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[4]=s*i+f*r,n[5]=o*i+l*r,n[6]=u*i+c*r,n[7]=a*i+h*r,n[8]=s*-r+f*i,n[9]=o*-r+l*i,n[10]=u*-r+c*i,n[11]=a*-r+h*i,n},mat4.rotateY=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[8],l=e[9],c=e[10],h=e[11];return n?e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*-r,n[1]=o*i+l*-r,n[2]=u*i+c*-r,n[3]=a*i+h*-r,n[8]=s*r+f*i,n[9]=o*r+l*i,n[10]=u*r+c*i,n[11]=a*r+h*i,n},mat4.rotateZ=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7];return n?e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*i+f*r,n[1]=o*i+l*r,n[2]=u*i+c*r,n[3]=a*i+h*r,n[4]=s*-r+f*i,n[5]=o*-r+l*i,n[6]=u*-r+c*i,n[7]=a*-r+h*i,n},mat4.frustum=function(e,t,n,r,i,s,o){o||(o=mat4.create());var u=t-e,a=r-n,f=s-i;return o[0]=i*2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i*2/a,o[6]=0,o[7]=0,o[8]=(t+e)/u,o[9]=(r+n)/a,o[10]=-(s+i)/f,o[11]=-1,o[12]=0,o[13]=0,o[14]=-(s*i*2)/f,o[15]=0,o},mat4.perspective=function(e,t,n,r,i){var s=n*Math.tan(e*Math.PI/360),o=s*t;return mat4.frustum(-o,o,-s,s,n,r,i)},mat4.ortho=function(e,t,n,r,i,s,o){o||(o=mat4.create());var u=t-e,a=r-n,f=s-i;return o[0]=2/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/a,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/f,o[11]=0,o[12]=-(e+t)/u,o[13]=-(r+n)/a,o[14]=-(s+i)/f,o[15]=1,o},mat4.lookAt=function(e,t,n,r){r||(r=mat4.create());var i,s,o,u,a,f,l,c,h,p,d=e[0],v=e[1],m=e[2],g=n[0],y=n[1],b=n[2],w=t[0],E=t[1],S=t[2];return d===w&&v===E&&m===S?mat4.identity(r):(l=d-t[0],c=v-t[1],h=m-t[2],p=1/Math.sqrt(l*l+c*c+h*h),l*=p,c*=p,h*=p,i=y*h-b*c,s=b*l-g*h,o=g*c-y*l,p=Math.sqrt(i*i+s*s+o*o),p?(p=1/p,i*=p,s*=p,o*=p):(i=0,s=0,o=0),u=c*o-h*s,a=h*i-l*o,f=l*s-c*i,p=Math.sqrt(u*u+a*a+f*f),p?(p=1/p,u*=p,a*=p,f*=p):(u=0,a=0,f=0),r[0]=i,r[1]=u,r[2]=l,r[3]=0,r[4]=s,r[5]=a,r[6]=c,r[7]=0,r[8]=o,r[9]=f,r[10]=h,r[11]=0,r[12]=-(i*d+s*v+o*m),r[13]=-(u*d+a*v+f*m),r[14]=-(l*d+c*v+h*m),r[15]=1,r)},mat4.fromRotationTranslation=function(e,t,n){n||(n=mat4.create());var r=e[0],i=e[1],s=e[2],o=e[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return n[0]=1-(p+v),n[1]=c+y,n[2]=h-g,n[3]=0,n[4]=c-y,n[5]=1-(l+v),n[6]=d+m,n[7]=0,n[8]=h+g,n[9]=d-m,n[10]=1-(l+p),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},mat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},quat4.create=function(e){var t=new MatrixArray(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},quat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},quat4.calculateW=function(e,t){var n=e[0],r=e[1],i=e[2];return!t||e===t?(e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e):(t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t)},quat4.inverse=function(e,t){return!t||e===t?(e[0]*=-1,e[1]*=-1,e[2]*=-1,e):(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t)},quat4.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},quat4.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],o=Math.sqrt(n*n+r*r+i*i+s*s);return o===0?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(o=1/o,t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t)},quat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=t[0],a=t[1],f=t[2],l=t[3];return n[0]=r*l+o*u+i*f-s*a,n[1]=i*l+o*a+s*u-r*f,n[2]=s*l+o*f+r*a-i*u,n[3]=o*l-r*u-i*a-s*f,n},quat4.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],s=t[2],o=e[0],u=e[1],a=e[2],f=e[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return n[0]=l*f+p*-o+c*-a-h*-u,n[1]=c*f+p*-u+h*-o-l*-a,n[2]=h*f+p*-a+l*-u-c*-o,n},quat4.toMat3=function(e,t){t||(t=mat3.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[1]=l+g,t[2]=c-m,t[3]=l-g,t[4]=1-(f+d),t[5]=p+v,t[6]=c+m,t[7]=p-v,t[8]=1-(f+h),t},quat4.toMat4=function(e,t){t||(t=mat4.create());var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[1]=l+g,t[2]=c-m,t[3]=0,t[4]=l-g,t[5]=1-(f+d),t[6]=p+v,t[7]=0,t[8]=c+m,t[9]=p-v,t[10]=1-(f+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},quat4.slerp=function(e,t,n,r){r||(r=e);var i=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],s,o,u,a;return Math.abs(i)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(s=Math.acos(i),o=Math.sqrt(1-i*i),Math.abs(o)<.001?(r[0]=e[0]*.5+t[0]*.5,r[1]=e[1]*.5+t[1]*.5,r[2]=e[2]*.5+t[2]*.5,r[3]=e[3]*.5+t[3]*.5,r):(u=Math.sin((1-n)*s)/o,a=Math.sin(n*s)/o,r[0]=e[0]*u+t[0]*a,r[1]=e[1]*u+t[1]*a,r[2]=e[2]*u+t[2]*a,r[3]=e[3]*u+t[3]*a,r))},quat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},mat3.multiplyVec3=function(e,t,n){return n||(n=t),n[0]=t[0]*e[0]+t[1]*e[3]+t[2]*e[6],n[1]=t[0]*e[1]+t[1]*e[4]+t[2]*e[7],n[2]=t[0]*e[2]+t[1]*e[5]+t[2]*e[8],n},mat4.IDENTITY=mat4.identity(mat4.create()),quat4.fromAxes=function(e,t,n,r){var i=quat4.fromAxes.mat=quat4.fromAxes.mat||mat3.create();i[0]=t[0],i[3]=t[1],i[6]=t[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=e[0],i[5]=e[1],i[8]=e[2],quat4.fromRotationMatrix(i,r)},quat4.fromRotationMatrix=function(e,t){t||(t=quat4.create());var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[7]-e[5])*r,t[1]=(e[2]-e[6])*r,t[2]=(e[3]-e[1])*r;else{var i=quat4.fromRotationMatrix.s_iNext=quat4.fromRotationMatrix.s_iNext||[1,2,0],s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var o=i[s],u=i[o];r=Math.sqrt(e[s*3+s]-e[o*3+o]-e[u*3+u]+1),t[s]=.5*r,r=.5/r,t[3]=(e[u*3+o]-e[o*3+u])*r,t[o]=(e[o*3+s]+e[s*3+o])*r,t[u]=(e[u*3+s]+e[s*3+u])*r}return t},quat4.toAngleAxis=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(n>0){t[3]=2*Math.acos(e[3]);var r=Math.invsrt(n);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},quat4.fromAngleAxis=function(e,t,n){n||(n=quat4.create());var r=e*.5,i=Math.sin(r);return n[3]=Math.cos(r),n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n},quat4.IDENTITY=quat4.create([0,0,0,1]);if(typeof vec2=="undefined")var vec2={};vec2.create=function(e){var t=new glMatrixArrayType(2);return e&&(t[0]=e[0],t[1]=e[1]),t},vec3.toQuatRotation=function(e,t,n){var r=vec3.dot(e,t);if(r>=1)return quat4.IDENTITY;if(r<1e-6-1){var i=vec3.cross(vec3.UNIT_X,e,vec3.create());return vec3.length(i)<Math.EPSILON&&(i=vec3.cross(vec3.UNIT_Y,e,i)),vec3.normalize(i),quat4.fromAngleAxis(Math.PI,i,n)}var s=Math.sqrt((1+r)*2),o=1/s,u=vec3.cross(e,t,vec3.create());return n||(n=quat4.create()),n[0]=u[0]*o,n[1]=u[1]*o,n[2]=u[2]*o,n[3]=s*.5,quat4.normalize(n)},vec3.distance=function(e,t){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],s=n*n+r*r+i*i;return s>0?Math.sqrt(s):0},vec3.multiply=function(e,t,n){return n||(n=e),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n},vec3.UNIT_X=vec3.create([1,0,0]),vec3.UNIT_Y=vec3.create([0,1,0]),vec3.UNIT_Z=vec3.create([0,0,1]);if(typeof vec4=="undefined")var vec4={};vec4.create=function(e){var t=new glMatrixArrayType(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t},Jax.$A=function(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();var t=e.length||0,n=new Array(t);while(t--)n[t]=e[t];return n},Object.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"},Object.isUndefined=function(e){return typeof e=="undefined"},Object.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},Object.extend=function(e,t){for(var n in t)e[n]=t[n];return e},Object.extend(Function.prototype,function(){function t(e,t){var n=e.length,r=t.length;while(r--)e[n+r]=t[r];return e}function n(n,r){return n=e.call(n,0),t(n,r)}function r(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e}function i(t){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var r=this,i=e.call(arguments,1);return function(){var e=n(i,arguments);return r.apply(t,e)}}function s(n){var r=this,i=e.call(arguments,1);return function(e){var s=t([e||window.event],i);return r.apply(n,s)}}function o(){if(!arguments.length)return this;var t=this,r=e.call(arguments,0);return function(){var e=n(r,arguments);return t.apply(this,e)}}function u(t){var n=this,r=e.call(arguments,1);return t*=1e3,window.setTimeout(function(){return n.apply(n,r)},t)}function a(){var e=t([.01],arguments);return this.delay.apply(this,e)}function f(e){var n=this;return function(){var r=t([n.bind(this)],arguments);return e.apply(this,r)}}function l(){if(this._methodized)return this._methodized;var e=this;return this._methodized=function(){var n=t([this],arguments);return e.apply(null,n)}}var e=Array.prototype.slice;return{argumentNames:r,bind:i,bindAsEventListener:s,curry:o,delay:u,defer:a,wrap:f,methodize:l}}()),Jax.Class=function(){function n(){}function r(){function i(){this.initialize.apply(this,arguments)}var t=null,r=Jax.$A(arguments);Object.isFunction(r[0])&&(t=r.shift()),Object.extend(i,Jax.Class.Methods),i.superclass=t,i.subclasses=[],t&&(n.prototype=t.prototype,i.prototype=new n,t.subclasses.push(i));for(var s=0,o=r.length;s<o;s++)i.addMethods(r[s]);return i.prototype.initialize||(i.prototype.initialize=e),i.prototype.constructor=i,i}function i(e){var n=this.superclass&&this.superclass.prototype,r=Object.keys(e);t&&(e.toString!=Object.prototype.toString&&r.push("toString"),e.valueOf!=Object.prototype.valueOf&&r.push("valueOf"));for(var i=0,s=r.length;i<s;i++){var o=r[i],u=e[o];if(n&&Object.isFunction(u)&&u.argumentNames()[0]=="$super"){var a=u;u=function(e){return function(){return n[e].apply(this,arguments)}}(o).wrap(a),u.valueOf=a.valueOf.bind(a),u.toString=a.toString.bind(a)}this.prototype[o]=u}return this}var e=function(){},t=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}();return{create:r,Methods:{addMethods:i}}}(),Jax.Helper={instances:[],create:function(e){return Jax.Helper.instances.push(e),e}},Math.EPSILON=Math.EPSILON||1e-5,Math.radToDeg=Math.radToDeg||function(e){return e*180/Math.PI},Math.rad2deg=Math.rad2deg||Math.radToDeg,Math.degToRad=Math.degToRad||function(e){return e*Math.PI/180},Math.deg2rad=Math.deg2rad||Math.degToRad,Math.equalish=Math.equalish||function(e,t){if(!e.length&&!t.length)return Math.abs(e-t)<=Math.EPSILON;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]==undefined||t[n]==undefined||isNaN(e[n])!=isNaN(t[n])||isFinite(e[n])!=isFinite(t[n])||Math.abs(e[n]-t[n])>Math.EPSILON)return!1;return!0},Jax.Util={findMaterial:function(e){if(typeof e=="string")return Jax.Material.find(e);if(e.isKindOf&&e.isKindOf(Jax.Material))return e;throw new Error("Material must be an instance of Jax.Material, or a string representing a material in the Jax material registry")},gsub:function(e,t,n){var r,i,s,o;if(t==null||n==null)return e;i="";while(e.length>0)if(r=e.match(t)){o=n;while(s=o.match(/\\(\d+)/))o=o.replace("\\"+s[1],r[s[1]]);i+=e.slice(0,r.index),i+=o,e=e.slice(r.index+r[0].length)}else i+=e,e="";return i},underscore:function(e){e=Jax.Util.gsub(e,/::/,"/"),e=Jax.Util.gsub(e,/([A-Z]+)([A-Z][a-z])/,"\\1_\\2"),e=Jax.Util.gsub(e,/([a-z\d])([A-Z])/,"\\1_\\2");while(e.indexOf("-")!=-1)e=e.replace("-","_");return e.toLowerCase()},decodePickingColor:function(e,t,n,r){return n==1&&(e*=255,t*=255),e*256+t},vectorize:function(e){if(e){var t=[];if(typeof e=="string"){var n=e.split(/[,\s]+/);if(n.length>=2)for(var r=0;r<n.length;r++)t[r]=parseFloat(n[r]);return t}if(e.length&&e.length>=3)return vec3.set(e,t);if(e.length==2)return[e[0],e[1]];if((t[0]=e.x)!=undefined&&(t[1]=e.y)!=undefined)return e.z!=undefined&&(t[2]=e.z),t;if((t[0]=e[0])!=undefined&&(t[1]=e[1])!=undefined)return e[2]!=undefined&&(t[2]=e[2]),t}throw new Error("Input argument for Jax.Util.vectorize not recognized: "+JSON.stringify(e))},colorize:function(e){if(e){var t=[0,0,0,0];if(typeof e=="string"){var n=e.split(/[,\s]+/);if(n.length>=3)for(var r=0;r<4;r++)n.length<=r?t[r]=1:t[r]=parseFloat(n[r]);return t}if(e.length&&e.length>=3)return t[0]=e[0],t[1]=e[1],t[2]=e[2],(t[3]=e[3])==undefined?t[3]=1:t[3]=1,t;if((t[0]=e.r)!=undefined&&(t[1]=e.g)!=undefined&&(t[2]=e.b)!=undefined)return(t[3]=e.a)==undefined&&(t[3]=1),t;if((t[0]=e.red)!=undefined&&(t[1]=e.green)!=undefined&&(t[2]=e.blue)!=undefined)return(t[3]=e.alpha)==undefined&&(t[3]=1),t;if((t[0]=e[0])!=undefined&&(t[1]=e[1])!=undefined&&(t[2]=e[2])!=undefined)return(t[3]=e[3])==undefined&&(t[3]=1),t}throw new Error("Input argument for Jax.Util.colorize not recognized: "+JSON.stringify(e))},properties:function(e){var t=[];for(var n in e)t.push(n);return t},merge:function(e,t){function s(n){if(e[n]==null)t[n]=null;else if(e[n].klass)t[n]=e[n];else if(Object.isArray(e[n]))Jax.Util.merge(e[n],t[n]=t[n]||[]);else if(typeof e[n]=="object"){if(Object.isArray(t[n])){i={};for(r=0;r<t[n].length;r++)i[r]=t[n][r];t[n]=i}Jax.Util.merge(e[n],t[n]=t[n]||{})}else t[n]=e[n]}if(!e)return;var n,r,i;if(Object.isArray(e))for(n=0;n<e.length;n++)s(n);else for(n in e)s(n);return t},normalizeOptions:function(e,t){var n={};return Jax.Util.merge(t,n),Jax.Util.merge(e,n),n},sizeofFormat:function(e){switch(e){case GL_ALPHA:return 1;case GL_LUMINANCE:return 1;case GL_RGB:return 3;case GL_RGBA:return 4;case GL_LUMINANCE_ALPHA:return 2}throw new Error("Unrecognized format: "+Jax.Util.enumName(e))},enumName:function(e){var t=Jax.getGlobal();for(var n in t)if(n.indexOf("GL_")==0&&t[n]==e)return n;return"(unrecognized enum: "+e+" [0x"+parseInt(e).toString(16)+"])"},addRequestedHelpers:function(e){var t=[];typeof ApplicationHelper!="undefined"&&(t.push(ApplicationHelper),e.addMethods(ApplicationHelper));if(e.prototype.helpers){var n;typeof e.prototype.helpers=="function"?n=e.prototype.helpers.call(e):n=e.prototype.helpers;for(var r=0;r<n.length;r++)t.push(n[r]),e.addMethods(n[r])}return t}},Jax.MatrixStack=function(){function r(e){mat4.multiply(e.getProjectionMatrix(),e.getModelViewMatrix(),e.getModelViewProjectionMatrix())}function i(e){mat4.multiply(e.getInverseViewMatrix(),e.getModelMatrix(),e.getModelViewMatrix()),mat4.inverse(e.getModelViewMatrix(),e.getInverseModelViewMatrix()),r(e)}function s(e){mat4.toMat3(e.getInverseModelViewMatrix(),e.getNormalMatrix()),mat3.transpose(e.getNormalMatrix())}function o(e){mat4.inverse(e.getModelMatrix(),e.getInverseModelMatrix()),i(e),s(e)}function u(e){mat4.inverse(e.getViewMatrix(),e.getInverseViewMatrix()),i(e),s(e)}function a(e){mat4.inverse(e.getProjectionMatrix(),e.getInverseProjectionMatrix()),r(e)}function f(r,i,s){switch(i){case e:mat4.set(s,r.getModelMatrix()),o(r);break;case t:mat4.set(s,r.getViewMatrix()),u(r);break;case n:mat4.set(s,r.getProjectionMatrix()),a(r);break;default:throw new
Error("programming error: matrix ID not understood: "+i)}}function l(r,i,s){switch(i){case e:mat4.multiply(r.getModelMatrix(),s,r.getModelMatrix()),o(r);break;case t:mat4.multiply(r.getViewMatrix(),s,r.getViewMatrix()),u(r);break;case n:mat4.multiply(r.getProjectionMatrix(),s,r.getProjectionMatrix()),a(r);break;default:throw new Error("programming error: matrix ID not understood: "+i)}}function c(e){var t,n,r=e.depth,i;e.depth++;for(var s in e.matrices)n=e.matrices[s],t=n[r],i=t.length==9?mat3:mat4,n[e.depth]=n[e.depth]||i.create(),i.set(t,n[e.depth])}var e=1,t=2,n=3;return Jax.Class.create({push:function(){return c(this),this},pop:function(){return this.depth--,this},reset:function(){return this.depth=0,this},loadModelMatrix:function(t){return f(this,e,t),this},loadViewMatrix:function(e){return f(this,t,e),this},loadProjectionMatrix:function(e){return f(this,n,e),this},multModelMatrix:function(t){return l(this,e,t),this},multViewMatrix:function(e){return l(this,t,e),this},multProjectionMatrix:function(e){return l(this,n,e),this},getModelMatrix:function(){return this.matrices.model[this.depth]},getInverseModelMatrix:function(){return this.matrices.inverse_model[this.depth]},getNormalMatrix:function(){return this.matrices.normal[this.depth]},getViewMatrix:function(){return this.matrices.view[this.depth]},getInverseViewMatrix:function(){return this.matrices.inverse_view[this.depth]},getModelViewMatrix:function(){return this.matrices.modelview[this.depth]},getInverseModelViewMatrix:function(){return this.matrices.inverse_modelview[this.depth]},getProjectionMatrix:function(){return this.matrices.projection[this.depth]},getModelViewProjectionMatrix:function(){return this.matrices.modelview_projection[this.depth]},getInverseProjectionMatrix:function(){return this.matrices.inverse_projection[this.depth]},initialize:function(){this.depth=0,this.matrices={model:[mat4.create()],inverse_model:[mat4.create()],normal:[mat3.create()],view:[mat4.create()],inverse_view:[mat4.create()],modelview:[mat4.create()],inverse_modelview:[mat4.create()],projection:[mat4.create()],inverse_projection:[mat4.create()],modelview_projection:[mat4.create()]},this.loadModelMatrix(mat4.IDENTITY),this.loadViewMatrix(mat4.IDENTITY),this.loadProjectionMatrix(mat4.IDENTITY)}})}(),window.debugAssert=function(e,t){if(Jax.environment!=Jax.PRODUCTION&&!e){var n=new Error(t||"debugAssert failed");throw n.stack&&(n=new Error((t||"debugAssert failed")+"\n\n"+n.stack)),n}},glMatrixArrayType.prototype.toString!=Array.prototype.toString&&(glMatrixArrayType.prototype.toString=function(){var e="["+glMatrixArrayType.name+": ",t=!1;for(var n in this)parseInt(n)==n&&(t&&(e+=","),e+=this[n],t=!0);return e+="]",e}),function(){var e,t,n,r,i;e=0,n=["ms","moz","webkit","o"],this.cancelAnimationFrame||(this.cancelAnimationFrame=this.cancelRequestAnimationFrame);if(!this.requestAnimationFrame)for(r=0,i=n.length;r<i;r++)t=n[r],this.requestAnimationFrame||(this.requestAnimationFrame=this[t+"RequestAnimationFrame"]),this.cancelAnimationFrame=this.cancelRequestAnimationFrame||(this.cancelRequestAnimationFrame=this[t+"CancelRequestAnimationFrame"]);this.requestAnimationFrame||(this.requestAnimationFrame=function(t,n){var r,i,s;return r=(new Date).getTime(),s=Math.max(0,16-(r-e)),i=this.setTimeout(function(){return t(r+s)},s),e=r+s,i}),this.cancelAnimationFrame||(this.cancelAnimationFrame=this.cancelRequestAnimationFrame=function(e){return clearTimeout(e)})}.call(this),function(){var Delegator=Jax.Class.create({initialize:function(e,t){this.methods=t,this.target=e},into:function(destination,dest_klass){var methods={},method_name,alias_chain_regexps=[];for(var i=0;i<this.methods.length;i++)if(typeof this.methods[i]=="string")method_name=this.methods[i],methods[method_name]=eval("(function() { return this."+destination+"."+method_name+".apply(this."+destination+", arguments); })");else if(this.methods[i].test){var method_regexp=this.methods[i];if(dest_klass)for(method_name in dest_klass.prototype)method_regexp.test(method_name)&&(methods[method_name]=eval("(function() { return this."+destination+"."+method_name+".apply(this."+destination+", arguments); })"));else alias_chain_regexps.push(method_regexp)}this.target.addMethods(methods);if(alias_chain_regexps.length>0){if(!this.target.alias_chain_regexps){this.target.alias_chain_regexps={};var original_initialize_method=this.target.prototype.initialize,fn="(function(){if (original_initialize_method) original_initialize_method.apply(this, arguments);var i, j, method_name, destination, method_regexp, self = this;destination = this."+destination+";"+"for (i = 0; i < this.klass.alias_chain_regexps['"+destination+"'].length; i++) {"+"method_regexp = this.klass.alias_chain_regexps['"+destination+"'][i];"+"for (j in destination) {"+"method_name = j;"+"if (method_regexp.test(method_name)) "+"this[method_name] = eval('(function(){return self."+destination+".'+method_name+"+"'.apply(self."+destination+", arguments);})');"+"}"+"}"+"})";this.target.prototype.initialize=eval(fn)}this.target.alias_chain_regexps[destination]=this.target.alias_chain_regexps[destination]||[];for(i=0;i<alias_chain_regexps.length;i++)this.target.alias_chain_regexps[destination].push(alias_chain_regexps[i])}}});Jax.Class.InstanceMethods={isKindOf:function(e){return this instanceof e}};var original_create=Jax.Class.create;Jax.Class.create=function(){var e=original_create.apply(Jax.Class,arguments);return e.prototype.klass=e,e.addMethods(Jax.Class.InstanceMethods),Jax.Util.addRequestedHelpers(e),e},Jax.Class.Methods.delegate=function(){return new Delegator(this,arguments)}}(),function(){function e(e,t){t=Jax.Util.normalizeOptions(t,{});var n;if(t)for(n in t)switch(n){case"position":e.camera.setPosition(Jax.Util.vectorize(t[n]));break;case"direction":e.camera.setDirection(Jax.Util.vectorize(t[n]));break;case"mesh":if(!t[n].isKindOf(Jax.Mesh))throw new Error("Unexpected value for mesh:\n\n"+JSON.stringify(t[n]));e.mesh=t[n];break;default:e[n]=t[n]}}Jax.Model=function(){return Jax.Class.create({initialize:function(t){this.__unique_id=Jax.Model.__unique_id_tracker++,this.camera=new Jax.Camera,e(this,Jax.Model.default_properties),this._klass&&this._klass.resources&&e(this,this._klass.resources["default"]),e(this,t),this.after_initialize&&this.after_initialize()},isShadowCaster:function(){return this.shadow_caster},isShadowcaster:function(){return this.shadow_caster},disableShadows:function(){var e=this.shadow_caster;return this.shadow_caster=!1,e},render:function(e,t){if(this.mesh){var n=this;Jax.Model.__instances[this.__unique_id]||(Jax.Model.__instances[this.__unique_id]=this),t=Jax.Util.normalizeOptions(t,{model_index:this.__unique_id}),e.pushMatrix(function(){e.multModelMatrix(n.camera.getTransformationMatrix()),n.mesh.render(e,t)})}},getBoundingCube:function(){return this.mesh?(this.mesh.built||this.mesh.rebuild(),this.mesh.bounds):{left:0,right:0,bottom:0,top:0,front:0,back:0,width:0,height:0,depth:0}},getBoundingSphereRadius:function(){var e=this.getBoundingCube();return Math.max(e.width,Math.max(e.height,e.depth))},dispose:function(){this.mesh&&this.mesh.dispose(),Jax.Model.__instances[this.__unique_id]&&delete Jax.Model.__instances[this.__unique_id]},isLit:function(){return this.lit},setColor:function(e,t,n,r){return arguments.length>1?this.mesh.setColor(e,t,n,r):this.mesh.setColor(e),this},inspect:function(){result={};for(var e in this)!Object.isFunction(this[e])&&e!="_klass"&&(result[e]=this[e]);return JSON.stringify(result)}})}();var t={find:function(e){for(var t in this.resources)if(e==t)return new this(this.resources[e]);throw new Error("Resource '"+e+"' not found!")},addResources:function(e){this.resources=this.resources||{};for(var t in e){if(this.resources[t])throw new Error("Duplicate resource ID: "+t);this.resources[t]=e[t]}},removeAllResources:function(){this.resources={}}};Jax.Model.default_properties={lit:!0,shadow_caster:!0},Jax.Model.create=function(e,n){var r;return n?r=Jax.Class.create(e,n):r=Jax.Class.create(Jax.Model,e),r.addMethods({_klass:r}),Object.extend(r,t),r},Jax.Model.__unique_id_tracker=1,Jax.Model.__instances={}}(),function(){function t(t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1}var e=["initialize","toString","getControllerName","constructor","isKindOf","fireAction","eraseResult"];Jax.Controller=function(){function e(e){e.view_key=e.getControllerName()+"/"+e.action_name,e.rendered_or_redirected=!0}return Jax.Class.create({fireAction:function(t){this.eraseResult(),this.action_name=t;if(!this[t])throw new Error("Call to missing action: '"+t+"' in controller '"+this.getControllerName()+"'");return this[t].call(this,[]),this.rendered_or_redirected||e(this),this},eraseResult:function(){return this.rendered_or_redirected=!1,this.view_key=null,this}})}();var n={invoke:function(e,t){var n=new this;return n.context=t,n.world=t&&t.world,n.player=t&&t.player,n.fireAction(e),n}};Jax.Controller.create=function(e,t,r){typeof e!="string"&&(r=t,t=e,e="generic");var i;return r?i=Jax.Class.create(t,r):i=Jax.Class.create(Jax.Controller,t),Object.extend(i,n),Object.extend(i,{getControllerName:function(){return e||"generic"}}),i.addMethods({getControllerName:function(){return e||"generic"}}),e&&Jax.routes.map(e,i),i}}(),Jax.ViewManager=function(){return Jax.Class.create({initialize:function(){this.views={}},push:function(e,t){this.views[Jax.Util.underscore(e)]=t},get:function(e){if(this.views[Jax.Util.underscore(e)])return new Jax.View(this.views[Jax.Util.underscore(e)]);throw new Error("Could not find view at '"+e+"'!")},find:function(e){return this.get(e)},remove:function(e){var t=this.views[Jax.Util.underscore(e)];return delete this.views[Jax.Util.underscore(e)],t},exists:function(e){return!!this.views[Jax.Util.underscore(e)]}})}(),Jax.RouteSet=function(){return Jax.Class.create({initialize:function(){this.clear()},clear:function(){return this._map={},this},root:function(){throw new Error("Jax.RouteSet#root is deprecated. Instead, please use `new Jax.Context(canvas, {root:'controller/action'})` or redirect explicitly with `context.redirectTo('controller/action')`")},map:function(e,t){if(!e)throw new Error("path is required");var n=e.split(/\//),r=Jax.Util.underscore(n[0]);this._map[r]=t,Jax.views.exists(r+"/index")||Jax.views.push(r+"/index",function(){this.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),this.world.render()})},getControllerNames:function(){return Jax.Util.properties(this._map)},recognizeRoute:function(e){var t=e.split(/\//);if(t.length>2||t.length==0)throw new Error("Invalid path format. String should look like 'controller/action'.");var n=Jax.Util.underscore(t[0]),r=t[1]||"index",i=this._map[Jax.Util.underscore(n)];if(!i||!i.prototype)throw new Error("Route not recognized: '"+e+"' (controller not found)");if(!i.prototype[r])throw new Error("Invalid action name '"+r+"' for controller '"+n+"'.\n\n"+"Valid action names: "+JSON.stringify(Jax.Util.properties(i.prototype)));return{controller:i,action:r}},isRouted:function(e){return!!self._map[e]},dispatch:function(e,t){var n=this.recognizeRoute(e);return n.controller.invoke(n.action,t)}})}(),Jax.View=function(){return Jax.Class.create({initialize:function(e){this.view_func=e},render:function(){return this.view_func(),this}})}(),Jax.getGlobal().WEBGL_CONTEXT_NAME="experimental-webgl",Jax.getGlobal().WEBGL_CONTEXT_OPTIONS={stencil:!0},Jax.getGlobal().GL_METHODS={},function(){var canvas=document.createElement("canvas");canvas.setAttribute("id","temporary-internal-use");try{var gl=canvas.getContext(WEBGL_CONTEXT_NAME)}catch(e){gl=null}if(gl){for(var method_name in gl)if(typeof gl[method_name]=="function"){var camelized_method_name=method_name.substring(1,method_name.length);camelized_method_name="gl"+method_name.substring(0,1).toUpperCase()+camelized_method_name;var func="(function "+camelized_method_name+"() {"+"  var result;"+"  if ("+(method_name=="getError")+" || Jax.environment == Jax.PRODUCTION)"+"    result = this.gl."+method_name+".apply(this.gl, arguments);"+"  else {"+"    try { "+"      result = this.gl."+method_name+".apply(this.gl, arguments);"+"      if ("+(navigator.userAgent.toLowerCase().indexOf("chrome")==-1)+")"+"        this.checkForRenderErrors();"+"    } catch(e) { "+"      var args = [], i;"+"      for (i = 0; i < arguments.length; i++) args.push(arguments[i]);"+"      try { args = JSON.stringify(args); } catch(jsonErr) { args = args.toString(); }"+"      if (!e.stack) e = new Error(e.toString());"+"      this.handleRenderError('"+method_name+"', args, e);"+"    }"+"  }"+"  return result;"+"})";GL_METHODS[camelized_method_name]=eval("("+func+")")}else/[a-z]/.test(method_name)||(Jax.getGlobal()["GL_"+method_name]=gl[method_name]);Jax.getGlobal().GL_DEPTH_COMPONENT=gl.DEPTH_COMPONENT||gl.DEPTH_COMPONENT16,Jax.getGlobal().GL_TEXTURES=[];for(i=0;i<32;i++)Jax.getGlobal().GL_TEXTURES[i]=gl["TEXTURE"+i];Jax.getGlobal().GL_MAX_ACTIVE_TEXTURES=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}Jax.getGlobal().GL=gl,Jax.getGlobal().WEBGL_CLEANUP=function(){delete Jax.getGlobal().GL,delete Jax.getGlobal().WEBGL_CLEANUP}}(),Jax.Shader=function(){function e(e,t,n){function u(){return i+" : "+n[i-1]}n=n.split(/\n/);var r=e.glGetShaderInfoLog(t).split(/\n/),i=1,s=[],o;for(o=0;o<r.length;o++){var a=r[o],f=/0:(\d+):(.*)/.exec(a);if(!f)continue;var l=parseInt(f[1]);if(l>i)for(;i<l;i++)s.push(u());l==i&&(s.push(u()),s.push(":: ERROR : "+f[2])),i=l+1}s.unshift("");for(o=r.length-1;o>=0;o--)s.unshift(r[o]);o=i;for(i=o;i<o+3;i++)s.push(u());return s.join("\n")}function t(t,n,r){t.glShaderSource(n,r),n.source=r,t.glCompileShader(n);if(!t.glGetShaderParameter(n,GL_COMPILE_STATUS))throw new Error(e(t,n,r))}function n(e){return e.replace(/-/,"_")}function r(e,t){return n("_"+e+"_"+t)}function i(e,t,n){var i=/import\((.*?),\s*(.*?)\)/,s,o;while(s=i.exec(n)){var u=s[1];if(t&&(o=t.exports&&t.exports[u]||e.options.exports&&e.options.exports[u])){var a=r(t.export_prefix||e.getName(),u);n=n.replace(s[0],s[2].replace(new RegExp(u,"g"),a))}else n=n.replace(s[0],"")}return n}function s(e,t,n){var i=/export\((.*?),\s*(.*?)(,\s*(.*?))?\)/,s,o,u,a,f;while(s=i.exec(n))a=s[1],u=s[2],f=s[4]||null,o=r(t&&t.export_prefix||e.getName(),u)+" = ",f?o+=f:o+=u,n=n.replace(s[0],o);return n}function o(e,t,n){var r=e.getInputMap(t);for(var i in r)n=n.replace(new RegExp("(^|[^a-zA-Z0-9])"+i+"([^a-zA-Z0-9]|$)","g"),"$1"+r[i].full_name+"$2");return n.replace(/(^|[^\w])shared\s+/g,"$1")}function u(e,t,n){var r=e.getInputMap(t);for(var i in r)if(r[i].shared&&t.skip_global_definitions&&t.skip_global_definitions.indexOf(r[i].full_name)!=-1){var s=new RegExp("(shared\\s+)"+r[i].scope+"\\s*"+r[i].type+"[^;]*?"+r[i].full_name+"[^;]*?;\n?","g");n=n.replace(s,"")}return n.replace(/shared\s+/,"")}function a(e,t,n,r){return n=u(e,t,n),n=s(e,t,n),n=i(e,t,n),n=o(e,t,n),n}function f(e){return e.replace(/\/\*.*\*\//g,"")}function l(e){var t=/void\s*main\((.*?)\)\s*\{/.exec(f(e));if(t)return t=t[1].replace(/\s*/g,""),t==""||t=="void"?0:t[1].split(/,/).length;throw new Error("Could not find main() function in source!\n\n"+e)}return Jax.Class.create({initialize:function(e){this.options=e,e.vertex&&this.setRawSource(e.vertex,"vertex"),e.fragment&&this.setRawSource(e.fragment,"fragment"),e.common&&this.setRawSource(e.common,"common"),this.shaders={vertex:{},fragment:{}}},getName:function(){return this.options.name},getVertexShader:function(e){return this.options.vertex?(this.shaders.vertex[e.id]=this.shaders.vertex[e.id]||e.glCreateShader(GL_VERTEX_SHADER),this.shaders.vertex[e.id]):null},getFragmentShader:function(e){return this.options.fragment?(this.shaders.fragment[e.id]=this.shaders.fragment[e.id]||e.glCreateShader(GL_FRAGMENT_SHADER),this.shaders.fragment[e.id]):null},getCommonSource:function(e){return this.options.common?this.options.common.render(e):""},getVertexSource:function(e){var t=this.getRawSource(e,"vertex");return t&&a(this,e,t,!0)},getPreamble:function(e){return e&&e.ignore_es_precision?"":"#ifdef GL_ES\nprecision highp float;\n#endif\n"},getFragmentSource:function(e){var t=this.getRawSource(e,"fragment");return t&&a(this,e,t,!1)},getVertexArgumentCount:function(e){var t=this.getVertexSource(e);return l(t)},getFragmentArgumentCount:function(e){var t=this.getFragmentSource(e);return l(t)},getRawSource:function(e,t){var n=this.options[t];e=Jax.Util.normalizeOptions(e,{shader:this,shader_type:t});if(n&&(n=n.render(e))){var r=this.getPreamble(e);if(!e||!e.skip_export_definitions)r+=this.getExportDefinitions(e&&e.export_prefix||this.getName());if(!e||!e.skip_common_source)r+=this.getCommonSource(e)+"\n";return r+=n,r}return null},getGlobalDefinitions:function(e,t){var n=this.getInputMap(e),r="";for(var i in n){if(n[i].scope=="attribute"&&!t)continue;r+=n[i].scope+" "+n[i].type+" "+n[i].full_name+";\n"}return r},setRawSource:function(e,t){this.options[t]=e&&new EJS({text:e})},setVertexSource:function(e){this.setRawSource(e,"vertex")},setFragmentSource:function(e){this.setRawSource(e,"fragment")},getInputMap:function(e){var t={},r="";e&&e.local_prefix?r=e.local_prefix+"_":e&&e.export_prefix&&(r=e.export_prefix+"_");var i=(this.getRawSource(e,"common")||"")+"\n\n"+(this.getRawSource(e,"vertex")||"")+"\n\n"+(this.getRawSource(e,"fragment")||""),s=new RegExp("(^|\\n|\\s+)((shared\\s+)?)(uniform|attribute|varying)\\s+(\\w+)\\s+((?!"+r+")[^;]*);"),o;while(o=s.exec(i)){var u=/shared/.test(o[2]),a=o[4],f=o[5],l=o[6].split(/,/);for(var c=0;c<l.length;c++)l[c]=l[c].replace(/^\s+/,"").replace(/\s+$/,""),u?t[l[c]]=l[c]:t[l[c]]=n(r+l[c]),t[l[c]]={full_name:t[l[c]],type:f,scope:a,shared:u},i=i.replace(new RegExp("(^|[^a-zA-Z0-9_])"+l[c]+"([^a-zA-Z0-9_]|$)","g"),"$1"+r+l[c]+"$2")}return t},getExportDefinitions:function(e,t){var n="";if(this.options.exports)for(var i in this.options.exports)if(!t||t.indexOf(i)==-1)n+=this.options.exports[i]+" "+r(e,i)+";\n";return n+"\n"},build:function(e,n){var r=0;this.getVertexShader(e)&&(r++,t(e,this.getVertexShader(e),this.getVertexSource(n))),this.getFragmentShader(e)&&(r++,t(e,this.getFragmentShader(e),this.getFragmentSource(n)));if(r==0)throw new Error("No sources specified for shader '"+this.getName()+"'!")}})}(),function(){var e=Jax.getGlobal().GL;Jax.Shader.max_varyings=e?e.getParameter(GL_MAX_VARYING_VECTORS):0,Jax.Shader.max_vertex_uniforms=e?e.getParameter(GL_MAX_VERTEX_UNIFORM_VECTORS):0,Jax.Shader.max_fragment_uniforms=e?e.getParameter(GL_MAX_FRAGMENT_UNIFORM_VECTORS):0,Jax.Shader.max_attributes=e?e.getParameter(GL_MAX_VERTEX_ATTRIBS):0,Jax.Shader.max_vertex_textures=e?e.getParameter(GL_MAX_VERTEX_TEXTURE_IMAGE_UNITS):0,Jax.Shader.max_uniforms=Math.min(Jax.Shader.max_fragment_uniforms,Jax.Shader.max_vertex_uniforms)}(),Jax.Shader.Delegator=function(){return Jax.Class.create({initialize:function(e,t,n){this.context=e,this.program=t,this.variables=n},doesExist:function(e){return this.variables[e]!=undefined}})}(),Jax.Shader.AttributeDelegator=function(){return Jax.Class.create(Jax.Shader.Delegator,{initialize:function($super,e,t){var n=e.glGetProgramParameter(t,GL_ACTIVE_ATTRIBUTES),r={};for(var i=0;i<n;i++){var s=e.glGetActiveAttrib(t,i);r[s.name]={length:s.length,size:s.size,type:s.type,type_str:Jax.Util.enumName(s.type),location:e.glGetAttribLocation(t,s.name)}}$super(e,t,r)},set:function(e,t){function o(e,t){if(t==undefined)return;if(n=s[e])t.bind(r),r.glEnableVertexAttribArray(n.location),r.glVertexAttribPointer(n.location,t.itemSize,GL_FLOAT,!1,0,0)}var n,r=this.context,i,s=this.variables;if(arguments.length==1&&typeof arguments[0]=="object")for(i in arguments[0])o(i,arguments[0][i]);else for(i=0;i<arguments.length;i+=2)o(arguments[i],arguments[i+1])},disableAll:function(){for(var e in this.variables)e=this.variables[e],this.context.glDisableVertexAttribArray(e.location)}})}(),Jax.Shader.UniformDelegator=function(){return Jax.Class.create(Jax.Shader.Delegator,{initialize:function($super,e,t){var n=e.glGetProgramParameter(t,GL_ACTIVE_UNIFORMS),r={};for(var i=0;i<n;i++){var s=e.glGetActiveUniform(t,i);r[s.name]={length:s.length,size:s.size,type:s.type,type_str:Jax.Util.enumName(s.type),location:e.glGetUniformLocation(t,s.name)}}$super(e,t,r)},set:function(e,t){function u(e,t){if(t==undefined)throw new Error("Value is undefined for shader uniform "+JSON.stringify(e));if(i=r[e])try{switch(i.type){case GL_FLOAT:t.length!=undefined?s.glUniform1fv(i.location,t):s.glUniform1f(i.location,t);break;case GL_BOOL:case GL_INT:t.length!=undefined?s.glUniform1iv(i.location,t):s.glUniform1i(i.location,t);break;case GL_FLOAT_VEC2:s.glUniform2fv(i.location,t);break;case GL_FLOAT_VEC3:s.glUniform3fv(i.location,t);break;case GL_FLOAT_VEC4:s.glUniform4fv(i.location,t);break;case GL_FLOAT_MAT2:s.glUniformMatrix2fv(i.location,!1,t);break;case GL_FLOAT_MAT3:s.glUniformMatrix3fv(i.location,!1,t);break;case GL_FLOAT_MAT4:s.glUniformMatrix4fv(i.location,!1,t);break;case GL_BOOL_VEC2:case GL_INT_VEC2:s.glUniform2iv(i.location,t);break;case GL_BOOL_VEC3:case GL_INT_VEC3:s.glUniform3iv(i.location,t);break;case GL_BOOL_VEC4:case GL_INT_VEC4:s.glUniform4iv(i.location,t);break;case GL_SAMPLER_2D:s.glUniform1i(i.location,t);break;case GL_SAMPLER_CUBE:s.glUniform1i(i.location,t);break;default:throw new Error("Unexpected attribute type: "+i.type+" ("+JSON.stringify(i)+")")}}catch(n){var o=new Error("Failed to set uniform for "+e+" ("+t+") in shader program:\n\n"+n);Jax.reraise(n,o)}}var n=this,r=this.variables,i,s=this.context,o;if(arguments.length==1&&typeof arguments[0]=="object")for(o in arguments[0])u(o,arguments[0][o]);else for(o=0;o<arguments.length;o+=2)u(arguments[o],arguments[o+1])}})}(),Jax.Shader.Manifest=Jax.Class.create({initialize:function(e){this.values={},this.texture_tracker=0,this.variable_prefix="",this.existing=e||[]},set:function(e,t){var n;if(t===undefined){if(typeof e!="object")throw new Error("Invalid argument (or the value given is undefined): "+JSON.stringify(e)+"\n\n"+(new Error).stack);for(n in e)this.set(n,e[n])}else for(n=0;n<arguments.length;n+=2)this.existing.indexOf(arguments[n])!=-1?this.values[arguments[n]]=arguments[n+1]:this.values[this.variable_prefix+arguments[n]]=arguments[n+1]},getValue:function(e){return this.existing.indexOf(e)!=-1?this.values[e]:this.values[this.variable_prefix+e]},texture:function(e,t,n){if(!n)throw new Error("Can't bind texture without a context");this.texture_tracker==GL_MAX_ACTIVE_TEXTURES-1,typeof this.getValue(e)!="number"&&this.set(e,this.texture_tracker++),t&&t.loaded&&(n.glActiveTexture(GL_TEXTURES[this.getValue(e)]),t.bind(n,this.getValue(e)))},apply:function(e,t){t.disableAll();for(var n in this.values)e.doesExist(n)?e.set(n,this.values[n]):t.doesExist(n)&&t.set(n,this.values[n])}}),Jax.Shader.Program=function(){function e(e,t,n){for(var r=0;r<e.shaders.length;r++)e.shaders[r].build(t,n)}function t(e,t){return e.programs[t.id]?e.programs[t.id]:e.programs[t.id]=t.glCreateProgram()}function n(e,t){for(var n in t.variables)e.variable_names.push(n)}function r(e,t){while(e.variable_names.length>0)e.variable_names.pop();n(e,e.getAttributeDelegator(t)),n(e,e.getUniformDelegator(t))}function i(t,n,r,i){for(var s=0;s<t.shaders.length;s++){var o=t.shaders[s],u=o.getVertexShader(n),a=o.getFragmentShader(n);u&&(i.vertex=u,i.vertex_shader=u,n.glAttachShader(i,u)),a&&(i.fragment=!0,i.fragment_shader=a,n.glAttachShader(i,a))}if(!i.vertex||!i.fragment)throw new Error("Attempted to link program missing either a vertex or fragment shader! (WebGL requires at least 1 of each.)");e(t,n,r),n.glLinkProgram(i);if(!n.glGetProgramParameter(i,GL_LINK_STATUS))throw new Error("Could not initialize shader!\n\n"+n.glGetProgramInfoLog(i));i.linked=!0,n.glUseProgram(i),t.attribute_delegator[n.id]=new Jax.Shader.AttributeDelegator(n,i),t.uniform_delegator[n.id]=new Jax.Shader.UniformDelegator(n,i)}return Jax.Class.create({initialize:function(){this.shaders=[],this.programs={},this.attribute_delegator={},this.uniform_delegator={},this.variable_names=[],this.manifest=new Jax.Shader.Manifest(this.variable_names)},attach:function(e,t){if(!t)throw new Error("No context!");var n=Jax.shaders[e];if(!n)throw new Error("Could not find shader named '"+e+"'! "+"Does it exist in Jax.shaders?");this.shaders.push(n)},invalidate:function(){for(var e in this.programs)this.programs[e].linked=!1},link:function(e,t){var n=this.getGLProgram(e);return n.linked||i(this,e,t,n),r(this,e),n},setShaderVariables:function(e,t,n,r){n.setShaderVariables(e,t,r,this.manifest),this.manifest.apply(this.getUniformDelegator(e),this.getAttributeDelegator(e))},render:function(e,t,n,r){var i=this.link(e,n);e.glUseProgram(i),this.setShaderVariables(e,t,n,r);try{var s;(s=t.getIndexBuffer())&&s.length>0?(s.bind(e),e.glDrawElements(r.draw_mode,s.length,GL_UNSIGNED_SHORT,0)):(s=t.getVertexBuffer())&&s.length>0&&e.glDrawArrays(r.draw_mode,0,s.length)}catch(o){var u=new Error("Fatal error encountered while drawing mesh:\n\n"+o+"\n\nShaders: "+this.getShaderNames());Jax.reraise(o,u)}},getShaderNames:function(){var e=[];for(var t=0;t<this.shaders.length;t++)e[t]=this.shaders[t].getName();return e},getGLProgram:function(e){return t(this,e)},getAttributeDelegator:function(e){return this.attribute_delegator[e.id]},getUniformDelegator:function(e){return this.uniform_delegator[e.id]}})}(),Jax.ShaderChain=function(){function e(e){return e.replace(/-/,"_")}function t(t,n,r,i){return i.replace(/void\s*main\s*\(/g,"void "+e(n)+"_main_"+e(r)+"(")}function n(e){return{shader:e,ignore_es_precision:!0,export_prefix:e.getName(),exports:e.gatherExports(),skip_export_definitions:!0,skip_global_definitions:[]}}function r(e,t){for(var n in e)t.skip_global_definitions.push(e[n].full_name)}return Jax.Class.create(Jax.Shader.Program,{initialize:function($super,e){$super(),this.name=e,this.shaders.push(this.getMasterShader()),this.phases=[]},getMasterShader:function(){return this.master_shader=this.master_shader||new Jax.Shader({})},addShader:function(t){if(typeof t=="string"){if(!Jax.shaders[t])throw new Error("Shader is not defined: "+t);t=Jax.shaders[t]}else if(!t)throw new Error("Argument must be a Jax.Shader, or a String equal to its name");this.phases.push(t),this.invalidate();if(!t.getName)throw new Error("Not an instance of Jax.Shader: "+JSON.stringify(t));return e(t.getName()+(this.phases.length-1)+"_")},getShaderNames:function(){var e=[];for(var t=0;t<this.phases.length;t++)e[t]=this.phases[t].getName();return e},removeAllShaders:function(){while(this.phases.length>0)this.phases.pop()},link:function($super,e,t){var n=this.getGLProgram(e);if(!n.linked){var r=this.getMasterShader(),i=this.countVaryings(t),s=this.countUniforms(t),o=this.countAttributes(t);if(i>Jax.Shader.max_varyings)throw new RangeError("Varyings ("+i+") exceed maximum number of varyings ("+Jax.Shader.max_varyings+") supported by GPU! Try using a shorter chain.");if(s>Jax.Shader.max_uniforms)throw new RangeError("Uniforms ("+s+") exceed maximum number of uniforms ("+Jax.Shader.max_uniforms+") supported by GPU! Try using a shorter chain.");if(o>Jax.Shader.max_attributes)throw new RangeError("Attributes ("+o+") exceed maximum number of attributes ("+Jax.Shader.max_attributes+") supported by GPU! Try using a shorter chain.");r.setVertexSource(this.getVertexSource(t)),r.setFragmentSource(this.getFragmentSource(t)),n=$super(e,t)}return n},getFragmentSource:function(e){e=Jax.Util.normalizeOptions(e,n(this));var i="";i+=this.getExportDefinitions(e);for(var s=0;s<this.phases.length;s++)e.local_prefix=this.phases[s].getName()+s,i+="\n/**** Shader chain index "+s+": "+this.phases[s].getName()+" ****/\n",i+=t(this,this.phases[s].getName()+s,"f",this.phases[s].getFragmentSource(e)),i+="\n\n",r(this.phases[s].getInputMap(e),e);return i+this.getFragmentMain(e)},getVertexSource:function(e){e=Jax.Util.normalizeOptions(e,n(this));var i="";i+=this.getExportDefinitions(e);for(var s=0;s<this.phases.length;s++)e.local_prefix=this.phases[s].getName()+s,i+="\n/**** Shader chain index "+s+": "+this.phases[s].getName()+" ****/\n",i+=t(this,this.phases[s].getName()+s,"v",this.phases[s].getVertexSource(e)),i+="\n\n",r(this.phases[s].getInputMap(e),e);return i+this.getVertexMain(e)},getVertexMain:function(t){var n="";for(var r=0;r<this.phases.length;r++){var i="";this.phases[r].getVertexArgumentCount()>0&&(i="gl_Position"),n+="  "+e(this.phases[r].getName())+r+"_main_v("+i+");\n"}return"/**** Shader chain generated #main ****/\nvoid main(void) {\n"+n+"}\n"},getFragmentMain:function(t){var n="",r=!1;for(var i=0;i<this.phases.length;i++){var s="";this.phases[i].getFragmentArgumentCount()>0?(r=!0,s="ambient, diffuse, specular"):r=!1,n+="  "+e(this.phases[i].getName())+i+"_main_f("+s+");\n"}var o="#ifdef PASS_TYPE\n  if (PASS_TYPE == "+Jax.Scene.ILLUMINATION_PASS+") gl_FragColor = ambient + diffuse + specular;\n"+"  else gl_FragColor = ambient;\n"+"#else\n"+"  gl_FragColor = ambient + diffuse + specular;\n"+"#endif\n";return"/**** Shader chain generated #main ****/\nvoid main(void) {\nvec4 ambient = vec4(1.0,1.0,1.0,1.0), diffuse = vec4(1.0,1.0,1.0,1.0), specular = vec4(1.0,1.0,1.0,1.0);\n"+n+(r?o:"")+"}\n"},getExportDefinitions:function(e){var t="\n/** Exported shader chain variables **/\n",n=[];for(var r=0;r<this.phases.length;r++){t+=this.phases[r].getExportDefinitions(e.export_prefix,n);for(var i in this.phases[r].options.exports)n.push(i)}return t},getGlobalDefinitions:function(e,t){var n="\n/** Shared uniforms, attributes and varyings **/\n",r=this.getInputMap(e);for(var i in r){if(r[i].scope=="attribute"&&!t)continue;n+=r[i].scope+" "+r[i].type+" "+r[i].full_name+";\n"}return n},getPerShaderInputMap:function(e){e=Jax.Util.normalizeOptions(e,{local_prefix:""});var t={},n={},r;for(var i=0;i<this.phases.length;i++){r=this.phases[i].getName();var s=t[r]=t[r]||{uniforms:[],attributes:[],varyings:[]};e.local_prefix=this.phases[i].getName()+i;var o=this.phases[i].getInputMap(e);for(r in o){var u=o[r];if(!n[u.full_name]){if(u.scope=="uniform")s.uniforms.push(u);else if(u.scope=="attribute")s.attributes.push(u);else{if(u.scope!="varying")throw new Error("unhandled variable scope: "+JSON.stringify(u));s.varyings.push(u)}n[u.full_name]=1}}}return t},getInputMap:function(e){e=Jax.Util.normalizeOptions(e,{local_prefix:""});var t={};for(var n=0;n<this.phases.length;n++){e.local_prefix=this.phases[n].getName()+n;var r=this.phases[n].getInputMap(e);for(var i in r){var s=r[i];if(t[s.full_name]){if(t[i].type!=s.type)throw new Error("Conflicting types for variable '"+i+"' ("+t[i].type+" and "+s.type+")!");if(t[i].scope!=s.scope)throw new Error("Conflicting scopes for variable '"+i+"' ("+t[i].scope+" and "+s.scope+")!")}else t[s.full_name]=s}}return t},countVariables:function(e,t){var n=this.getInputMap(t),r=0;for(var i in n)n[i].scope==e&&r++;return r},countVaryings:function(e){return this.countVariables("varying",e)},countAttributes:function(e){return this.countVariables("attribute",e)},countUniforms:function(e){return this.countVariables("uniform",e)},gatherExports:function(){var e={};for(var t=0;t<this.phases.length;t++)this.phases[t].options.exports&&Jax.Util.merge(this.phases[t].options.exports,e);return e},getName:function(){return this.name}})}(),Jax.Material=function(){function e(e){e.previous=e.previous||{subshaders:[]};for(var t=0;t<e.layers.length;t++)e.previous.subshaders[t]=e.layers[t].getName()}function t(e){if(e.isKindOf&&e.isKindOf(Jax.Material))return e;if(e.type){var t=Jax.Material[e.type];if(!t)throw new Error("Could not find material layer type: "+e.type);return delete e.type,new t(e)}throw new Error("Could not create layer: property 'type' was missing!")}return Jax.Class.create({initialize:function(e){e=Jax.Util.normalizeOptions(e,{ambient:[1,1,1,1],diffuse:[1,1,1,1],specular:[1,1,1,1],emissive:[0,0,0,1],shininess:10,default_shader:Jax.default_shader}),e.ambient=Jax.Util.colorize(e.ambient),e.diffuse=Jax.Util.colorize(e.diffuse),e.specular=Jax.Util.colorize(e.specular),e.emissive=Jax.Util.colorize(e.emissive);for(var n in e)this[n]=e[n];this.option_properties=Jax.Util.properties(e),this.protected_properties=["name","shader","default_shader","shaders","layers"],this.name=e.name||e.shader||e.default_shader,this.shaders={},this.layers=[];if(!e.shader&&!e.default_shader)throw new Error("No shader specified for Jax.Material "+this.name);var r;if(e.texture)r=new Jax.Texture(e.texture),this.addTextureLayer(r),delete e.texture;else if(e.textures){for(n=0;n<e.textures.length;n++)r=new Jax.Texture(e.textures[n]),this.addTextureLayer(r);delete e.textures}if(e.layers)for(n=0;n<e.layers.length;n++)this.addLayer(t(e.layers[n]))},supportsLighting:function(){if(this.getName()=="lighting")return!0;for(var e=0;e<this.layers.length;e++)if(this.layers[e].getName()=="lighting")return!0;return!1},getName:function(){return this.name},addTextureLayer
:function(e){var t;switch(e.options.type){case Jax.NORMAL_MAP:t=new Jax.Material.NormalMap(e);break;default:t=new Jax.Material.Texture(e)}this.addLayer(t)},addLayer:function(e){e.option_properties||(e=t(e)),this.layers.push(e);for(var n=0;n<e.option_properties.length;n++){var r=e.option_properties[n];this.protected_properties.indexOf(r)==-1&&this[r]==undefined&&(this[r]=e[r])}},buildShader:function(){return this.shaderChain?this.shaderChain.removeAllShaders():this.shaderChain=new Jax.ShaderChain(this.getName()),this.addShadersToChain(this.shaderChain),this.shaderChain},addShadersToChain:function(e){this.shader_variable_prefix=e.addShader(this.getBaseShader());for(var t=0;t<this.layers.length;t++)this.layers[t].addShadersToChain(e)},getBaseShader:function(){return this.shader||this.default_shader},updateModifiedShaders:function(){return this.isChanged()&&(this.buildShader(),e(this)),this},prepareShader:function(){var e;return this.shaderChain?e=this.shaderChain:e=this.buildShader(),this.updateModifiedShaders(),e},setShaderVariables:function(e,t,n,r){r.variable_prefix=this.shader_variable_prefix,r.set({mMatrix:e.getModelMatrix(),vnMatrix:mat3.transpose(mat4.toMat3(e.getViewMatrix())),ivMatrix:e.getInverseViewMatrix(),vMatrix:e.getViewMatrix(),mvMatrix:e.getModelViewMatrix(),pMatrix:e.getProjectionMatrix(),nMatrix:e.getNormalMatrix(),PASS_TYPE:e.current_pass,materialAmbient:this.ambient,materialDiffuse:this.diffuse,materialSpecular:this.specular,materialShininess:this.shininess}),r.set("VERTEX_POSITION",t.getVertexBuffer()||null),r.set("VERTEX_COLOR",t.getColorBuffer()||null),r.set("VERTEX_NORMAL",t.getNormalBuffer()||null),r.set("VERTEX_TEXCOORDS",t.getTextureCoordsBuffer()||null),this.setVariables&&this.setVariables(e,t,n,r),this.setUniforms&&this.setUniforms(e,t,n,r),this.setAttributes&&this.setAttributes(e,t,n,r);for(var i=0;i<this.layers.length;i++)r.variable_prefix=this.layers[i].shader_variable_prefix,this.layers[i].setVariables&&this.layers[i].setVariables(e,t,n,r),this.layers[i].setUniforms&&this.layers[i].setUniforms(e,t,n,r),this.layers[i].setAttributes&&this.layers[i].setAttributes(e,t,n,r)},render:function(e,t,n){this.lights=e.world.lighting._lights,this.light_count=e.world.lighting._lights.length;try{var r=this.prepareShader(e);r.render(e,t,this,n)}catch(i){if(!(i instanceof RangeError))throw i;if(!(this.layers.length>0))throw i;this.adaptShaderToHardwareLimits(r,i),this.render(e,t,n)}},adaptShaderToHardwareLimits:function(e,t){function n(e){if(Jax.getGlobal().ENV&&Jax.getGlobal().ENV.SILENCED)return;Jax.getGlobal().console?console.log(e):setTimeout(function(){throw new Error(e)},1)}n("WARNING: Hardware limits reached for material '"+this.getName()+"'! (original message: "+t+")");var r=e.getPerShaderInputMap(this),i=Jax.Shader.max_uniforms-r[this.getBaseShader()].uniforms.length,s=Jax.Shader.max_varyings-r[this.getBaseShader()].varyings.length,o=Jax.Shader.max_attributes-r[this.getBaseShader()].attributes.length,u=0,a=0,f=0;for(var l=0;l<this.layers.length;l++){var c=r[this.layers[l].getBaseShader()];c.uniforms.length>i||c.varyings.length>s||c.attributes.length>o?(n("WARNING: Removing shader '"+this.layers[l].getName()+"' due to hardware limitations!"),this.layers.splice(l,1),l=0):(u+=c.uniforms.length,a+=c.varyings.length,f+=c.attributes.length)}if(u>i||a>s||f>o)n("WARNING: Removing shader '"+this.layers[this.layers.length-1].getName()+"' due to hardware limitations!"),this.layers.pop()},isChanged:function(){if(!this.previous)return!0;if(this.previous.subshaders.length!=this.layers.length)return!0;for(var e=0;e<this.layers.length;e++)if(this.previous.subshaders[e]!=this.layers[e].getName())return!0;return!1}})}(),Jax.Material.instances={},Jax.Material.find=function(e){var t;if(t=Jax.Material.instances[e])return t;throw new Error("Material {material:'"+e+"'} could not be found.")},Jax.Material.create=function(e,t){t=Jax.Util.normalizeOptions(t,{name:e});var n=Jax.Material;t.type&&(n=n[t.type]);if(!n)throw new Error("Material type '"+t.type+"' not found!");return Jax.Material.instances[e]=new n(t)},Jax.Material.all=function(){return Jax.Util.properties(Jax.Material.instances)},Jax.Material.addResources=function(e){for(var t in e){if(Jax.Material.instances[t])throw new Error("Duplicate material resource ID: "+t);Jax.Material.create(t,e[t])}},Jax.Core={},Jax.DataSegment=function(){function t(e,t,n){var r,i,s=e.type.BYTES_PER_ELEMENT,o=0,u;for(r=0;r<e.array.length;r+=n)(u=t[o])?u.setArray(new e.type(e.buffer,e.byteOffset+r*s,n)):(u=new Jax.DataSegment(e.type,e.buffer,e.byteOffset+r*s,n),t.push(u)),o++;while(t.length>o)t.pop()}var e=Jax.Class.create({initialize:function(e,t){this.raw=e,this.type=e.type,this.size=t,this.length=0},push:function(e){return this[this.length]=e,this.length++,e},pop:function(){this.length--;var e=this[this.length];return delete this[this.length],e},getRawData:function(){return this.raw}}),n=Jax.Class.create({initialize:function(e,t,n,r){this.type=e,this.groups=[];try{arguments.length==2?t instanceof this.type?this.setArray(t):this.setArray(new e(t)):arguments.length==1?this.setArray(e):this.setArray(new e(t,n,r))}catch(i){throw new Error("Error: "+i+" while constructing segment from "+"("+e+", "+t+"["+t.byteLength+"], "+n+", "+r+")")}},setArray:function(e){this.array=e,this.length=e.length,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength;for(var n=0;n<this.groups.length;n++){var r=this.groups[n],i=r.size;t(this,r,i)}return this},group:function(n){if(this.array.length%n!=0)throw new Error("Data segment size "+this.array.length+" is not divisible by group size "+n);var r=new e(this,n);return t(this,r,n),this.groups.push(r),r},removeGroup:function(e){var t;return typeof e=="number"?t=e:t=this.groups.indexOf(e),t!=-1&&this.groups.splice(t,1),this},set:function(e,t){this.array.set.apply(this.array,arguments)},subarray:function(e,t){return new Jax.DataSegment(this.type,this.array.subarray(e,t))},toString:function(){return"{array:"+this.array.toString()+"}"}});return n}(),Jax.DataRegion=function(){var e=1024,t=Jax.Class.create({initialize:function(t){this.allocate(t||e),this.offset=0,this.segments=[]},allocate:function(t){if(!t&&typeof t!="number")throw new Error("amount required\n\n"+(new Error).stack);if(isNaN(t))throw new Error("NaN\n\n"+(new Error).stack);if(!this.data)return this.data=new ArrayBuffer(t),this;var n=this.data.byteLength;if(n>=t)return this;n+=(parseInt(t/e)+1)*e,this.data=new ArrayBuffer(n);if(this.segments.length>0){var r=this.segments[0].array;this.remap(this.segments[0],this.segments[0].length).set(r)}return this},map:function(e,t,n){typeof t!="number"&&(n=t,t=n.length),this.allocate(this.offset+t*e.BYTES_PER_ELEMENT);var r=new Jax.DataSegment(e,this.data,this.offset,t);return this.segments.push(r),r.type=e,this.offset+=t*e.BYTES_PER_ELEMENT,n&&r.set(n),r},remap:function(e,t,n,r){r==undefined&&(r=e.byteOffset),!n&&typeof t!="number"&&(n=t,t=n.length);var i=e.length;if(i==t&&r==e.byteOffset)return n&&e.set(n),e;this.allocate(r+t*e.type.BYTES_PER_ELEMENT);var s=new e.type(this.data,r,t);if(n)try{s.set(n),i=Math.max(n.length,i)}catch(o){throw new Error("Values are not valid: "+JSON.stringify(n))}e.setArray(s);var u=this.segments.indexOf(e);if(u<this.segments.length-1){var a=this.segments[u+1],f=a.array;this.remap(a,a.length,null,r+t*e.type.BYTES_PER_ELEMENT).set(f)}for(var l=i;l<t;l++)e[l]=0;return e}});return t}(),Jax.Buffer=function(){function e(e,t){for(var n in e.gl)t(e.gl[n].context,e.gl[n].buffer)}return Jax.Class.create({initialize:function(e,t,n,r,i){if(!i)throw new Error("Expected an itemSize - how many JS array elements represent a single buffered element?");this.classType=t,this.itemSize=i,this.js=r,this.gl={},this.numItems=this.length=r.length/i,this.bufferType=e,this.drawType=n},refresh:function(){var t=this,n=this.refreshTypedArray();if(!t.gl)return;return e(t,function(e,r){e.glBindBuffer(t.bufferType,r),e.glBufferData(t.bufferType,n,t.drawType)}),this},refreshTypedArray:function(){var e=this,t=this.getTypedArray();return t.set(e.js),e.numItems=e.length=e.js.length/e.itemSize,t},getTypedArray:function(){return this.classTypeInstance=this.classTypeInstance||new this.classType(this.js)},dispose:function(){var t=this;return e(this,function(e,n){e.glDeleteBuffer(n),t.gl[e.id]=null}),t.gl={},t},isDisposed:function(){return!this.gl},bind:function(e){return e.glBindBuffer(this.bufferType,this.getGLBuffer(e)),this},getGLBuffer:function(e){if(!e||typeof e.id=="undefined")throw new Error("Cannot build a buffer without a context!");if(!this.gl[e.id]){var t=e.glCreateBuffer();t.itemSize=this.itemSize,this.gl[e.id]={context:e,buffer:t},this.refresh()}return this.gl[e.id].buffer}})}(),Jax.ElementArrayBuffer=Jax.Class.create(Jax.Buffer,{initialize:function($super,e){$super(GL_ELEMENT_ARRAY_BUFFER,Uint16Array,GL_STREAM_DRAW,e,1)}}),Jax.FloatArrayBuffer=Jax.Class.create(Jax.Buffer,{initialize:function($super,e,t){$super(GL_ARRAY_BUFFER,Float32Array,GL_STATIC_DRAW,e,t)}}),Jax.VertexBuffer=Jax.Class.create(Jax.FloatArrayBuffer,{initialize:function($super,e){$super(e,3)}}),Jax.ColorBuffer=Jax.Class.create(Jax.FloatArrayBuffer,{initialize:function($super,e){$super(e,4)}}),Jax.TextureCoordsBuffer=Jax.Class.create(Jax.FloatArrayBuffer,{initialize:function($super,e){$super(e,2)}}),Jax.NormalBuffer=Jax.Class.create(Jax.FloatArrayBuffer,{initialize:function($super,e){$super(e,3)}}),Jax.DataBuffer=Jax.Class.create(Jax.Buffer,{initialize:function($super,e,t,n){n=n||1,t.getRawData?(n=t.size,this.mirror=t,this.data=t.getRawData()):this.data=t;var r=this.data.type;if(!n||!r)throw new Error("Couldn't detect element size or type! Use a different buffer.");$super(e,r,GL_DYNAMIC_DRAW,this.data.array,n)},refreshTypedArray:function(){return this.numItems=this.length=this.mirror?this.mirror.length:this.data.length/this.itemSize,this.getTypedArray()},getTypedArray:function(){return this.data.array}}),Jax.Framebuffer=function(){function e(e,n){var r=e.glCreateFramebuffer(),i=n.options.width,s=n.options.height;n.setHandle(e,r),e.glBindFramebuffer(GL_FRAMEBUFFER,r),n.options.depth&&n.options.stencil&&(r.depthstencilbuffer=e.glCreateRenderbuffer(),e.glBindRenderbuffer(GL_RENDERBUFFER,r.depthstencilbuffer),e.glRenderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_STENCIL,i,s),e.glFramebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_STENCIL_ATTACHMENT,GL_RENDERBUFFER,r.depthstencilbuffer),e.glBindRenderbuffer(GL_RENDERBUFFER,null)),n.options.depth&&!n.options.stencil&&(r.depthbuffer=e.glCreateRenderbuffer(),e.glBindRenderbuffer(GL_RENDERBUFFER,r.depthbuffer),e.glRenderbufferStorage(GL_RENDERBUFFER,GL_DEPTH_COMPONENT16,i,s),e.glFramebufferRenderbuffer(GL_FRAMEBUFFER,GL_DEPTH_ATTACHMENT,GL_RENDERBUFFER,r.depthbuffer),e.glBindRenderbuffer(GL_RENDERBUFFER,null)),n.options.stencil&&!n.options.depth&&(r.stencilbuffer=e.glCreateRenderbuffer(),e.glBindRenderbuffer(GL_RENDERBUFFER,r.stencilbuffer),e.glRenderbufferStorage(GL_RENDERBUFFER,GL_STENCIL_INDEX8,i,s),e.glFramebufferRenderbuffer(GL_FRAMEBUFFER,GL_STENCIL_ATTACHMENT,GL_RENDERBUFFER,r.stencilbuffer),e.glBindRenderbuffer(GL_RENDERBUFFER,null)),r.textures=[];var o=GL_COLOR_ATTACHMENT0;for(var u=0;u<n.options.colors.length;u++){var a=n.options.colors[u],f={format:GL_RGBA,width:i,height:s,min_filter:n.options.min_filter,mag_filter:n.options.mag_filter,wrap_s:n.options.wrap_s,wrap_t:n.options.wrap_t,generate_mipmap:n.options.generate_mipmap,data_type:n.options.data_type};typeof a!="number"?f=Jax.Util.normalizeOptions(a,f):f.format=a,r.textures[u]=new Jax.Texture(f),r.textures[u].getTarget()==GL_TEXTURE_2D?e.glFramebufferTexture2D(GL_FRAMEBUFFER,o,GL_TEXTURE_2D,r.textures[u].getHandle(e),0):e.glFramebufferTexture2D(GL_FRAMEBUFFER,o,GL_TEXTURE_CUBE_MAP_POSITIVE_X,r.textures[u].getHandle(e),0),o++}try{t(e,n)}catch(l){throw n.dispose(e),l}}function t(e,t){var n=e.glCheckFramebufferStatus(GL_FRAMEBUFFER);t.unbind(e);switch(n){case GL_FRAMEBUFFER_COMPLETE:break;case GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("Jax.Framebuffer: one or more attachments is incomplete. (GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("Jax.Framebuffer: there are no images attached to the framebuffer. (GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)");case GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Jax.Framebuffer: all attachments must have the same dimensions. (GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS)");case GL_FRAMEBUFFER_UNSUPPORTED:throw new Error("Jax.Framebuffer: the requested framebuffer layout is unsupported on this hardware. (GL_FRAMEBUFFER_UNSUPPORTED)");case Jax.getGlobal().GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER||36059:throw new Error("Jax.Framebuffer: make sure the framebuffer has at least 1 texture attachment. (GL_FRAMEBUFFER_INCOMPLETE_DRAW_BUFFER)");default:var r;for(r in e.gl)if(e.gl[r]==n)throw new Error("Jax.Framebuffer: an unknown error occurred. ("+n+" - "+r+")");throw new Error("Jax.Framebuffer: an unknown error occurred. ("+n+")")}}return Jax.Class.create({dispose:function(e){if(!this.handles)return;var t=this.getHandle(e);if(!t)return;t.stencilbuffer&&(e.glDeleteRenderbuffer(t.stencilbuffer),delete t.stencilbuffer),t.depthbuffer&&(e.glDeleteRenderbuffer(t.depthbuffer),delete t.depthbuffer),t.depthstencilbuffer&&(e.glDeleteRenderbuffer(t.depthstencilbuffer),delete t.depthstencilbuffer);if(t.textures){while(t.textures.length>0)t.textures[0].dispose(e),t.textures.splice(0,1);delete t.textures}e.glDeleteFramebuffer(t),this.setHandle(e,null)},initialize:function(e){var t={depth:!1,stencil:!1,width:512,height:512,data_type:GL_UNSIGNED_BYTE,min_filter:GL_LINEAR,mag_filter:GL_LINEAR,wrap_s:GL_CLAMP_TO_EDGE,wrap_t:GL_CLAMP_TO_EDGE,generate_mipmap:!1};if(!e||!e.color&&!e.colors)t.colors=[GL_RGBA];this.handles={},this.options=e=Jax.Util.normalizeOptions(e,t),e.color!=undefined&&(e.colors!=undefined?e.colors.push(e.color):e.colors=[e.color],delete e.color)},bindCubeFace:function(e,t,n,r){var i=this.getTexture(e,t);if(i.options.target!=GL_TEXTURE_CUBE_MAP)throw new Error("Texture at index "+t+" is not a cube map!");return this.bind(e),e.glFramebufferTexture2D(GL_FRAMEBUFFER,window["GL_COLOR_ATTACHMENT"+t],n,i.getHandle(e),0),r&&(r(),this.unbind(e)),this},bind:function(e,t){return this.validate(e),e.glBindFramebuffer(GL_FRAMEBUFFER,this.getHandle(e)),t&&(t.call(this),this.unbind(e)),this},validate:function(t){return this.getHandle(t)||e(t,this),this},countTextures:function(e){return this.validate().getHandle(e).textures.length},unbind:function(e){return e.glBindFramebuffer(GL_FRAMEBUFFER,null),this},viewport:function(e){return e.glViewport(0,0,this.options.width,this.options.height),this},getTexture:function(e,t){return this.validate(e),this.getHandle(e).textures[t||0]},getTextureHandle:function(e,t){return this.getTexture(e,t).getHandle(e)},getTextureBuffer:function(e,t){return alert("Jax.Framebuffer#getTextureBuffer(context, index) is deprecated.\nPlease use Jax.Framebuffer#getTexture(context, index) instead.\n\nStack trace:\n\n"+((new Error).stack||"(unavailable)")),this.getTexture(e,t)},getTextureBufferHandle:function(e,t){return alert("Jax.Framebuffer#getTextureBufferHandle(context, index) is deprecated.\nPlease use Jax.Framebuffer#getTextureHandle(context, index) instead.\n\nStack trace:\n\n"+((new Error).stack||"(unavailable)")),this.getTextureHandle(e,t)},getHandle:function(e){return this.handles[e.id]},setHandle:function(e,t){return t?this.handles[e.id]=t:this.handles[e.id]&&delete this.handles[e.id],this}})}(),Jax.Events=function(){return{Methods:{getEventListeners:function(e){return this.event_listeners=this.event_listeners||{},this.event_listeners[e]=this.event_listeners[e]||{length:0}},addEventListener:function(e,t){var n=this.getEventListeners(e),r=n.length++;return n[r]=t,r},removeEventListener:function(e,t){if(!e||t==undefined)throw new Error("both event type and listener index are required");var n=this.getEventListeners(e),r=n[t];return n[t]&&delete n[t],r},fireEvent:function(e,t){var n=this.getEventListeners(e);t&&t.type==undefined&&(t.type=e);for(var r in n){if(r=="length")continue;n[r].call(this,t)}}}}}(),Jax.Mesh=function(){var e={vertices:["vertexData",3],normals:["normalData",3],colors:["colorData",4],textureCoords:["textureCoordsData",2]};return Jax.Class.create({initialize:function(t){this.buffers={},this.bounds={left:0,right:0,front:0,back:0,top:0,bottom:0,width:0,height:0,depth:0},this.triangles=[];var n=this;for(var r in e)Object.defineProperty(n,r,function(){var t="_"+r,s=e[r];return{configurable:!0,enumerable:!0,get:function(){return n[t]||(n[t]=n.validate()[s[0]].group(s[1])),n[t]}}}());this.default_material="default";for(var r in t)this[r]=t[r];this.draw_mode==undefined&&(this.draw_mode=GL_TRIANGLES)},getBounds:function(){return this.bounds},getTriangles:function(){return this.validate(),this.triangles.length==0&&this.vertices.length!=0&&this.buildTriangles(),this.triangles},setColor:function(e,t,n,r){var i=this.getColorBuffer();for(var s=0;s<this.colors.length;s++)if(arguments.length==4)this.colors[s].array[0]=e,this.colors[s].array[1]=t,this.colors[s].array[2]=n,this.colors[s].array[3]=r;else for(var o=0;o<4;o++)this.colors[s].array[o]=arguments[0][o];return i.refresh(),this.fireEvent("color_changed"),this},dispose:function(){for(var e in this.buffers)this.buffers[e].dispose();this.built=!1},render:function(e,t){this.isValid()||this.rebuild(),t=this.getNormalizedRenderOptions(t),t.material.render(e,this,t)},getNormalizedRenderOptions:function(e){var t=Jax.Util.normalizeOptions(e,{material:this.material,default_material:this.default_material,draw_mode:this.draw_mode==undefined?GL_TRIANGLES:this.draw_mode});return t.material||(t.material=t.default_material),t.material=Jax.Util.findMaterial(t.material),t},getVertexBuffer:function(){return this.validate(),this.buffers.vertex_buffer.length==0?null:this.buffers.vertex_buffer},getColorBuffer:function(){return this.validate(),this.buffers.color_buffer.length==0?null:this.buffers.color_buffer},getIndexBuffer:function(){return this.validate(),this.buffers.index_buffer.length==0?null:this.buffers.index_buffer},getNormalBuffer:function(){return this.validate(),this.buffers.normal_buffer.length==0&&this.buffers.vertex_buffer.length>0&&this.recalculateNormals(),this.buffers.normal_buffer.length==0?null:this.buffers.normal_buffer},getTextureCoordsBuffer:function(){return this.validate(),this.buffers.texture_coords.length==0?null:this.buffers.texture_coords},getTangentBuffer:function(){return this.buffers.tangent_buffer?this.buffers.tangent_buffer.length==0?null:this.buffers.tangent_buffer:this.rebuildTangentBuffer()},rebuildTangentBuffer:function(){return this.makeTangentBuffer()},validate:function(){return this.isValid()||this.rebuild(),this},isValid:function(){return!!this.built},recalculateNormals:function(){this.calculateNormals()},rebuild:function(){this.dispose();while(this.triangles.length>0)this.triangles.pop();var e=[],t=[],n=[],r=[],i=[];this.init&&this.init(e,t,n,r,i),this.built=!0;if(t.length==0||this.color){this.color||(this.color=[1,1,1,1]);for(var s=0;s<e.length/3;s++)for(var o=0;o<4;o++)t[s*4+o]=this.color[o]}this.dataRegion?(this.dataRegion.remap(this.vertexData,e),this.dataRegion.remap(this.colorData,t),this.dataRegion.remap(this.textureCoordsData,n),this.dataRegion.remap(this.normalData,r),this.dataRegion.remap(this.indices,i)):(this.dataRegion=new Jax.DataRegion((e.length+t.length+n.length+r.length)*Float32Array.BYTES_PER_ELEMENT+i.length*Uint16Array.BYTES_PER_ELEMENT),this.vertexData=this.dataRegion.map(Float32Array,e),this.colorData=this.dataRegion.map(Float32Array,t),this.textureCoordsData=this.dataRegion.map(Float32Array,n),this.normalData=this.dataRegion.map(Float32Array,r),this.indices=this.dataRegion.map(Uint16Array,i)),this._vertices=null,this._colors=null,this._textureCoords=null,this._normals=null,this.calculateBounds(e),this.buffers.vertex_buffer=new Jax.DataBuffer(GL_ARRAY_BUFFER,this.vertexData,3),this.buffers.color_buffer=new Jax.DataBuffer(GL_ARRAY_BUFFER,this.colorData,4),this.buffers.normal_buffer=new Jax.DataBuffer(GL_ARRAY_BUFFER,this.normalData,3),this.buffers.texture_coords=new Jax.DataBuffer(GL_ARRAY_BUFFER,this.textureCoordsData,2),this.buffers.index_buffer=new Jax.DataBuffer(GL_ELEMENT_ARRAY_BUFFER,this.indices),this.after_initialize&&this.after_initialize()}})}(),Jax.Mesh.addMethods(Jax.Events.Methods),Jax.Mesh.prototype.makeTangentBuffer=function(){function M(e,t){e[0]=n[t*3],e[1]=n[t*3+1],e[2]=n[t*3+2]}function _(e,t){e[0]=r[t*2],e[1]=r[t*2+1]}function D(e){u[e]=u[e]||vec3.create(),vec3.add(u[e],A,u[e])}function P(e){a[e]=a[e]||vec3.create(),vec3.add(a[e],O,a[e])}function H(e,t,n){i&&(e=i[e],t=i[t],n=i[n]),M(l,e),M(c,t),M(h,n),_(p,e),_(d,t),_(v,n),g=c[0]-l[0],y=h[0]-l[0],b=c[1]-l[1],w=h[1]-l[1],E=c[2]-l[2],S=h[2]-l[2],x=d[0]-p[0],T=v[0]-p[0],N=d[1]-p[1],C=v[1]-p[1],k=1/(x*C-T*N),A[0]=(C*g-N*y)*k,A[1]=(C*b-N*w)*k,A[2]=(C*E-N*S)*k,O[0]=(x*y-T*g)*k,O[1]=(x*w-T*b)*k,O[2]=(x*S-T*E)*k;if(isNaN(A[0])||isNaN(A[1])||isNaN(A[2])||isNaN(O[0])||isNaN(O[1])||isNaN(O[2]))A[0]=A[1]=A[2]=O[0]=O[1]=O[2]=0;D(e),D(t),D(n),P(e),P(t),P(n)}var e=this,t=e.getNormalBuffer(),n=e.getVertexBuffer(),r=e.getTextureCoordsBuffer(),i=e.getIndexBuffer();if(!t||!n||!r)return null;var s=e.buffers.tangent_buffer;t=t.js,n=n.js,r=r.js,i&&i.length>0?i=i.js:i=null;var o=s?s.js:[],u=[],a=[],f,l=vec3.create(),c=vec3.create(),h=vec3.create(),p=[],d=[],v=[],m,g,y,b,w,E,S,x,T,N,C,k,L=[],A=vec3.create(),O=vec3.create();m=i&&i.length>0?i.length:t.length/3;switch(e.draw_mode){case GL_TRIANGLE_STRIP:for(f=2;f<m;f+=2)H(f-2,f-1,f),H(f,f-1,f+1);break;case GL_TRIANGLES:for(f=0;f<m;f+=3)H(f,f+1,f+2);break;case GL_TRIANGLE_FAN:for(f=2;f<m;f++)H(0,f-1,f);break;default:throw new Error("Cannot calculate tangent space for draw mode: "+Jax.Util.enumName(e.draw_mode))}var B=vec3.create();while(o.length>m)o.pop();var j;for(j=0;j<m;j++)i?f=i[j]:f=j,B[0]=t[f*3],B[1]=t[f*3+1],B[2]=t[f*3+2],vec3.scale(B,vec3.dot(B,u[f]),L),vec3.subtract(u[f],L,L),vec3.normalize(L),o[f*4]=L[0],o[f*4+1]=L[1],o[f*4+2]=L[2],o[f*4+3]=vec3.dot(vec3.cross(B,u[f]),a[f])<0?-1:1;return s?e.buffers.tangent_buffer.refresh():e.buffers.tangent_buffer=new Jax.NormalBuffer(o),e.buffers.tangent_buffer},Jax.Mesh.prototype.eachTriangle=function(e){function o(t,n,r){var o,u,a,f=!1;i?(f=!0,o=s[i[t]],u=s[i[n]],a=s[i[r]]):(f=!1,o=s[t],u=s[n],a=s[r]);if(!o||!u||!a)return;e(o.array,u.array,a.array)}var t=this,n,r,i=t.getIndexBuffer(),s=t.vertices;if(s.length==0)return;if(i){if(i.length==0)return;i=i.getTypedArray(),n=i.length}else n=s.length;switch(t.draw_mode){case GL_TRIANGLE_STRIP:for(r=2;r<n;r+=2)o(r-2,r-1,r),o(r,r-1,r+1);break;case GL_TRIANGLES:for(r=0;r<n;r+=3)o(r,r+1,r+2);break;case GL_TRIANGLE_FAN:for(r=2;r<n;r++)o(0,r-1,r);break;default:return}},Jax.Mesh.prototype.buildTriangles=function(){var e=this;e.triangles.clear(),e.eachTriangle(function(t,n,r){var i=new Jax.Geometry.Triangle;i.assign(t,n,r),e.triangles.push(i)})},Jax.Mesh.prototype.calculateBounds=function(e){var t=this;e.length==0?(t.bounds.left=t.bounds.right=0,t.bounds.top=t.bounds.bottom=0,t.bounds.front=t.bounds.back=0,t.bounds.width=t.bounds.height=t.bounds.depth=0):(t.bounds.left=t.bounds.right=null,t.bounds.top=t.bounds.bottom=null,t.bounds.front=t.bounds.back=null,t.bounds.width=t.bounds.height=t.bounds.depth=null);var n,r;for(n=0;n<e.length;n++){r=e[n];if(t.bounds.left==null||r<t.bounds.left)t.bounds.left=r;if(t.bounds.right==null||r>t.bounds.right)t.bounds.right=r;r=e[++n];if(t.bounds.bottom==null||r<t.bounds.bottom)t.bounds.bottom=r;if(t.bounds.top==null||r>t.bounds.top)t.bounds.top=r;r=e[++n];if(t.bounds.front==null||r>t.bounds.front)t.bounds.front=r;if(t.bounds.back==null||r<t.bounds.back)t.bounds.back=r}t.bounds.width=t.bounds.right-t.bounds.left,t.bounds.height=t.bounds.top-t.bounds.bottom,t.bounds.depth=t.bounds.front-t.bounds.back},Jax.Mesh.prototype.calculateNormals=function(){var e=this,t=e.getTriangles(),n={},r;for(r=0;r<t.length;r++){var i=t[r];n[i.a]=n[i.a]||[],n[i.b]=n[i.b]||[],n[i.c]=n[i.c]||[],n[i.a].push(i.getNormal()),n[i.b].push(i.getNormal()),n[i.c].push(i.getNormal())}var s=vec3.create();e.dataRegion.remap(e.normalData,t.length*9);for(r=0;r<e.vertices.length;r++){var o=e.vertices[r].array;if(n[o]){s[0]=s[1]=s[2]=0;for(var u=0;u<n[o].length;u++)vec3.add(s,n[o][u],s);vec3.scale(s,1/n[o].length),vec3.set(s,e.normals[r].array)}}e.buffers.normal_buffer.refresh()},Jax.Scene={},Jax.Scene.ILLUMINATION_PASS=1,Jax.Scene.AMBIENT_PASS=2,Jax.Scene.SHADOWMAP_PASS=3,Jax.Geometry={DISJOINT:0,COINCIDE:1,INTERSECT:2},Jax.Geometry.Line=function(){var e={},t=Jax.Class.create({initialize:function(e,t){this.a=vec3.create(),this.b=vec3.create(),this.normal=vec3.create(),this.length=0,arguments.length&&this.set(e,t)},set:function(e,t){return vec3.set(e,this.a),vec3.set(t,this.b),vec3.subtract(t,e,this.normal),this.length=vec3.length(this.normal),vec3.normalize(this.normal),this},contains:function(t){var n=vec3.subtract(this.b,this.a,e.ba||(e.ba=vec3.create())),r=vec3.subtract(t,this.a,e.ba||(e.pa=vec3.create())),i=vec3.subtract(this.a,this.b,e.ba||(e.ab=vec3.create())),s=vec3.subtract(t,this.b,e.ba||(e.pb=vec3.create()));return vec3.normalize(n),vec3.normalize(r),vec3.normalize(i),vec3.normalize(s),Math.equalish(n,r)&&Math.equalish(i,s)},intersectLineSegment:function(t,n){var r=vec3.subtract(this.b,this.a,vec3.create()),i=vec3.subtract(t.b,t.a,vec3.create()),s=vec3.subtract(this.a,t.a,vec3.create()),o=r[0]*i[1]-r[1]*i[0],u=n&&!(n instanceof Jax.Geometry.Line);if(Math.abs(o)<Math.EPSILON){if(r[0]*s[1]-r[1]*s[0]!=0||i[0]*s[1]-i[1]*s[0]!=0)return Jax.Geometry.DISJOINT;var a=vec3.dot(r,r),f=vec3.dot(i,i);if(a==0&&f==0)return Math.equalish(this.a,t.a)?(n&&(u?vec3.set(t.a,n):vec3.set(t.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;if(a==0)return t.contains(this.a)?(n&&(u?vec3.set(this.a,n):vec3.set(this.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;if(f==0)return this.contains(t.a)?(n&&(u?vec3.set(t.a,n):vec3.set(t.a,n.a)),Jax.Geometry.INTERSECT):Jax.Geometry.DISJOINT;var l,c,h=vec3.subtract(this.a,t.a,vec3.create());i[0]!=0?(l=s[0]/i[0],c=h[0]/i[0]):(l=s[1]/i[1],c=h[1]/i[1]);if(l>c){var p=l;l=c,c=p}if(l>1||c<0)return Jax.Geometry.DISJOINT;l=l<0?0:l,c=c>1?1:c;if(l==c&&t){if(n){var d=u?n:n.a;vec3.add(t.a,vec3.scale(i,l,d),d)}return Jax.Geometry.INTERSECT}if(n)if(u){var v=e.tmp||(e.tmp=vec3.create());vec3.add(t.a,vec3.scale(i,l,n),n),vec3.add(t.b,vec3.scale(i,c,v),n),vec3.scale(n,.5,n)}else vec3.add(t.a,vec3.scale(i,l,n.a),n),vec3.add(t.b,vec3.scale(i,c,n.b),n);return Jax.Geometry.COINCIDENT}var m=(i[0]*s[1]-i[1]*s[0])/o;if(m<0||m>1)return Jax.Geometry.DISJOINT;var g=(r[0]*s[1]-r[1]*s[0])/o;return g<0||g>1?Jax.Geometry.DISJOINT:(n&&vec3.add(this.a,vec3.scale(r,m,n),n),Jax.Geometry.INTERSECT)},toString:function(){return"[Line a:"+this.a+", b:"+this.b+"]"}});return Object.defineProperty(t.prototype,0,{get:function(){return this.a},set:function(e){return this.a=e},enumerable:!1,configurable:!1}),Object.defineProperty(t.prototype,1,{get:function(){return this.b},set:function(e){return this.b=e},enumerable:!1,configurable:!1}),t}(),Jax.Geometry.Plane=function(){function t(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r}var e={},n=Jax.Class.create({toString:function(){return"[Plane normal:"+this.normal+"; D:"+this.d+"]"},intersectTriangle:function(t,n){var r=this.classify(t.a),i=this.classify(t.b),s=this.classify(t.c),o=r*i,u=i*s;if(o>0&&u>0)return!1;if(!n)return!0;var a,f,l;o>0?(f=t.a,l=t.b,a=t.c):u>0?(a=t.a,f=t.b,l=t.c):(f=t.a,a=t.b,l=t.c);var c=e.tri_seg1=e.tri_seg1||new Jax.Geometry.Line,h=e.tri_seg2=e.tri_seg2||new Jax.Geometry.Line;c.set(a,f),h.set(a,l);var p=e.tri_p1=e.tri_p1||vec3.create(),d=e.tri_p2=e.tri_p2||vec3.create();return this.intersectLineSegment(c,p),this.intersectLineSegment(h,d),n.set(p,d)},intersectLineSegment:function(t,n){var r=vec3.subtract(t.b,t.a,e.lineseg_u=e.lineseg_u||vec3.create()),i=vec3.subtract(t.a,this.point,e.lineseg_w=e.lineseg_w||vec3.create()),s=vec3.dot(this.normal,r),o=-vec3.dot(this.normal,i);if(Math.abs(s)<Math.EPSILON)return o==0?Jax.Geometry.COINCIDE:Jax.Geometry.DISJOINT;var u=o/s;return u<0||u>1?Jax.Geometry.DISJOINT:(n&&vec3.add(t.a,vec3.scale(r,u,n),n),Jax.Geometry.INTERSECT)},intersectRay:function(e,t){var n=vec3.dot(this.normal,e)+this.d,r=vec3.dot(this.normal,t);if(r==0)return!1;var i=-(n/r);return-(n/r)},intersectPlane:function(t,n){var r=this.d,i=t.d,s=this.normal,o=t.normal,u=e.u=e.u||vec3.create();vec3.cross(s,o,u);var a=u[0]>=0?u[0]:-u[0],f=u[1]>=0?u[1]:-u[1],l=u[2]>=0?u[2]:-u[2];if(a+f+l<Math.EPSILON)return Math.equalish(r,i)?Jax.Geometry.COINCIDE:Jax.Geometry.DISJOINT;if(n){var c;a>f?a>l?c=0:c=2:f>l?c=1:c=2;var h=e.iP=e.iP||vec3.create();switch(c){case 0:h[0]=0,h[1]=(i*s[2]-r*o[2])/u[0],h[2]=(r*o[1]-i*s[1])/u[0];break;case 1:h[0]=(r*o[2]-i*s[2])/u[1],h[1]=0,h[2]=(i*s[0]-r*o[0])/u[1];break;case 2:h[0]=(i*s[1]-r*o[1])/u[2],h[1]=(r*o[0]-i*s[0])/u[2],h[2]=0}vec3.set(h,n[0]),vec3.add(h,u,n[1])}return Jax.Geometry.INTERSECT},initialize:function(e){this.point=vec3.create(),this.normal=vec3.create([0,1,0]),this.d=0,arguments.length&&this.set.apply(this,arguments)},classify:function(e){return e.array?vec3.dot(this.normal,e.array)+this.d:vec3.dot(this.normal,e)+this.d},set:function(){if(arguments.length==2)vec3.set(arguments[1],this.normal),this.d=-vec3.dot(arguments[1],arguments[0]);else{var e=this.normal,t=vec3.create(),n=arguments;arguments.length!=3&&(n=arguments[0]),typeof n[0]=="object"&&n[0].array?(vec3.subtract(n[1].array,n[0].array,e),vec3.subtract(n[2].array,n[0].array,t),vec3.normalize(vec3.cross(e,t,this.normal)),this.d=-vec3.dot(this.normal,n[0].array)):(vec3.subtract(n[1],n[0],e),vec3.subtract(n[2],n[0],t),vec3.normalize(vec3.cross(e,t,this.normal)),this.d=-vec3.dot(this.normal,n[0]))}return vec3.scale(this.normal,this.d,this.point),this},setCoefficients:function(e,t,n,r){var i=Math.sqrt(e*e+t*t+n*n);return this.normal[0]=e/i,this.normal[1]=t/i,this.normal[2]=n/i,this.d=r/i,this},whereis:function(){var e;arguments.length==3?e=arguments:arguments[0].array?e=arguments[0].array:e=arguments[0];var t=this.distance(e);return t>0?Jax.Geometry.Plane.FRONT:t<0?Jax.Geometry.Plane.BACK:Jax.Geometry.Plane.INTERSECT}});return n.prototype.distance=n.prototype.classify,n}(),Jax.Geometry.Plane.FRONT=1,Jax.Geometry.Plane.BACK=2,Jax.Geometry.Plane.INTERSECT=3,Jax.Geometry.Triangle=function(){function t(t,n,r){var i=e.slowtri_line1=e.slowtri_line1||new Jax.Geometry.Line,s=e.slowtri_line2=e.slowtri_line2||new Jax.Geometry.Line;return t.plane.intersectTriangle(n,i)&&n.plane.intersectTriangle(t,s)?(i.intersectLineSegment(s,r),!0):!1}var e={},n=Jax.Class.create({initialize:function(e,t,n){this.a=vec3.create(),this.b=vec3.create(),this.c=vec3.create(),this.center=vec3.create(),this.normal=vec3.create(),arguments.length>0&&this.set.apply(this,arguments)},set:function(e,t,n){return this.assign(vec3.create(e),vec3.create(t),vec3.create(n))},assign:function(t,n,r){this.a=t,this.b=n,this.c=r,vec3.add(t,n,this.center),vec3.add(r,this.center,this.center),vec3.scale(this.center,1/3);var i=e.tmp=e.tmp||vec3.create();return vec3.subtract(n,t,this.normal),vec3.subtract(r,t,i),vec3.cross(this.normal,i,this.normal),vec3.normalize(this.normal),this.updateDescription(),this},getNormal:function(){return this.normal},toString:function(){return"Triangle: "+this.a+"; "+this.b+"; "+this.c},intersectRay:function(e,t,n,r){var i=this._p=this._p||new Jax.Geometry.Plane;i.set(this.a,this.b,this.c);var s=vec3.dot(i.normal,t);if(Math.abs(s)<Math.EPSILON)return!1;var o=-(i.d+vec3.dot(i.normal,e))/s;return o<=0?!1:r!=undefined&&o>r?!1:(vec3.set(t,n),vec3.scale(n,o,n),vec3.add(e,n,n),this.pointInTri(n)?(n[3]=o,!0):!1)},intersectSphere:function(t,n,r){var i=this._p=this._p||new Jax.Geometry.Plane;i.set(this.a,this.b,this.c);var s=i.classify(t);if(Math.abs(s)>n)return!1;var o=this._point=this._point||vec3.create();vec3.scale(i.normal,s,o),vec3.subtract(t,o,o);if(this.pointInTri(o))return r&&vec3.set(o,r),!0;var u=e.v=e.v||[],a=e.u=e.u||vec3.create(),f=e.pa=e.pa||vec3.create(),l=e.tmp=e.tmp||vec3.create(),c=n*n;u[0]=this.a,u[1]=this.b,u[2]=this.c,u[3]=this.a;for(var h=0;h<3;h++){vec3.subtract(u[h+1],u[h],a),vec3.subtract(t,u[h],f);var p=vec3.dot(a,f)/vec3.dot(a,a);p<0?vec3.set(u[h],l):p>1?vec3.set(u[h+1],l):(vec3.scale(a,p,l),vec3.add(u[h],l,l)),r&&vec3.set(l,r),vec3.subtract(t,l,l);var d=vec3.dot(l,l);if(d<=c)return!0}return!1},intersectTriangle:function(e,n){return n?t(this,e,n):Jax.Geometry.Triangle.tri_tri_intersect(this.a,this.b,this.c,e.a,e.b,e.c)},updateDescription:function(){var e=this.plane=this.plane||new Jax.Geometry.Plane(this.a,this.b,this.c),t=e.normal,n=[Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)];return n[0]>n[1]?n
[0]>n[2]?(this._i1=1,this._i2=2):(this._i1=0,this._i2=1):n[1]>n[2]?(this._i1=0,this._i2=2):(this._i1=0,this._i2=1),this},pointInTri:function(e){var t=this._u=this._u||vec3.create(),n=this._v=this._v||vec3.create();t[0]=e[this._i1]-this.a[this._i1],t[1]=this.b[this._i1]-this.a[this._i1],t[2]=this.c[this._i1]-this.a[this._i1],n[0]=e[this._i2]-this.a[this._i2],n[1]=this.b[this._i2]-this.a[this._i2],n[2]=this.c[this._i2]-this.a[this._i2];var r,i;if(t[1]==0){i=t[0]/t[2];if(!(i>=0&&i<=1))return!1;r=(n[0]-i*n[2])/n[1]}else{i=(n[0]*t[1]-t[0]*n[1])/(n[2]*t[1]-t[2]*n[1]);if(!(i>=0&&i<=1))return!1;r=(t[0]-i*t[2])/t[1]}return r>=0&&r+i<=1}});return Object.defineProperty(n.prototype,0,{get:function(){return this.a},set:function(e){return this.a=e},enumerable:!1,configurable:!1}),Object.defineProperty(n.prototype,1,{get:function(){return this.b},set:function(e){return this.b=e},enumerable:!1,configurable:!1}),Object.defineProperty(n.prototype,2,{get:function(){return this.c},set:function(e){return this.c=e},enumerable:!1,configurable:!1}),n}(),function(){function t(t,n,r,i,s,o,u){var a=e.tritri_A=e.tritri_A||vec3.create(),f,l;a[0]=Math.abs(t[0]),a[1]=Math.abs(t[1]),a[2]=Math.abs(t[2]),a[0]>a[1]?a[0]>a[2]?(f=1,l=2):(f=0,l=1):a[2]>a[1]?(f=0,l=1):(f=0,l=2);var c,h,p,d,v,m,g,y,b;c=r[f]-n[f],h=r[l]-n[l],p=s[f]-o[f],d=s[l]-o[l],v=n[f]-s[f],m=n[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=n[f]-o[f],m=n[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=n[f]-u[f],m=n[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var c,h,p,d,v,m,g,y,b;c=i[f]-r[f],h=i[l]-r[l],p=s[f]-o[f],d=s[l]-o[l],v=r[f]-s[f],m=r[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=r[f]-o[f],m=r[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=r[f]-u[f],m=r[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var c,h,p,d,v,m,g,y,b;c=n[f]-i[f],h=n[l]-i[l],p=s[f]-o[f],d=s[l]-o[l],v=i[f]-s[f],m=i[l]-s[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=o[f]-u[f],d=o[l]-u[l],v=i[f]-o[f],m=i[l]-o[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}p=u[f]-s[f],d=u[l]-s[l],v=i[f]-u[f],m=i[l]-u[l],b=h*p-c*d,y=d*v-p*m;if(b>0&&y>=0&&y<=b||b<0&&y<=0&&y>=b){g=c*m-h*v;if(b>0){if(g>=0&&g<=b)return!0}else if(g<=0&&g>=b)return!0}var w,E,S,x,T,N;w=o[l]-s[l],E=-(o[f]-s[f]),S=-w*s[f]-E*s[l],x=w*n[f]+E*n[l]+S,w=u[l]-o[l],E=-(u[f]-o[f]),S=-w*o[f]-E*o[l],T=w*n[f]+E*n[l]+S,w=s[l]-u[l],E=-(s[f]-u[f]),S=-w*u[f]-E*u[l],N=w*n[f]+E*n[l]+S;if(x*T>0&&x*N>0)return!0;var w,E,S,x,T,N;return w=r[l]-n[l],E=-(r[f]-n[f]),S=-w*n[f]-E*n[l],x=w*s[f]+E*s[l]+S,w=i[l]-r[l],E=-(i[f]-r[f]),S=-w*r[f]-E*r[l],T=w*s[f]+E*s[l]+S,w=n[l]-i[l],E=-(n[f]-i[f]),S=-w*i[f]-E*i[l],N=w*s[f]+E*s[l]+S,x*T>0&&x*N>0?!0:!1}var e;typeof e=="undefined"&&(e={}),Jax.Geometry.Triangle.tri_tri_intersect=function(n,r,i,s,o,u){var a=e.tritri_E1=e.tritri_E1||vec3.create(),f=e.tritri_E2=e.tritri_E2||vec3.create(),l=e.tritri_N1=e.tritri_N1||vec3.create(),c=e.tritri_N2=e.tritri_N2||vec3.create(),h=e.tritri_D=e.tritri_D||vec3.create(),p=e.tritri_isect1=e.tritri_isect1||vec2.create(),d=e.tritri_isect2=e.tritri_isect2||vec2.create(),v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;vec3.subtract(r,n,a),vec3.subtract(i,n,f),vec3.cross(a,f,l),v=-vec3.dot(l,n),g=vec3.dot(l,s)+v,y=vec3.dot(l,o)+v,b=vec3.dot(l,u)+v,Math.abs(g)<Math.EPSILON&&(g=0),Math.abs(y)<Math.EPSILON&&(y=0),Math.abs(b)<Math.EPSILON&&(b=0),x=g*y,T=g*b;if(x>0&&T>0)return!1;vec3.subtract(o,s,a),vec3.subtract(u,s,f),vec3.cross(a,f,c),m=-vec3.dot(c,s),w=vec3.dot(c,n)+m,E=vec3.dot(c,r)+m,S=vec3.dot(c,i)+m,Math.abs(w)<Math.EPSILON&&(w=0),Math.abs(E)<Math.EPSILON&&(E=0),Math.abs(S)<Math.EPSILON&&(S=0),N=w*E,C=w*S;if(N>0&&C>0)return!1;vec3.cross(l,c,h),B=Math.abs(h[0]),k=0,P=Math.abs(h[1]),H=Math.abs(h[2]),P>B&&(B=P,k=1),H>B&&(B=H,k=2),L=n[k],A=r[k],O=i[k],M=s[k],_=o[k],D=u[k];try{if(N>0)p[0]=O+(L-O)*S/(S-w),p[1]=O+(A-O)*S/(S-E);else if(C>0)p[0]=A+(L-A)*E/(E-w),p[1]=A+(O-A)*E/(E-S);else if(E*S>0||w!=0)p[0]=L+(A-L)*w/(w-E),p[1]=L+(O-L)*w/(w-S);else if(E!=0)p[0]=A+(L-A)*E/(E-w),p[1]=A+(O-A)*E/(E-S);else{if(S==0)return t(l,n,r,i,s,o,u);p[0]=O+(L-O)*S/(S-w),p[1]=O+(A-O)*S/(S-E)}if(x>0)d[0]=D+(M-D)*b/(b-g),d[1]=D+(_-D)*b/(b-y);else if(T>0)d[0]=_+(M-_)*y/(y-g),d[1]=_+(D-_)*y/(y-b);else if(y*b>0||g!=0)d[0]=M+(_-M)*g/(g-y),d[1]=M+(D-M)*g/(g-b);else if(y!=0)d[0]=_+(M-_)*y/(y-g),d[1]=_+(D-_)*y/(y-b);else{if(b==0)return t(l,n,r,i,s,o,u);d[0]=D+(M-D)*b/(b-g),d[1]=D+(_-D)*b/(b-y)}}catch(j){if(j==1)return t(l,n,r,i,s,o,u);throw j}if(p[0]>p[1]){var H;H=p[0],p[0]=p[1],p[1]=H}if(d[0]>p[1]){var H;H=d[0],d[0]=p[1],p[1]=H}return p[1]<d[0]||d[1]<p[0]?!1:!0}}(),Jax.Scene.Frustum=function(){function f(e){function t(t,n,r){var i=[],s=e.mv,o=e.p,u=mat4.set(s,mat4.create());mat4.inverse(u,u),mat4.multiply(o,u,u),mat4.inverse(u,u),i[0]=t,i[1]=n,i[2]=r,i[3]=1;var a=mat4.multiplyVec4(u,i);return a[3]==0?[0,0,0]:(a[3]=1/a[3],[a[0]*a[3],a[1]*a[3],a[2]*a[3]])}var n=t(-1,1,-1),r=t(1,1,-1),i=t(-1,-1,-1),s=t(1,-1,-1),o=t(-1,1,1),u=t(1,1,1),a=t(-1,-1,1),f=t(1,-1,1);return{ntl:n,ntr:r,nbl:i,nbr:s,ftl:o,ftr:u,fbl:a,fbr:f}}function l(e,t,n,r,i){if(!e.mv||!e.p)return a;var s,f,l=0,c;n/=2,r/=2,i/=2;var h=t[0]+n,p=t[0]-n,d=t[1]+r,v=t[1]-r,m=t[2]+i,g=t[2]-i;for(s in e.planes){c=e.planes[s],f=0,c.distance(h,d,m)>0&&f++,c.distance(p,d,m)>0&&f++,c.distance(h,v,m)>0&&f++,c.distance(p,v,m)>0&&f++,c.distance(h,d,g)>0&&f++,c.distance(p,d,g)>0&&f++,c.distance(h,v,g)>0&&f++,c.distance(p,v,g)>0&&f++;if(f==0)return o;f==8&&l++}return l==6?a:u}function c(o){var u=o.planes,a=f(o);u[r].set(a.ntr,a.ntl,a.ftl),u[n].set(a.nbl,a.nbr,a.fbr),u[t].set(a.ntl,a.nbl,a.fbl),u[e].set(a.nbr,a.ntr,a.fbr),u[s].set(a.ntl,a.ntr,a.nbr),u[i].set(a.ftr,a.ftl,a.fbl)}var e=0,t=1,n=2,r=3,i=4,s=5,o=Jax.Geometry.Plane.BACK,u=Jax.Geometry.Plane.INTERSECT,a=Jax.Geometry.Plane.FRONT,h=Jax.Class.create({initialize:function(e,t){this.planes={};for(var n=0;n<6;n++)this.planes[n]=new Jax.Geometry.Plane;this.setMatrices(e,t)},update:function(){return this.mv&&this.p&&(c(this),this.fireEvent("updated")),this},setViewMatrix:function(e){return this.setMatrices(e,this.p)},setProjectionMatrix:function(e){return this.setMatrices(this.mv,e)},setMatrices:function(e,t){return this.mv=e,this.p=t,this.update(),this},point:function(e){if(!this.mv||!this.p)return a;arguments.length==3&&(e=[arguments[0],arguments[1],arguments[2]]);for(var t=0;t<6;t++)if(this.planes[t].distance(e)<0)return o;return a},sphere:function(e,t){if(!this.mv||!this.p)return a;arguments.length==4&&(e=[arguments[0],arguments[1],arguments[2]],t=arguments[3]);var n=a,r;for(var i=0;i<6;i++){r=this.planes[i].distance(e);if(r<-t)return o;r<t&&(n=u)}return n},cube:function(e){if(arguments.length==2)return l(this,arguments[0],arguments[1],arguments[1],arguments[1]);if(arguments.length==4)return l(this,arguments[0],arguments[1],arguments[2],arguments[3]);if(!this.mv||!this.p)return a;arguments.length>1&&(e=arguments);var t,n,r=0,i,s=e.length,f;for(t in this.planes){f=this.planes[t],n=0;for(i=0;i<s;i++)f.distance(e[i])>0&&n++;if(n==0)return o;n==s&&r++}return r==6?a:u},sphereVisible:function(e,t){return this.sphere.apply(this,arguments)!=o},pointVisible:function(e){return this.point.apply(this,arguments)!=o},cubeVisible:function(e){return this.cube.apply(this,arguments)!=o},isValid:function(){return this.p&&this.mv},getRenderable:function(){function n(e,t){t.push(e.ntl[0],e.ntl[1],e.ntl[2]),t.push(e.ntr[0],e.ntr[1],e.ntr[2]),t.push(e.ntr[0],e.ntr[1],e.ntr[2]),t.push(e.nbr[0],e.nbr[1],e.nbr[2]),t.push(e.nbr[0],e.nbr[1],e.nbr[2]),t.push(e.nbl[0],e.nbl[1],e.nbl[2]),t.push(e.nbl[0],e.nbl[1],e.nbl[2]),t.push(e.ntl[0],e.ntl[1],e.ntl[2]),t.push(e.ftl[0],e.ftl[1],e.ftl[2]),t.push(e.ftr[0],e.ftr[1],e.ftr[2]),t.push(e.ftr[0],e.ftr[1],e.ftr[2]),t.push(e.fbr[0],e.fbr[1],e.fbr[2]),t.push(e.fbr[0],e.fbr[1],e.fbr[2]),t.push(e.fbl[0],e.fbl[1],e.fbl[2]),t.push(e.fbl[0],e.fbl[1],e.fbl[2]),t.push(e.ftl[0],e.ftl[1],e.ftl[2]),t.push(e.ntl[0],e.ntl[1],e.ntl[2]),t.push(e.ftl[0],e.ftl[1],e.ftl[2]),t.push(e.nbl[0],e.nbl[1],e.nbl[2]),t.push(e.fbl[0],e.fbl[1],e.fbl[2]),t.push(e.ntr[0],e.ntr[1],e.ntr[2]),t.push(e.ftr[0],e.ftr[1],e.ftr[2]),t.push(e.nbr[0],e.nbr[1],e.nbr[2]),t.push(e.fbr[0],e.fbr[1],e.fbr[2])}if(this.renderable)return this.renderable;var e=this.renderable=new Jax.Model({mesh:new Jax.Mesh});e.upToDate=!1;var t=this;return e.mesh.init=function(e,t){this.draw_mode=GL_LINES;for(var n=0;n<24;n++)e.push(0,0,0),t.push(1,1,0,1)},e.update=null,t.addEventListener("updated",function(){if(!t.isValid())return;e.upToDate=!0;var r=e.mesh.getVertexBuffer();if(!r)return;var i=r.js;i.clear();var s=f(t);n(s,i),r.refresh()}),e}});return h.INSIDE=a,h.OUTSIDE=o,h.INTERSECT=u,h.addMethods(Jax.Events.Methods),h}(),Jax.POINT_LIGHT=1,Jax.SPOT_LIGHT=2,Jax.DIRECTIONAL_LIGHT=3,Jax.Scene.LightSource=function(){function e(e){if(e.camera.projection)return;switch(e.type){case Jax.DIRECTIONAL_LIGHT:e.camera.ortho({left:-1,right:1,top:1,bottom:-1,near:-1,far:1}),e.camera.setPosition(0,0,0);break;case Jax.POINT_LIGHT:e.camera.perspective({fov:45,near:.01,far:500,width:2048,height:2048});break;case Jax.SPOT_LIGHT:e.camera.perspective({near:.1,far:500,fov:60,width:2048,height:2048});break;default:throw new Error("Unexpected light type: "+e.type)}}return Jax.Model.create({initialize:function($super,t){t=Jax.Util.normalizeOptions(t,{enabled:!0,type:Jax.POINT_LIGHT,color:{ambient:[0,0,0,1],diffuse:[1,1,1,1],specular:[1,1,1,1]},position:[0,0,0],direction:[0,0,-1],angle:Math.PI/6,attenuation:{constant:0,linear:.02,quadratic:0},spot_exponent:0,shadowcaster:!0}),t.shadow_caster=t.shadowcaster,delete t.shadowcaster,typeof t.type=="string"&&(t.type=Jax[t.type]||t.type),t.color.ambient=Jax.Util.colorize(t.color.ambient),t.color.diffuse=Jax.Util.colorize(t.color.diffuse),t.color.specular=Jax.Util.colorize(t.color.specular),$super(t);var n=this;this.camera.addEventListener("updated",function(){n.invalidate()}),this.spotExponent=this.spot_exponent,delete this.spot_exponent,this.isShadowCaster()&&(this.shadowMatrix=mat4.create(),this.framebuffers=[new Jax.Framebuffer({width:1024,height:1024,depth:!0,color:GL_RGBA}),new Jax.Framebuffer({width:1024,height:1024,depth:!0,color:GL_RGBA})],e(this))},format:function(){function i(){for(t=0;t<arguments.length;t++)r._format[n++]=arguments[t]}this._format=this._format||new glMatrixArrayType(Jax.Scene.LightSource.STRUCT_SIZE);var e,t,n=0,r=this;for(e=0;e<arguments.length;e++)switch(arguments[e]){case Jax.Scene.LightSource.POSITION:i.apply(this,this.getPosition());break;case Jax.Scene.LightSource.DIRECTION:i.apply(this,this.getDirection());break;case Jax.Scene.LightSource.AMBIENT:i.apply(this,this.getAmbientColor());break;case Jax.Scene.LightSource.DIFFUSE:i.apply(this,this.getDiffuseColor());break;case Jax.Scene.LightSource.SPECULAR:i.apply(this,this.getSpecularColor());break;case Jax.Scene.LightSource.CONSTANT_ATTENUATION:i(this.getConstantAttenuation());break;case Jax.Scene.LightSource.LINEAR_ATTENUATION:i(this.getLinearAttenuation());break;case Jax.Scene.LightSource.QUADRATIC_ATTENUATION:i(this.getQuadraticAttenuation());break;case Jax.Scene.LightSource.SPOTLIGHT_EXPONENT:i(this.getSpotExponent());break;case Jax.Scene.LightSource.SPOTLIGHT_COS_CUTOFF:i(this.getSpotCosCutoff());break;default:throw new Error("Unexpected light source format descriptor: "+arguments[e])}return this._format},getPosition:function(){return e(this),this.camera.getPosition()},getDirection:function(){return e(this),this.camera.getViewVector()},setEnabled:function(e){this.enabled=e},enable:function(){this.setEnabled(!0)},disable:function(){this.setEnabled(!1)},isEnabled:function(){return this.enabled},getType:function(){return this.type},getDiffuseColor:function(){return this.color.diffuse},getAmbientColor:function(){return this.color.ambient},getSpecularColor:function(){return this.color.specular},getConstantAttenuation:function(){return this.attenuation.constant},getQuadraticAttenuation:function(){return this.attenuation.quadratic},getLinearAttenuation:function(){return this.attenuation.linear},getAngle:function(){return this.angle},getSpotExponent:function(){return this.spotExponent},getSpotCosCutoff:function(){return Math.cos(this.angle)},getShadowMapTexture:function(t){return e(this),this.framebuffers[0].getTexture(t,0)},getShadowMapTextures:function(t){return e(this),[this.framebuffers[0].getTexture(t,0),this.framebuffers[1].getTexture(t,0)]},isShadowMapEnabled:function(){return!!this.framebuffers&&!!this.isShadowcaster()},getShadowMatrix:function(){return this.shadowMatrix},registerCaster:function(e){function n(){t.invalidate()}var t=this;e.camera.addEventListener("updated",n),this.invalidate()},unregisterCaster:function(e){},getDPShadowNear:function(){return e(this),this.camera.projection.near},getDPShadowFar:function(){return e(this),this.camera.projection.far},invalidate:function(){this.valid=!1},render:function(e,t,n){if(!this.valid){this.max_distance=Math.sqrt(this.getIntensity()/.001)-1;var r=e.current_pass;e.current_pass=Jax.Scene.SHADOWMAP_PASS;if(this.isShadowCaster())try{this.updateShadowMap(e,this.boundingRadius,t,n)}catch(i){Jax.getGlobal().console&&Jax.getGlobal().console.log&&Jax.getGlobal().console.log(i.toString()),this.disableShadows()}this.valid=!0,e.current_pass=r}this.renderWithinRange(e,t,n)},renderWithinRange:function(e,t,n){for(var r=0;r<t.length;r++){n.model_index=r;if(n.force||t[r].isLit()){var i=vec3.distance(this.camera.getPosition(),t[r].camera.getPosition())-t[r].getBoundingSphereRadius();i<this.max_distance&&t[r].render(e,n)}}},getIntensity:function(){var e=this.color;return(e.ambient[0]*e.ambient[3]+e.ambient[1]*e.ambient[3]+e.ambient[2]*e.ambient[3]+e.diffuse[0]*e.diffuse[3]+e.diffuse[1]*e.diffuse[3]+e.diffuse[2]*e.diffuse[3]+e.specular[0]*e.specular[3]+e.specular[1]*e.specular[3]+e.specular[2]*e.specular[3])/3},updateShadowMap:function(t,n,r,i){i=Jax.Util.normalizeOptions(i,{force:!0}),this.max_distance<n&&(this.max_distance=n),e(this);var s=this,o=this.shadowMatrix,u=vec3.length(this.camera.getPosition()),a=u-n;a<.01&&(a=.01);if(this.type==Jax.DIRECTIONAL_LIGHT)this.camera.ortho({left:-n,right:n,top:n,bottom:-n,near:-n,far:n}),this.camera.setPosition(0,0,0);else if(this.type==Jax.SPOT_LIGHT){var f=Math.radToDeg(2*Math.atan(n/u));f=60,this.camera.perspective({near:a,far:a+2*n,fov:f,width:2048,height:2048})}else if(this.type==Jax.POINT_LIGHT){var l=Jax.Material.find("paraboloid-depthmap");t.glDisable(GL_BLEND),t.glEnable(GL_CULL_FACE),t.glCullFace(GL_FRONT),t.glEnable(GL_POLYGON_OFFSET_FILL),t.glPolygonOffset(2,2),t.pushMatrix(function(){i.direction=1,i.material=l,s.framebuffers[0].bind(t,function(){s.framebuffers[0].viewport(t),t.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),t.loadViewMatrix(s.camera.getTransformationMatrix()),mat4.set(t.getInverseViewMatrix(),o),s.renderWithinRange(t,r,i)}),i.direction=-1,s.framebuffers[1].bind(t,function(){s.framebuffers[1].viewport(t),t.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),t.loadViewMatrix(s.camera.getTransformationMatrix()),s.renderWithinRange(t,r,i)}),t.glDisable(GL_POLYGON_OFFSET_FILL),t.glEnable(GL_BLEND),t.glCullFace(GL_BACK),t.glDisable(GL_CULL_FACE),t.glViewport(0,0,t.canvas.width,t.canvas.height)});return}i.material="depthmap",this.framebuffers[0].bind(t,function(){s.framebuffers[0].viewport(t),t.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),t.pushMatrix(function(){s.framebuffers[0].viewport(t),t.matrix_stack.loadProjectionMatrix(s.camera.getProjectionMatrix()),t.matrix_stack.loadViewMatrix(s.camera.getTransformationMatrix()),mat4.identity(o),o[0]=o[5]=o[10]=o[12]=o[13]=o[14]=.5,mat4.multiply(o,t.getModelViewProjectionMatrix()),t.glEnable(GL_CULL_FACE),t.glCullFace(GL_FRONT),t.glDisable(GL_BLEND),t.glEnable(GL_POLYGON_OFFSET_FILL),t.glPolygonOffset(2,2),s.renderWithinRange(t,r,i),t.glDisable(GL_POLYGON_OFFSET_FILL),t.glEnable(GL_BLEND),t.glCullFace(GL_BACK),t.glDisable(GL_CULL_FACE)}),t.glViewport(0,0,t.canvas.width,t.canvas.height)})}})}(),Jax.Scene.LightSource.POSITION=1,Jax.Scene.LightSource.DIRECTION=2,Jax.Scene.LightSource.AMBIENT=3,Jax.Scene.LightSource.DIFFUSE=4,Jax.Scene.LightSource.SPECULAR=5,Jax.Scene.LightSource.CONSTANT_ATTENUATION=6,Jax.Scene.LightSource.LINEAR_ATTENUATION=7,Jax.Scene.LightSource.QUADRATIC_ATTENUATION=8,Jax.Scene.LightSource.SPOTLIGHT_EXPONENT=9,Jax.Scene.LightSource.SPOTLIGHT_COS_CUTOFF=10,Jax.Scene.LightSource.STRUCT_SIZE=23,Jax.Scene.LightManager=function(){return Jax.Class.create({initialize:function(e){this.context=e,this._lights=[],this.objects=[]},addObject:function(e){this.objects.push(e);for(var t=0;t<this._lights.length;t++)e.isShadowCaster()&&this._lights[t].registerCaster(e);this.recalculateBoundingRadius()},removeObject:function(e){if(this.objects[e]){var t=this.objects[e];this.objects.splice(e,1);for(var n=0;n<this._lights.length;n++)t.isShadowCaster()&&this._lights[n].unregisterCaster(t);return this.recalculateBoundingRadius(),t}for(var r=0;r<this.objects.length;r++)if(this.objects[r]==e)return this.removeObject(r)},getShadowCasters:function(){var e=[];for(var t=0;t<this.objects.length;t++)this.objects[t].isShadowCaster()&&e.push(this.objects[t]);return e},add:function(e){typeof e=="string"&&(e=Jax.Scene.LightSource.find(e));if(this._lights.length==Jax.max_lights)throw new Error("Maximum number of light sources in a scene has been exceeded! Try removing some first.");for(var t=0;t<this.objects.length;t++)this.objects[t].isShadowCaster()&&e.registerCaster(this.objects[t]);this._lights.push(e),e.boundingRadius=this.boundingRadius||0},recalculateBoundingRadius:function(){var e=null,t,n;for(t=0;t<this.objects.length;t++){n=vec3.length(this.objects[t].camera.getPosition())+this.objects[t].getBoundingSphereRadius();if(e==null||e<n)e=n}this.boundingRadius=e=e||0;for(t=0;t<this._lights.length;t++)this._lights[t].boundingRadius=e},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isEnabled:function(){return arguments.length==1?this._lights.length>arguments[0]?this._lights[arguments[0]].isEnabled():!1:this.enabled!=undefined?this.enabled:this._lights.length>0},count:function(){return this._lights.length},remove:function(e){var t=this._lights.splice(e,1);return this._lights.length==0&&delete this.enabled,t},illuminate:function(e,t){t=Jax.Util.normalizeOptions(t,{}),e.glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);var n;for(n=0;n<this._lights.length;n++)n==1&&e.glBlendFunc(GL_ONE,GL_ONE),this._current_light=n,this._lights[n].render(e,this.objects,t);n>0&&e.glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA),delete this._current_light},getDirection:function(e){return this.getLight(e).getDirection()},getPosition:function(e){return this.getLight(e).getPosition()},getLight:function(e){return e==undefined?this._current_light!=undefined?this._lights[this._current_light]:this.default_light=this.default_light||new Jax.Scene.LightSource:this._lights[e]},getType:function(e){return this.getLight(e).getType()},getDiffuseColor:function(e){return this.getLight(e).getDiffuseColor()},getSpecularColor:function(e){return this.getLight(e).getSpecularColor()},getAmbientColor:function(e){return this.getLight(e).getAmbientColor()},getConstantAttenuation:function(e){return this.getLight(e).getConstantAttenuation()},getLinearAttenuation:function(e){return this.getLight(e).getLinearAttenuation()},getQuadraticAttenuation:function(e){return this.getLight(e).getQuadraticAttenuation()},getSpotCosCutoff:function(e){return this.getLight(e).getSpotCosCutoff()},getSpotExponent:function(e){return this.getLight(e).getSpotExponent()}})}(),Jax.Camera=function(){function f(e,t){if(arguments.length==2)return c(e,t);var n=e._tmp[t];return n[0]=arguments[2],n[1]=arguments[3],n[2]=arguments[4],n}function l(e){return e._rotquat||(e._rotquat=quat4.create())}function c(u,a){var f=u.rotation,l=u._tmp[r],c=u._tmp[a];vec3.set(u.position,l);switch(a){case r:return l;case i:quat4.multiplyVec3(f,e,c);break;case s:quat4.multiplyVec3(f,n,c);break;case o:quat4.multiplyVec3(f,t,c);break;default:throw new Error("Unexpected buftype: "+a)}return c}function h(e){e.stale=!0,e.frustum_up_to_date=!1}function p(e){e.stale=!1;var t=c(e,r);mat4.fromRotationTranslation(e.rotation,t,e.matrices.mv),mat4.toInverseMat3(e.matrices.mv,e.matrices.n),mat3.transpose(e.matrices.n),e.fireEvent("matrixUpdated")}var e=[0,0,-1],t=[0,1,0],n=[1,0,0],r=0,i=1,s=2,o=3,u=4,a=5;return Jax.Class.create({initialize:function(){this._tmp=[vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create(),vec3.create()],this.rotation=quat4.create([0,0,0,1]),this.position=vec3.create([0,0,0]),this.matrices={mv:mat4.identity(mat4.create()),p:mat4.identity(mat4.create()),n:mat3.create()},this.frustum=new Jax.Scene.Frustum(this.matrices.mv,this.matrices.p),this.addEventListener("updated",function(){h(this)}),this.reset(),this.setFixedYawAxis(!0,vec3.UNIT_Y)},setFixedYawAxis:function(e,t){this.fixed_yaw=e,t&&(this.fixed_yaw_axis=vec3.create(t))},getFrustum:function(){return this.frustum_up_to_date||this.frustum.update(),this.frustum_up_to_date=!0,this.frustum},getPosition:function(){return vec3.create(this.position)},getViewVector:function(){return vec3.create(c(this,i))},getUpVector:function(){return vec3.create(c(this,o))},getRightVector:function(){return vec3.create(c(this,s))},ortho:function(e){typeof e.left=="undefined"&&(e.left=-1),typeof e.right=="undefined"&&(e.right=1),typeof e.top=="undefined"&&(e.top=1),typeof e.bottom=="undefined"&&(e.bottom=-1),typeof e.far=="undefined"&&(e.far=200),e.near=e.near||.01,mat4.ortho(e.left,e.right,e.bottom,e.top,e.near,e.far,this.matrices.p),this.projection={width:e.right-e.left,height:e.top-e.bottom,depth:e.near-e.far,left:e.left,right:e.right,near:e.near,far:e.far,top:e.top,bottom:e.bottom},this.fireEvent("matrixUpdated")},setPosition:function(){switch(arguments.length){case 1:vec3.set(arguments[0],this.position);break;case 3:vec3.set(arguments,this.position);break;default:throw new Error("Invalid arguments for Camera#setPosition")}return this.fireEvent("updated"),this},setDirection:function(e){var t;arguments.length==3?t=arguments:t=vec3.create(e),vec3.scale(t,-1),vec3.normalize(t);if(this.fixed_yaw){var n=vec3.normalize(vec3.cross(this.fixed_yaw_axis,t,vec3.create())),r=vec3.normalize(vec3.cross(t,n,vec3.create()));quat4.fromAxes(t,n,r,this.rotation)}else{var s=vec3.toQuatRotation(c(this,i),t,l(this));quat4.multiply(s,this.rotation,this.rotation)}return quat4.normalize(this.rotation),this.fireEvent("updated"),this},rotate:function(){var e=arguments[0],t;switch(arguments.length){case 2:t=arguments[1];break;case 4:t=this._tmp[0],t[0]=arguments[1],t[1]=arguments[2],t[2]=arguments[3];break;default:throw new Error("Invalid arguments")}return this.rotateWorld(e,quat4.multiplyVec3(this.rotation,t,this._tmp[0]))},rotateWorld:function(){var e=arguments[0],t;switch(arguments.length){case 2:t=arguments[1];break;case 4:t=this._tmp[0],t[0]=arguments[1],t[1]=arguments[2],t[2]=arguments[3];break;default:throw new Error("Invalid arguments")}var n=quat4.fromAngleAxis(e,t,l(this));return quat4.normalize(n),quat4.multiply(n,this.rotation,this.rotation),this.fireEvent("updated"),this},pitch:function(e){var t=c(this,s);this.rotateWorld(e,t)},yaw:function(e){var t;this.fixed_yaw?t=this.fixed_yaw_axis:t=c(this,o),this.rotateWorld(e,t)},roll:function(e){var t=c(this,i);this.rotateWorld(e,t)},reorient:function(e,t){return t&&this.setPosition(t),this.setDirection(e),this},orient:function(e,t){var n=null;Jax.environment!=Jax.PRODUCTION&&alert("Jax.Camera#orient is deprecated. Please use Jax.Camera#reorient instead.\n\n"+(new Error).stack);switch(arguments.length){case 1:e=f(this,i,e[0],e[1],e[2]),t=null;break;case 2:e=f(this,i,e[0],e[1],e[2]),t=f(this,o,t[0],t[1],t[2]);break;case 3:typeof arguments[0]=="number"?(e=f(this,i,arguments[0],arguments[1],arguments[2]),t=null):(e=f(this,i,e[0],e[1],e[2]),t=f(this,o,t[0],t[1],t[2]),n=f(this,r,arguments[2][0],arguments[2][1],arguments[2][2]));break;case 6:e=f(this,i,arguments[0],arguments[1],arguments[2]),t=f(this,o,arguments[3],arguments[4],arguments[5]);break;case 9:e=f(this,i,arguments[0],arguments[1],arguments[2]),t=f(this,o,arguments[3],arguments[4],arguments[5]),n=f(this,r,arguments[6],arguments[7],arguments[8]);break;default:throw new Error("Unexpected arguments for Camera#orient")}return n&&this.setPosition(n),this.setDirection(e),this},lookAt:function(e,t){arguments.length>2&&alert("Jax.Camera#lookAt with more than 2 arguments is deprecated. Please use only two arguments: the point to look at (a vec3) and an optional point to reposition the camera to (a vec3).\n\n"+(new Error).stack),t?this.setPosition(t):t=f(this,r);var n=this._tmp[u];this.setDirection(vec3.subtract(e,t,n))},perspective:function(e){e=e||{};if(!e.width)throw new Error("Expected a screen width in Jax.Camera#perspective");if(!e.height)throw new Error("Expected a screen height in Jax.Camera#perspective");e.fov||(e.fov=45),e.near||(e.near=.01),e.far||(e.far=200);var t=e.width/e.height;mat4.perspective(e.fov,t,e.near,e.far,this.matrices.p),this.projection={width:e.width,height:e.height,near:e.near,far:e.far,fov:e.fov},this.fireEvent("matrixUpdated")},getTransformationMatrix:function(){return this.stale&&p(this),this.matrices.mv},getProjectionMatrix:function(){return this.matrices.p},getNormalMatrix:function(){return this.stale&&p(this),this.matrices.n},unproject:function(e,t,n){if(typeof n=="number"){var r=vec4.create(),i=this.getTransformationMatrix(),s=this.matrices.p,o=[0,0,this.projection.width,this.projection.height],u;mat4.inverse(i,u=mat4.create()),mat4.multiply(s,u,u);if(!mat4.inverse(u,u))return null;r[0]=(e-o[0])/o[2]*2-1,r[1]=(t-o[1])/o[3]*2-1,r[2]=2*n-1,r[3]=1;var a=vec4.create();mat4.multiplyVec4(u,r,a);if(a[3]==0)return null;var f=vec3.create();return a[3]=1/a[3],f[0]=a[0]*a[3],f[1]=a[1]*a[3],f[2]=a[2]*a[3],f}return[this.unproject(e,t,0),this.unproject(e,t,1)]},strafe:function(e){return this.move(e,c(this,s)),this},move:function(e,t){return t||(t=c(this,i)),vec3.add(vec3.scale(t,e,this._tmp[u]),this.position,this.position),this.fireEvent("updated"),this},projectMovement:function(e,t,n){t||(t=0),n||(n=vec3.create());var r=vec3.scale(c(this,i),e),o=vec3.scale(c(this,s),t);return vec3.set(this.position,n),vec3.add(r,n,n),vec3.add(o,n,n),n},reset:function(){this.position[0]=this.position[1]=this.position[2]=0,this.rotation[0]=this.rotation[1]=this.rotation[2]=0,this.rotation[3]=1,this.fireEvent("updated")}})}(),Jax.Camera.prototype.setViewVector=Jax.Camera.prototype.setDirection,Jax.Camera.addMethods(Jax.Events.Methods),Jax.World=function(){function e(e){return e.pickBuffer?e.pickBuffer:e.pickBuffer=new Jax.Framebuffer({depth:!0,width:e.context.canvas.width,height:e.context.canvas.height})}return Jax.Class.create({initialize:function(e){this.context=e,this.lighting=new Jax.Scene.LightManager(e),this.objects={}},addLightSource:function(e){return this.lighting.add(e),e},addObject:function(e){return this.objects[e.__unique_id]=e,(e.isLit()||e.isShadowCaster())&&this.lighting.addObject(e),e},getObject:function(e){return this.objects[e]},removeObject:function(e){if(typeof e=="number"){var t=this.objects[e];return delete this.objects[e],this.lighting.removeObject(t),t}this.removeObject(e.__unique_id)},pickRegionalIndices:function(t,n,r,i,s){var o=Math.abs(r-t),u=Math.abs(i-n);s?s.clear():s=new Array;var a=this,f=e(this),l=this.context,c=new Uint8Array(o*u*4);t=Math.min(t,r),n=Math.min(n,i),f.bind(l,function(){f.viewport(l),l.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),l.glDisable(GL_BLEND),a.render({material:"picking"}),l.glReadPixels(t,n,o,u,GL_RGBA,GL_UNSIGNED_BYTE,c),c.data&&(c=c.data)}),l.glViewport(0,0,l.canvas.width,l.canvas.height),l.glEnable(GL_BLEND);var h;for(var p=2;p<c.length;p+=4)c[p]>0&&(h=Jax.Util.decodePickingColor(c[p-2],c[p-1],c[p],c[p+1]),h!=undefined&&s.indexOf(h)==-1&&s.push(h));return s},pickRegion:function(e,t,n,r,i){var s=this.pickRegionalIndices(e,t,n,r,i);for(var o=0;o<s.length;o++)s[o]=Jax.Model.__instances[s[o]];return s},pickIndex:function(e,t){this._pick_ary=this._pick_ary||new Array;var n=this.pickRegionalIndices(e,t,e+1,t+1,this._pick_ary)[0];return n},pick:function(e,t){var n=this.pickIndex(e,t);return n!=undefined?Jax.Model.__instances[n]:n},countObjects:function(){var e=0;for(var t in this.objects)e++;return e},getShadowCasters:function(){return this.lighting.getShadowCasters()},render:function(e){var t;this.context.glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA);var n=Jax.Util.normalizeOptions(e,{unlit:!0});if(this.lighting.isEnabled()&&(!n.material||n.material.supportsLighting&&n.material.supportsLighting())){this.context.current_pass=Jax.Scene.ILLUMINATION_PASS,this.lighting.illuminate(this.context,e),this.context.current_pass=Jax.Scene.AMBIENT_PASS;for(t in this.objects)this.objects[t].isLit()||this.objects[t].render(this.context,n)}else{this.context.current_pass=Jax.Scene.AMBIENT_PASS;for(t in this.objects)this.objects[t].render(this.context,n)}return this},update:function(e){for(var t in this.objects)this.objects[t].update&&this.objects[t].update(e);return this},dispose:function(e){var t,n;for(t in this.objects)e!==!1&&delete this.objects[t];this.lighting=new Jax.Scene.LightManager(this.context)}})}(),Jax.NORMAL_MAP=1,Jax.Texture=function(){function e(e,t){throw new Error("Texture image '"+e.image.src+"' failed to load!")}function t(e){return e&&(e&-e)==e}function n(e,n,r){var i=e.options.onload||e.onload;if(!t(r.width)||!t(r.height))e.options.mag_filter=GL_LINEAR,e.options.min_filter=GL_LINEAR,e.options.wrap_s=GL_CLAMP_TO_EDGE,e.options.wrap_t=GL_CLAMP_TO_EDGE,e.options.generate_mipmap=!1;n?(e.images.load_count++,e.images.load_count==e.images.length&&(i&&i.call(e,e.image),e.loaded=!0)):(i&&i.call(e,e.image),e.loaded=!0)}function r(e,t){e.handles[t.id]=t.glCreateTexture()}function i(e,t){var n=t.options.data_type,r=t.options.format,i=t.options.target;if(t.image)switch(i){case GL_TEXTURE_2D:e.glTexImage2D(i,0,r,r,n,t.image);break;case GL_TEXTURE_CUBE_MAP:e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X,0,r,r,n,t.image),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,r,n,t.image),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,r,n,t.image),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,r,n,t.image),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,r,n,t.image),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,r,n,t.image);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}else if(t.images)switch(i){case GL_TEXTURE_2D:e.glTexImage2D(i,0,r,r,n,t.images[0]);break;case GL_TEXTURE_CUBE_MAP:e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_X]||t.images[0]),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Y,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_Y]||t.images[1]),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Z,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_POSITIVE_Z]||t.images[2]),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_X,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_X]||t.images[3]),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_Y]||t.images[4]),e.glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,0,r,r,n,t.images[GL_TEXTURE_CUBE_MAP_NEGATIVE_Z]||t.images[5]);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}else{var s=t.options.width,o=t.options.height;if(!s||!o)throw new Error("Can't build an empty texture without at least a width and height");function u(t){try{e.glTexImage2D(t,0,r,s,o,0,r,n,null)}catch(i){var u=new Uint8Array(s*o*Jax.Util.sizeofFormat(r));e.glTexImage2D(t,0,r,s,o,0,r,n,u)}}switch(i){case GL_TEXTURE_2D:u(GL_TEXTURE_2D);break;case GL_TEXTURE_CUBE_MAP:u(GL_TEXTURE_CUBE_MAP_POSITIVE_X),u(GL_TEXTURE_CUBE_MAP_POSITIVE_Y),u(GL_TEXTURE_CUBE_MAP_POSITIVE_Z),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_X),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y),u(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z);break;default:throw new Error("Unexpected texture target "+i+"; use GL_TEXTURE_2D or GL_TEXTURE_CUBE_MAP")}}}function s(e,t,n){t==null&&(t=Jax.Texture._level++),e.textureLevel=
t,e.SLOT=GL_TEXTURES[t],n.glActiveTexture(e.SLOT)}function o(e,t){Jax.Texture._level=e.textureLevel-1,Jax.Texture._level<0&&(Jax.Texture._level=0),delete e.textureLevel,e.SLOT=null}return Jax.Class.create({initialize:function(t,r){this.handles={},this.loaded=!1,this.valid=[],!r&&typeof t=="object"&&t.length==undefined&&(r=t,t=r.path||null,delete r.path);var i=this;this.options=Jax.Util.normalizeOptions(r,{min_filter:GL_NEAREST,mag_filter:GL_NEAREST,generate_mipmap:!0,mipmap_hint:GL_DONT_CARE,format:GL_RGBA,target:null,data_type:GL_UNSIGNED_BYTE,wrap_s:GL_REPEAT,wrap_t:GL_REPEAT,flip_y:!1,premultiply_alpha:!1,colorspace_conversion:!0,onload:null});var s,o=["min_filter","mag_filter","mipmap_hint","format","target","data_type","wrap_s","wrap_t"],u=Jax.getGlobal();for(s=0;s<o.length;s++)typeof this.options[o[s]]=="string"&&(this.options[o[s]]=u[this.options[o[s]]]);if(t)if(typeof t=="string")this.options.target=this.options.target||GL_TEXTURE_2D,this.image=new Image,this.image.onload=function(){n(i,!1,this)},this.image.onerror=this.image.onabort=function(){e(i,this)},this.image.src=t;else{var a=function(){n(i,!0,this)};this.options.target=this.options.target||GL_TEXTURE_CUBE_MAP,this.images=[],this.images.load_count=0;for(s=0;s<t.length;s++)this.images[s]=new Image,this.images[s].onload=a,this.images[s].onerror=this.images[s].onabort=function(){e(i,this)},this.images[s].src=t[s]}else this.options.target=this.options.target||GL_TEXTURE_2D,this.options.generate_mipmap=!!r&&!!r.generate_mipmap,this.loaded=!0},getTarget:function(){return this.options.target},getMinFilter:function(){return this.options.min_filter},getMagFilter:function(){return this.options.mag_filter},getGeneratesMipmaps:function(){return this.options.generate_mipmap},getMipmapHint:function(){return this.options.mipmap_hint},getFormat:function(){return this.options.format},getDataType:function(){return this.options.data_type},getWrapS:function(){return this.options.wrap_s},getWrapT:function(){return this.options.wrap_t},getFlipY:function(){return this.options.flip_y},getPremultipliesAlpha:function(){return this.options.premultiply_alpha},getDoesColorspaceConversion:function(){return this.options.colorspace_conversion},getOnloadFunc:function(){return this.options.onload},refresh:function(e){if(!this.ready())return;return e.glBindTexture(this.options.target,this.getHandle(e)),i(e,this),e.glTexParameteri(this.options.target,GL_TEXTURE_MAG_FILTER,this.options.mag_filter),e.glTexParameteri(this.options.target,GL_TEXTURE_MIN_FILTER,this.options.min_filter),e.glTexParameteri(this.options.target,GL_TEXTURE_WRAP_S,this.options.wrap_s),e.glTexParameteri(this.options.target,GL_TEXTURE_WRAP_T,this.options.wrap_t),e.glPixelStorei(GL_UNPACK_FLIP_Y_WEBGL,this.options.flip_y),e.glPixelStorei(GL_UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiply_alpha),e.glPixelStorei(GL_UNPACK_COLORSPACE_CONVERSION_WEBGL,this.options.colorspace_conversion?GL_BROWSER_DEFAULT_WEBGL:GL_NONE),this.options.generate_mipmap&&this.generateMipmap(e),e.glBindTexture(this.options.target,null),this.valid[e.id]=!0,this},generateMipmap:function(e){return e.glGenerateMipmap(this.options.target),this},invalidate:function(){return this.valid.clear(),this},dispose:function(e){e.glDeleteTexture(this.getHandle(e)),delete this.handles[e.id]},getHandle:function(e){return this.handles[e.id]||(r(this,e),this.refresh(e)),this.handles[e.id]},isValid:function(e){return!!this.valid[e.id]},bind:function(e,t,n){if(!this.ready())return;return this.isValid(e)||this.refresh(e),typeof t=="number"?s(this,t,e):typeof t=="function"&&(n=t,s(this,null,e)),e.glBindTexture(this.options.target,this.getHandle(e)),n&&(n.call(this,this.textureLevel),this.unbind(e)),this},unbind:function(e){return this.textureLevel!=undefined&&e.glActiveTexture(this.SLOT),e.glBindTexture(this.options.target,null),o(this,e),this},ready:function(){return this.loaded}})}(),Jax.Texture._level=0,Jax.getGlobal().WEBGL_CLEANUP&&Jax.getGlobal().WEBGL_CLEANUP(),Jax.EVENT_METHODS=function(){function e(e){var t=0,n=0;do t+=e.offsetTop||0,n+=e.offsetLeft||0,t+=Jax.Compatibility.offsetTop,n+=Jax.Compatibility.offsetLeft,e=e.offsetParent;while(e);var r=[n,t];return r.left=n,r.top=t,r}function t(e,t){var n=e.keyboard;return t=t||window.event||{},n.last=t,t}function n(e){var t=e;e={type:t.type};var n="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");for(var r=n.length,i;r;)i=n[--r],e[i]=t[i];e.target||(e.target=e.srcElement||document),e.target.nodeType===3&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement===e.target?e.toElement:e.fromElement);if(e.pageX==null&&e.clientX!=null){var s=e.target.ownerDocument||document,o=s.documentElement,u=s.body;e.pageX=e.clientX+(o&&o.scrollLeft||u&&u.scrollLeft||0)-(o&&o.clientLeft||u&&u.clientLeft||0),e.pageY=e.clientY+(o&&o.scrollTop||u&&u.scrollTop||0)-(o&&o.clientTop||u&&u.clientTop||0)}return e.which==null&&(e.charCode!=null||e.keyCode!=null)&&(e.which=e.charCode!=null?e.charCode:e.keyCode),!e.metaKey&&e.ctrlKey&&(e.metaKey=e.ctrlKey),!e.which&&e.button!==undefined&&(e.which=e.button&1?1:e.button&2?3:e.button&4?2:0),e}function r(t,r){var i=t.mouse;r=n(r||window.event),r.context=t,r.canvas=t.canvas,r.offsetx=i.x,r.offsety=i.y,r.mouse=i,i.offsetx=r.offsetx||0,i.offsety=r.offsety||0;var s=e(t.canvas);i.x=r.pageX-s[0],i.y=r.pageY-s[1],t.canvas&&(t.canvas.offsetWidth&&(i.x=i.x/t.canvas.offsetWidth*t.canvas.width),t.canvas.offsetHeight&&(i.y=i.y/t.canvas.offsetHeight*t.canvas.height)),i.y=t.canvas.height-i.y,r.type=="mouseover"?i.diffx=i.diffy=0:(i.diffx=i.x-i.offsetx,i.diffy=i.y-i.offsety);if(r.type=="mousedown"||r.type=="onmousedown")i.down=i.down||{count:0},i.down["button"+r.which]={at:[i.x,i.y],time:Jax.uptime},i.down.count++;else if(r.type=="click"||r.type=="onclick")r.cancel=!1,i.down&&i.down["button"+r.which]&&(r.cancel=!!Jax.click_speed&&Jax.uptime-i.down["button"+r.which].time>Jax.click_speed);else if(r.type=="mouseup"||r.type=="onmouseup")i.down&&(i.down.count--,i.down.count<0&&(i.down.count=0));else if(r.type=="mouseout"||r.type=="onmouseout")i.down=null;return r.x=i.x,r.y=i.y,r.diffx=i.diffx,r.diffy=i.diffy,r.down=i.down,r}function i(e,t){if(t.cancel)return;var n=t.type.toString();n.indexOf("on")==0&&(n=n.substring(2,n.length)),n=n.toLowerCase();var r;switch(n){case"click":r="mouse_clicked";break;case"mousemove":t.move_type=="mousemove"?r="mouse_moved":r="mouse_dragged";break;case"mousedown":r="mouse_pressed";break;case"mouseout":r="mouse_exited";break;case"mouseover":r="mouse_entered";break;case"mouseup":r="mouse_released";break;case"keydown":r="key_pressed";break;case"keypress":r="key_typed";break;case"keyup":r="key_released";break;default:return!0}if(e.current_controller[r]){var i=e.current_controller[r](t);if(i!=undefined)return i}return!0}function o(e,t,n){e.canvas.addEventListener?e.canvas.addEventListener(t,n,!1):e.canvas.attachEvent("on"+t,n)}var s=["input","form","textarea","label","fieldset","legend","select","optgroup","option","button"];return{disposeEventListeners:function(){this.unregisterMouseListeners(),this.unregisterKeyListeners()},registerMouseListeners:function(e){var t={mouseover:1,mouseout:1},n;for(n in e)switch(n){case"mouse_pressed":t.mousedown=1;break;case"mouse_released":t.mouseup=1;break;case"mouse_dragged":case"mouse_moved":t.mousedown=t.mouseup=t.mousemove=1;break;case"mouse_clicked":t.click=t.mousedown=1;break;case"mouse_exited":t.mouseout=1;break;case"mouse_entered":t.mouseover=1}for(n in t)n=="mousemove"?o(this,n,this._evt_mousemovefunc):o(this,n,this._evt_mousefunc)},unregisterMouseListeners:function(){this._evt_mousefunc&&this.canvas.removeEventListener(this._evt_mousefunc),this._evt_mousemovefunc&&this.canvas.removeEventListener(this._evt_mousemovefunc)},registerKeyListeners:function(){this.canvas.addEventListener?(document.addEventListener("keydown",this._evt_keyfunc,!1),document.addEventListener("keypress",this._evt_keyfunc,!1),document.addEventListener("keyup",this._evt_keyfunc,!1)):(document.attachEvent("onkeydown",this._evt_keyfunc),document.attachEvent("onkeypress",this._evt_keyfunc),document.attachEvent("onkeyup",this._evt_keyfunc))},unregisterKeyListeners:function(){if(!this._evt_keyfunc)return;this.canvas.removeEventListener(this._evt_keyfunc),document.removeEventListener("keydown",this._evt_keyfunc,!1),document.removeEventListener("keyup",this._evt_keyfunc,!1),document.removeEventListener("keypress",this._evt_keyfunc,!1),document.removeEventListener("onkeydown",this._evt_keyfunc,!1),document.removeEventListener("onkeyup",this._evt_keyfunc,!1),document.removeEventListener("onkeypress",this._evt_keyfunc,!1)},setupEventListeners:function(){this.keyboard={},this.mouse={};var e=this.canvas,n=this;this._evt_mousefunc=function(e){if(!n.current_controller)return;return e=r(n,e),i(n,e)},this._evt_mousemovefunc=function(e){if(!n.current_controller)return;return e=r(n,e),n.mouse&&(!n.mouse.down||n.mouse.down.count<=0)?e.move_type="mousemove":e.move_type="mousedrag",i(n,e)},this._evt_keyfunc=function(e){e.which&&(e.str=String.fromCharCode(e.which));if(document.activeElement&&s.indexOf(document.activeElement.tagName)!=-1)return;if(!n.current_controller)return;return e=t(n,e),i(n,e)},this.registerKeyListeners()}}}(),Jax.Context=function(){function setupContext(e){if(!e.canvas.eventListeners){e.canvas.eventListeners={};var t=e.canvas.addEventListener,n=e.canvas.removeEventListener;e.canvas.getEventListeners=function(e){if(e)return this.eventListeners[e]=this.eventListeners[e]||[];var t=[];for(var n in this.eventListeners)t=t.concat(this.eventListeners[n]);return t},e.canvas.addEventListener=function(e,n,r){this.getEventListeners(e).push(n),t.call(this,e,n,r||!1)},e.canvas.removeEventListener=function(e,t,r){if(typeof e=="string"){var i=this.getEventListeners(e),s=i.indexOf(t);s!=-1&&(i.splice(s,1),n.call(this,e,t,r||!1))}else if(!t)for(var o in this.eventListeners)this.removeEventListener(o,e,!1)}}try{e.gl=e.canvas.getContext(WEBGL_CONTEXT_NAME,WEBGL_CONTEXT_OPTIONS)}catch(r){}if(!e.gl)throw new Error("WebGL could not be initialized!")}function updateFramerate(e){var t=Jax.uptime;e.last_render_start||(e.last_render_start=Jax.uptime);var n=t-e.last_render_start;e.time_to_render=(e.time_to_render||0)*e.framerate_sample_ratio+n*(1-e.framerate_sample_ratio),e.framerate=e.frames_per_second=1/e.time_to_render,e.last_render_start=t}function updateUpdateRate(e){var t=Jax.uptime;e.last_update_start||(e.last_update_start=t);var n=t-e.last_update_start;e.calculateUpdateRate&&(e.time_to_update=(e.time_to_update||0)*e.framerate_sample_ratio+n*(1-e.framerate_sample_ratio),e.updates_per_second=1/e.time_to_update);var r=t-e.last_update_start;return e.last_update_start=t,r}function startRendering(e){function t(n){try{if(e.isDisposed())return;e.calculateFramerate&&updateFramerate(e),e.gl.getError();if(e.current_view){e.prepare(),e.current_view.render();var r=e.afterRenderFuncs.length;for(var i=0;i<r;i++)e.afterRenderFuncs[i].call(e);e.render_interval=requestAnimationFrame(t,e.canvas),e.render_interval==null&&(e.render_interval=1)}else e.stopRendering()}catch(s){e.handleError("render",s)}}if(e.isRendering())return;e.render_interval=requestAnimationFrame(t,Jax.render_speed),e.render_interval==null&&(e.render_interval=1)}function startUpdating(e){function t(){try{if(e.isDisposed())return;var n=updateUpdateRate(e);e.update(n);var r=e.afterUpdateFuncs.length;for(var i=0;i<r;i++)e.afterUpdateFuncs[i].call(e);e.update_interval=setTimeout(t,Jax.update_speed),Jax.SHUTDOWN_IN_PROGRESS&&e.dispose()}catch(s){e.handleError("update",s)}}if(e.isUpdating())return;t()}function setupView(self,view){view.context=self,view.world=self.world,view.player=self.player;for(var i in self)i.indexOf("gl")==0&&(view[i]=eval("(function() { return this.context."+i+".apply(this.context, arguments); })"))}function reloadMatrices(e){e.matrix_stack.reset(),e.matrix_stack.loadModelMatrix(mat4.IDENTITY),e.matrix_stack.loadViewMatrix(e.player.camera.getTransformationMatrix()),e.matrix_stack.loadProjectionMatrix(e.player.camera.getProjectionMatrix())}var klass=Jax.Class.create({initialize:function(e,t){try{typeof e=="string"&&(e=document.getElementById(e));if(!e)throw new Error("Can't initialize a WebGL context without a canvas!");t=Jax.Util.normalizeOptions(t,{alertErrors:!0}),this.alertErrors=t.alertErrors,this.id=++Jax.Context.identifier,this.canvas=e,this.setupEventListeners(),this.render_interval=null,this.world=new Jax.World(this),this.player={camera:new Jax.Camera},this.player.camera.perspective({width:e.width,height:e.height}),this.matrix_stack=new Jax.MatrixStack,this.current_pass=Jax.Scene.AMBIENT_PASS,this.afterRenderFuncs=[],this.afterUpdateFuncs=[],this.framerate=0,this.frames_per_second=0,this.updates_per_second=0,this.framerate_sample_ratio=.9,setupContext(this),this.glClearColor(0,0,0,1),this.glClearDepth(1),this.glEnable(GL_DEPTH_TEST),this.glDepthFunc(GL_LEQUAL),this.glEnable(GL_BLEND),this.glBlendFunc(GL_SRC_ALPHA,GL_ONE_MINUS_SRC_ALPHA),this.checkForRenderErrors(),this.startUpdating()}catch(n){this.handleError("initialize",n)}t&&t.root&&this.redirectTo(t.root)},startUpdating:function(){return startUpdating(this),this},startRendering:function(){return startRendering(this),this},stopRendering:function(){return clearTimeout(this.render_interval),this.render_interval=null,this},stopUpdating:function(){return clearTimeout(this.update_interval),this.update_interval=null,this},getFramesPerSecond:function(){return this.calculateFramerate=!0,this.frames_per_second},getUpdatesPerSecond:function(){return this.calculateUpdateRate=!0,this.updates_per_second},disableFrameSpeedCalculations:function(){this.calculateFramerate=!1},disableUpdateSpeedCalculations:function(){this.caclulateUpdateRate=!1},afterRender:function(e){this.afterRenderFuncs.push(e)},afterUpdate:function(e){this.afterUpdateFuncs.push(e)},hasStencil:function(){return!!this.gl.stencil},redirectTo:function(e){try{this.stopRendering(),this.stopUpdating();var t=this.current_controller,n=this.current_view,r=Jax.routes.recognizeRoute(e);if(!t||t.klass!=r.controller){this.unloadScene(),this.current_controller=Jax.routes.dispatch(e,this);if(!this.current_controller.view_key)throw new Error("Controller '"+this.current_controller.getControllerName()+"' did not produce a renderable result");this.current_view=Jax.views.find(this.current_controller.view_key),setupView(this,this.current_view)}else{t.fireAction(r.action),this.current_controller=t;var i,s=t.view_key;try{t.view_key&&(i=Jax.views.find(t.view_key))&&(this.current_view=i,setupView(this,i))}catch(o){t.view_key=s,this.current_view=n}}this.isRendering()||this.startRendering(),this.isUpdating()||this.startUpdating(),this.current_controller&&this.registerMouseListeners(this.current_controller)}catch(o){this.handleError("redirect",o)}return this.current_controller},unloadScene:function(){return this.unregisterMouseListeners(),this.world.dispose(),this.player.camera.reset(),this},prepare:function(){reloadMatrices(this),this.glViewport(0,0,this.canvas.width,this.canvas.height)},update:function(e){return this.current_controller&&this.current_controller.update&&this.current_controller.update(e),this.world.update(e),this},isRendering:function(){return this.render_interval!=null},isUpdating:function(){return this.update_interval!=null},dispose:function(){this.disposed=!0,this.stopRendering(),this.stopUpdating(),this.disposeEventListeners()},isDisposed:function(){return!!this.disposed},pushMatrix:function(e){return this.matrix_stack.push(),e(),this.matrix_stack.pop(),this},getViewMatrix:function(){return this.matrix_stack.getViewMatrix()},getInverseViewMatrix:function(){return this.matrix_stack.getInverseViewMatrix()},getFrustum:function(){return this.player.camera.frustum},checkForRenderErrors:function(){if(Jax.environment==Jax.PRODUCTION)return;var e=this.glGetError();if(e!=GL_NO_ERROR){var t="GL error in "+this.canvas.id+": "+e+" ("+Jax.Util.enumName(e)+")";e=new Error(t);var n=e;if(e.stack){var r=e.stack.split("\n");r.shift(),n+="\n\n"+r.join("\n")}throw e}},handleError:function(e,t){var n=t.toString();t={phase:e,error:t.error||t,stack:t._stack||t.stack,message:t.toString(),toString:function(){return n}},this.fireEvent("error",t);var r=this.current_controller;(!r||!r.error)&&typeof ApplicationController!="undefined"&&(r=Jax.getGlobal().ApplicationController.prototype),r&&r.error&&(t.silence=r.error(t));if(!t.silence&&!t.silenced){if(t.phase=="initialize")throw Jax.webgl_not_supported_path&&(document.location.pathname=Jax.webgl_not_supported_path),t.toString()+"\n\n"+t.stack;var i=null,s=t._stack||t.stack||"(backtrace unavailable)",n=t.toString()+"\n\n"+s.toString();throw typeof console!="undefined"&&(i=console.error||console.log,i&&i.call(console,n)),Jax.environment!=Jax.PRODUCTION&&this.alertErrors&&alert(n),t.error}return this},handleRenderError:function(e,t,n){throw n}});return klass.delegate(/^(get|load|mult)(.*)Matrix$/).into("matrix_stack"),klass.prototype.getFramerate=klass.prototype.getFramesPerSecond,klass}(),Jax.Context.identifier=0,Jax.Context.addMethods(GL_METHODS),Jax.Context.addMethods(Jax.EVENT_METHODS),Jax.Context.addMethods(Jax.Events.Methods),Jax.Noise=function(){function u(n){var r=new Jax.Texture({min_filter:GL_NEAREST,mag_filter:GL_NEAREST,width:256,height:256});if(!s){var i=new Array(262144),o,u;for(o=0;o<256;o++)for(u=0;u<256;u++){var a=(o*256+u)*4,f=e[u+e[o]&255],l=(f&15)*3;i[a]=t[l+0]*64+64,i[a+1]=t[l+1]*64+64,i[a+2]=t[l+2]*64+64,i[a+3]=f}s=new Uint8Array(i)}return r}function a(e){i||(i=new Uint8Array(r));var t=new Jax.Texture({min_filter:GL_NEAREST,mag_filter:GL_NEAREST,width:64,height:1});return t}function f(t){var r=new Jax.Texture({min_filter:GL_NEAREST,mag_filter:GL_NEAREST,width:256,height:256});if(!o){var i=new Array(262144),s,u;for(s=0;s<256;s++)for(u=0;u<256;u++){var a=(s*256+u)*4,f=e[u+e[s]&255],l=(f&31)*4;i[a]=n[l+0]*64+64,i[a+1]=n[l+1]*64+64,i[a+2]=n[l+2]*64+64,i[a+3]=n[l+3]*64+64}o=new Uint8Array(i)}return r}function l(e,t){if(!s||!i||!o)throw new Error("Unknown error: one of the noise buffers is null!");e.perm.bind(t,function(){t.glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,256,256,0,GL_RGBA,GL_UNSIGNED_BYTE,s)}),e.simplex.bind(t,function(){t.glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,64,1,0,GL_RGBA,GL_UNSIGNED_BYTE,i)}),e.grad.bind(t,function(){t.glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA,256,256,0,GL_RGBA,GL_UNSIGNED_BYTE,o)})}var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=[0,1,1,0,1,-1,0,-1,1,0,-1,-1,1,0,1,1,0,-1,-1,0,1,-1,0,-1,1,1,0,1,-1,0,-1,1,0,-1,-1,0,1,0,-1,-1,0,-1,0,-1,1,0,1,1],n=[0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0],r=[0,64,128,192,0,64,192,128,0,0,0,0,0,128,192,64,0,0,0,0,0,0,0,0,0,0,0,0,64,128,192,0,0,128,64,192,0,0,0,0,0,192,64,128,0,192,128,64,0,0,0,0,0,0,0,0,0,0,0,0,64,192,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,128,0,192,0,0,0,0,64,192,0,128,0,0,0,0,0,0,0,0,0,0,0,0,128,192,0,64,128,192,64,0,64,0,128,192,64,0,192,128,0,0,0,0,0,0,0,0,0,0,0,0,128,0,192,64,0,0,0,0,128,64,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,64,192,0,0,0,0,0,0,0,0,0,0,0,0,192,0,64,128,192,0,128,64,0,0,0,0,192,64,128,0,128,64,0,192,0,0,0,0,0,0,0,0,0,0,0,0,192,64,0,128,0,0,0,0,192,128,0,64,192,128,64,0],i=null,s=null,o=null;return Jax.Class.create({initialize:function(e){this.perm=u(e),this.simplex=a(e),this.grad=f(e),e&&l(this,e)},bind:function(e,t){this.isPrepared(e)||l(this,e),t.texture("permTexture",this.perm,e),t.texture("simplexTexture",this.simplex,e),t.texture("gradTexture",this.grad,e)},isPrepared:function(e){return this.perm.isValid(e)}})}(),Jax.noise=new Jax.Noise,Jax.Mesh.Quad=function(){return Jax.Class.create(Jax.Mesh,{initialize:function($super,e){typeof e=="number"&&(e={width:e,height:e}),e=Jax.Util.normalizeOptions(e,{width:e&&e.size?e.size:1,height:e&&e.size?e.size:1}),this.draw_mode=GL_TRIANGLE_STRIP,$super(e),this.setSize(e.width,e.height)},setWidth:function(e){this.setSize(e,this.height)},setHeight:function(e){this.setHeight(this.width,e)},setSize:function(e,t){this.width=e,this.height=t,this.rebuild()},init:function(e,t,n,r){var i=this.width/2,s=this.height/2;e.push(-i,s,0),e.push(-i,-s,0),e.push(i,s,0),e.push(i,-s,0),t.push(1,1,1,1),t.push(1,1,1,1),t.push(1,1,1,1),t.push(1,1,1,1),n.push(0,1),n.push(0,0),n.push(1,1),n.push(1,0),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1),r.push(0,0,1)}})}(),Jax.Mesh.Cube=Jax.Class.create(Jax.Mesh,{initialize:function($super,e){var t=e&&e.size||1;e=Jax.Util.normalizeOptions(e,{width:t,depth:t,height:t}),this.draw_mode=GL_TRIANGLES,$super(e);var n=this,r=function(){n.dispose()},i=function(){n.dispose()},s=e.width,o=e.height,u=e.depth;this.left=new Jax.Model({mesh:new Jax.Mesh.Quad(u,o)}),this.left.camera.reorient([-1,0,0],[-s/2,0,0]),this.left.mesh.addEventListener("color_changed",r),this.left.camera.addEventListener("updated",i),this.right=new Jax.Model({mesh:new Jax.Mesh.Quad(u,o)}),this.right.camera.reorient([1,0,0],[s/2,0,0]),this.right.mesh.addEventListener("color_changed",r),this.right.camera.addEventListener("updated",i),this.front=new Jax.Model({mesh:new Jax.Mesh.Quad(s,o)}),this.front.camera.reorient([0,0,1],[0,0,u/2]),this.front.mesh.addEventListener("color_changed",r),this.front.camera.addEventListener("updated",i),this.back=new Jax.Model({mesh:new Jax.Mesh.Quad(s,o)}),this.back.camera.reorient([0,0,-1],[0,0,-u/2]),this.back.mesh.addEventListener("color_changed",r),this.back.camera.addEventListener("updated",i),this.top=new Jax.Model({mesh:new Jax.Mesh.Quad(s,u)}),this.top.camera.reorient([0,1,0],[0,o/2,0]),this.top.mesh.addEventListener("color_changed",r),this.top.camera.addEventListener("updated",i),this.bottom=new Jax.Model({mesh:new Jax.Mesh.Quad(s,u)}),this.bottom.camera.reorient([0,-1,0],[0,-o/2,0]),this.bottom.mesh.addEventListener("color_changed",r),this.bottom.camera.addEventListener("updated",i)},init:function(e,t,n,r){var i,s=["left","right","top","bottom","front","back"];for(var o=0;o<s.length;o++){var u=[],a=[],f=[],l=[];this[s[o]].mesh.init(u,a,f,l,[]),a=this[s[o]].mesh.getColorBuffer().js,i=this[s[o]].camera.getTransformationMatrix();function c(s){var o=s*3,c=s*3+1,h=s*3+2,p=mat4.multiplyVec3(i,[u[o],u[c],u[h]]),d=mat4.multiplyVec3(i,[l[o],l[c],l[h]]);e.push(p[0],p[1],p[2]),r.push(d[0],d[1],d[2]),a.length!=0&&t.push(a[s*4],a[s*4+1],a[s*4+2],a[s*4+3]),f.length!=0&&n.push(-f[s*2],f[s*2+1])}c(0),c(1),c(2),c(2),c(1),c(3)}}}),Jax.Mesh.Torus=Jax.Class.create(Jax.Mesh,{initialize:function($super,e){e=e||{},this.inner_radius=typeof e.inner_radius=="undefined"?.6:e.inner_radius,this.outer_radius=typeof e.outer_radius=="undefined"?1.8:e.inner_radius,this.sides=typeof e.sides=="undefined"?128:e.inner_radius,this.rings=typeof e.rings=="undefined"?256:e.inner_radius,this.draw_mode=GL_TRIANGLE_STRIP,$super(e)},init:function(e,t,n,r){var i=this.inner_radius,s=this.outer_radius,o=this.sides,u=this.rings,a,f,l,c,h,p,d,v,m,g,y,b,w,E;y=2*Math.PI/o,g=2*Math.PI/u,l=0,p=1,d=0;for(a=u-1;a>=0;a--){h=l+g,v=Math.cos(h),m=Math.sin(h),c=0;for(f=o;f>=0;f--)c+=y,b=Math.cos(c),w=Math.sin(c),E=s+i*b,r.push(v*b,-m*b,w),e.push(v*E,-m*E,i*w),r.push(p*b,-d*b,w),e.push(p*E,-d*E,i*w);l=h,p=v,d=m}}}),Jax.Mesh.Plane=Jax.Class.create(Jax.Mesh,{initialize:function($super,e){e=e||{},this.width=e.width||e.size||500,this.depth=e.depth||e.size||500,this.x_segments=e.x_segments||e.segments||20,this.z_segments=e.z_segments||e.segments||20,this.draw_mode=GL_TRIANGLE_STRIP,$super(e)},init:function(e,t,n,r){var i=this.width,s=this.depth,o=this.x_segments,u=this.z_segments,a=i/o,f=s/u,l,c,h,p;for(l=1;l<o;l++){for(c=0;c<u;c++)h=a*l-i/2,p=f*c-s/2,e.push(h,0,p),e.push(h-a,0,p),r.push(0,1,0,0,1,0),n.push(l/(o-1),c/(u-1)),n.push((l-1)/(o-1),c/(u-1));for(c=u-1;c>=0;c--)h=a*l-i/2,p=f*c-s/2,e.push(h-a,0,p),e.push(h,0,p),r.push(0,1,0,0,1,0),n.push((l-1)/(o-1),c/(u-1)),n.push(l/(o-1),c/(u-1))}}}),Jax.Mesh.Sphere=Jax.Class.create(Jax.Mesh,{initialize:function($super,e){e=e||{},this.slices=e.slices||30,this.stacks=e.stacks||30,this.radius=e.radius||1,$super(e)},init:function(e,t,n,r,i){var s=this.slices,o=this.stacks,u=this.radius,a,f;for(a=0;a<=s;a++){var l=a*Math.PI/s,c=Math.sin(l),h=Math.cos(l);for(f=0;f<=o;f++){var p=f*2*Math.PI/o,d=Math.sin(p),v=Math.cos(p),m=v*c,g=h,y=d*c,b=1-f/o,w=1-a/s;r.push(m,g,y),n.push(b,w),e.push(u*m,u*g,u*y),t.push(1,1,1,1)}}for(a=0;a<s;a++)for(f=0;f<o;f++){var E=a*(o+1)+f,S=E+o+1;i.push(E,S,E+1),i.push(S,S+1,E+1)}}}),Jax.Mesh.Teapot=function(){var e={vertices:[5.929688,4.125,0,5.387188,4.125,2.7475,5.2971,4.494141,2.70917,5.832031,4.494141,0,5.401602,4.617188,2.753633,5.945313,4.617188,0,5.614209,4.494141,2.844092,6.175781,4.494141,0,5.848437,4.125,2.94375,6.429688,4.125,0,3.899688,4.125,4.97,3.830352,4.494141,4.900664,3.910782,4.617188,4.981094,4.074414,4.494141,5.144727,4.254687,4.125,5.325,1.677188,4.125,6.4575,1.638858,4.494141,6.367412,1.68332,4.617188,6.471914,1.77378,4.494141,6.684522,1.873438,4.125,6.91875,-1.070312,4.125,7,-1.070312,4.494141,6.902344,-1.070312,4.617188,7.015625,-1.070312,4.494141,7.246094,-1.070312,4.125,7.5,-1.070312,4.125,7,-4.007656,4.125,6.4575,-3.859572,4.494141,6.367412,-1.070312,4.494141,6.902344,-3.847676,4.617188,6.471914,-1.070312,4.617188,7.015625,-3.917371,4.494141,6.684522,-1.070312,4.494141,7.246094,-4.014062,4.125,6.91875,-1.070312,4.125,7.5,-6.209063,4.125,4.97,-6.042168,4.494141,4.900664,-6.0725,4.617188,4.981094,-6.217675,4.494141,5.144727,-6.395312,4.125,5.325,-7.591093,4.125,2.7475,-7.464421,4.494141,2.70917,-7.550137,4.617188,2.753633,-7.755822,4.494141,2.844092,-7.989062,4.125,2.94375,-8.070313,4.125,0,-7.972656,4.494141,0,-8.085938,4.617188,0,-8.316406,4.494141,0,-8.570313,4.125,0,-8.070313,4.125,0,-7.527812,4.125,-2.7475,-7.437724,4.494141,-2.70917,-7.972656,4.494141,0,-7.542227,4.617188,-2.753633,-8.085938,4.617188,0,-7.754834,4.494141,-2.844092,-8.316406,4.494141,0,-7.989062,4.125,-2.94375,-8.570313,4.125,0,-6.040312,4.125,-4.97,-5.970977,4.494141,-4.900664,-6.051406,4.617188,-4.981094,-6.215039,4.494141,-5.144727,-6.395312,4.125,-5.325,-3.817812,4.125,-6.4575,-3.779482,4.494141,-6.367412,-3.823945,4.617188,-6.471914,-3.914404,4.494141,-6.684522,-4.014062,4.125,-6.91875,-1.070312,4.125,-7,-1.070312,4.494141,-6.902344,-1.070312,4.617188,-7.015625,-1.070312,4.494141,-7.246094,-1.070312,4.125,-7.5,-1.070312,4.125,-7,1.677188,4.125,-6.4575,1.638858,4.494141,-6.367412,-1.070312,4.494141,-6.902344,1.68332,4.617188,-6.471914,-1.070312,4.617188,-7.015625,1.77378,4.494141,-6.684522,-1.070312,4.494141,-7.246094,1.873438,4.125,-6.91875,-1.070312,4.125,-7.5,3.899688,4.125,-4.97,3.830352,4.494141,-4.900664,3.910782,4.617188,-4.981094,4.074414,4.494141,-5.144727,4.254687,4.125,-5.325,5.387188,4.125,-2.7475,5.2971,4.494141,-2.70917,5.401602,4.617188,-2.753633,5.614209,4.494141,-2.844092,5.848437,4.125,-2.94375,5.929688,4.125,0,5.832031,4.494141,0,5.945313,4.617188,0,6.175781,4.494141,0,6.429688,4.125,0,6.429688,4.125,0,5.848437,4.125,2.94375,6.695264,2.162109,3.304053,7.347656,2.162109,0,7.433985,.234375,3.61836,8.148438,.234375,0,7.956494,-1.623047,3.840674,8.714844,-1.623047,0,8.154688,-3.375,3.925,8.929688,-3.375,0,4.254687,4.125,5.325,4.906446,2.162109,5.976758,5.475,.234375,6.545312,5.877149,-1.623047,6.947461,6.029688,-3.375,7.1,1.873438,4.125,6.91875,2.23374,2.162109,7.765576,2.548047,.234375,8.504297,2.770362,-1.623047,9.026807,2.854688,-3.375,9.225,-1.070312,4.125,7.5,-1.070312,2.162109,8.417969,-1.070312,.234375,9.21875,-1.070312,-1.623047,9.785156,-1.070312,-3.375,10,-1.070312,4.125,7.5,-4.014062,4.125,6.91875,-4.374365,2.162109,7.765576,-1.070312,2.162109,8.417969,-4.688672,.234375,8.504297,-1.070312,.234375,9.21875,-4.910986,-1.623047,9.026807,-1.070312,-1.623047,9.785156,-4.995313,-3.375,9.225,-1.070312,-3.375,10,-6.395312,4.125,5.325,-7.047071,2.162109,5.976758,-7.615624,.234375,6.545312,-8.017773,-1.623047,6.947461,-8.170312,-3.375,7.1,-7.989062,4.125,2.94375,-8.835889,2.162109,3.304053,-9.57461,.234375,3.61836,-10.097119,-1.623047,3.840674,-10.295313,-3.375,3.925,-8.570313,4.125,0,-9.488281,2.162109,0,-10.289063,.234375,0,-10.855469,-1.623047,0,-11.070313,-3.375,0,-8.570313,4.125,0,-7.989062,4.125,-2.94375,-8.835889,2.162109,-3.304053,-9.488281,2.162109,0,-9.57461,.234375,-3.61836,-10.289063,.234375,0,-10.097119,-1.623047,-3.840674,-10.855469,-1.623047,0,-10.295313,-3.375,-3.925,-11.070313,-3.375,0,-6.395312,4.125,-5.325,-7.047071,2.162109,-5.976758,-7.615624,.234375,-6.545312,-8.017773,-1.623047,-6.947461,-8.170312,-3.375,-7.1,-4.014062,4.125,-6.91875,-4.374365,2.162109,-7.765576,-4.688672,.234375,-8.504297,-4.910986,-1.623047,-9.026807,-4.995313,-3.375,-9.225,-1.070312,4.125,-7.5,-1.070312,2.162109,-8.417969,-1.070312,.234375,-9.21875,-1.070312,-1.623047,-9.785156,-1.070312,-3.375,-10,-1.070312,4.125,-7.5,1.873438,4.125,-6.91875,2.23374,2.162109,-7.765576,-1.070312,2.162109,-8.417969,2.548047,.234375,-8.504297,-1.070312,.234375,-9.21875,2.770362,-1.623047,-9.026807,-1.070312,-1.623047,-9.785156,2.854688,-3.375,-9.225,-1.070312,-3.375,-10,4.254687,4.125,-5.325,4.906446,2.162109,-5.976758,5.475,.234375,-6.545312,5.877149,-1.623047,-6.947461,6.029688,-3.375,-7.1,5.848437,4.125,-2.94375,6.695264,2.162109,-3.304053,7.433985,.234375,-3.61836,7.956494,-1.623047,-3.840674,8.154688,-3.375,-3.925,6.429688,4.125,0,7.347656,2.162109,0,8.148438,.234375,0,8.714844,-1.623047,0,8.929688,-3.375,0,8.929688,-3.375,0,8.154688,-3.375,3.925,7.794336,-4.857422,3.77168,8.539063,-4.857422,0,7.001562,-5.953125,3.434375,7.679688,-5.953125,0,6.208789,-6.697266,3.09707,6.820313,-6.697266,0,5.848437,-7.125,2.94375,6.429688,-7.125,0,6.029688,-3.375,7.1,5.752343,-4.857422,6.822656,5.142187,-5.953125,6.2125,4.532031,-6.697266,5.602344,4.254687,-7.125,5.325,2.854688,-3.375,9.225,2.701367,-4.857422,8.864649,2.364063,-5.953125,8.071875,2.026758,-6.697266,7.279101,1.873438,-7.125,6.91875,-1.070312,-3.375,10,-1.070312,-4.857422,9.609375,-1.070312,-5.953125,8.75,-1.070312,-6.697266,7.890625,-1.070312,-7.125,7.5,-1.070312,-3.375,10,-4.995313,-3.375,9.225,-4.841992,-4.857422,8.864649,-1.070312,-4.857422,9.609375,-4.504687,-5.953125,8.071875,-1.070312,-5.953125,8.75,-4.167383,-6.697266,7.279101,-1.070312,-6.697266,7.890625,-4.014062,-7.125,6.91875,-1.070312,-7.125,7.5,-8.170312,-3.375,7.1,-7.892968,-4.857422,6.822656,-7.282812,-5.953125,6.2125,-6.672656,-6.697266,5.602344,-6.395312,-7.125,5.325,-10.295313,-3.375,3.925,-9.934961,-4.857422,3.77168,-9.142187,-5.953125,3.434375,-8.349414,-6.697266,3.09707,-7.989062,-7.125,2.94375,-11.070313,-3.375,0,-10.679688,-4.857422,0,-9.820313,-5.953125,0,-8.960938,-6.697266,0,-8.570313,-7.125,0,-11.070313,-3.375,0,-10.295313,-3.375,-3.925,-9.934961,-4.857422,-3.77168,-10.679688,-4.857422,0,-9.142187,-5.953125,-3.434375,-9.820313,-5.953125,0,-8.349414,-6.697266,-3.09707,-8.960938,-6.697266,0,-7.989062,-7.125,-2.94375,-8.570313,-7.125,0,-8.170312,-3.375,-7.1,-7.892968,-4.857422,-6.822656,-7.282812,-5.953125,-6.2125,-6.672656,-6.697266,-5.602344,-6.395312,-7.125,-5.325,-4.995313,-3.375,-9.225,-4.841992,-4.857422,-8.864649,-4.504687,-5.953125,-8.071875,-4.167383,-6.697266,-7.279101,-4.014062,-7.125,-6.91875,-1.070312,-3.375,-10,-1.070312,-4.857422,-9.609375,-1.070312,-5.953125,-8.75,-1.070312,-6.697266,-7.890625,-1.070312,-7.125,-7.5,-1.070312,-3.375,-10,2.854688,-3.375,-9.225,2.701367,-4.857422,-8.864649,-1.070312,-4.857422,-9.609375,2.364063,-5.953125
,-8.071875,-1.070312,-5.953125,-8.75,2.026758,-6.697266,-7.279101,-1.070312,-6.697266,-7.890625,1.873438,-7.125,-6.91875,-1.070312,-7.125,-7.5,6.029688,-3.375,-7.1,5.752343,-4.857422,-6.822656,5.142187,-5.953125,-6.2125,4.532031,-6.697266,-5.602344,4.254687,-7.125,-5.325,8.154688,-3.375,-3.925,7.794336,-4.857422,-3.77168,7.001562,-5.953125,-3.434375,6.208789,-6.697266,-3.09707,5.848437,-7.125,-2.94375,8.929688,-3.375,0,8.539063,-4.857422,0,7.679688,-5.953125,0,6.820313,-6.697266,0,6.429688,-7.125,0,6.429688,-7.125,0,5.848437,-7.125,2.94375,5.691685,-7.400391,2.877056,6.259766,-7.400391,0,4.853868,-7.640625,2.520586,5.351563,-7.640625,0,2.783648,-7.810547,1.639761,3.107422,-7.810547,0,-1.070312,-7.875,0,4.254687,-7.125,5.325,4.134043,-7.400391,5.204355,3.489219,-7.640625,4.559531,1.895879,-7.810547,2.966191,-1.070312,-7.875,0,1.873438,-7.125,6.91875,1.806743,-7.400391,6.761997,1.450274,-7.640625,5.92418,.569448,-7.810547,3.85396,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-1.070312,-7.400391,7.330078,-1.070312,-7.640625,6.421875,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-1.070312,-7.125,7.5,-4.014062,-7.125,6.91875,-3.947368,-7.400391,6.761997,-1.070312,-7.400391,7.330078,-3.590898,-7.640625,5.92418,-1.070312,-7.640625,6.421875,-2.710073,-7.810547,3.85396,-1.070312,-7.810547,4.177734,-1.070312,-7.875,0,-6.395312,-7.125,5.325,-6.274668,-7.400391,5.204355,-5.629844,-7.640625,4.559531,-4.036504,-7.810547,2.966191,-1.070312,-7.875,0,-7.989062,-7.125,2.94375,-7.832309,-7.400391,2.877056,-6.994492,-7.640625,2.520586,-4.924272,-7.810547,1.639761,-1.070312,-7.875,0,-8.570313,-7.125,0,-8.400391,-7.400391,0,-7.492188,-7.640625,0,-5.248047,-7.810547,0,-1.070312,-7.875,0,-8.570313,-7.125,0,-7.989062,-7.125,-2.94375,-7.832309,-7.400391,-2.877056,-8.400391,-7.400391,0,-6.994492,-7.640625,-2.520586,-7.492188,-7.640625,0,-4.924272,-7.810547,-1.639761,-5.248047,-7.810547,0,-1.070312,-7.875,0,-6.395312,-7.125,-5.325,-6.274668,-7.400391,-5.204355,-5.629844,-7.640625,-4.559531,-4.036504,-7.810547,-2.966191,-1.070312,-7.875,0,-4.014062,-7.125,-6.91875,-3.947368,-7.400391,-6.761997,-3.590898,-7.640625,-5.92418,-2.710073,-7.810547,-3.85396,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,-1.070312,-7.400391,-7.330078,-1.070312,-7.640625,-6.421875,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,-1.070312,-7.125,-7.5,1.873438,-7.125,-6.91875,1.806743,-7.400391,-6.761997,-1.070312,-7.400391,-7.330078,1.450274,-7.640625,-5.92418,-1.070312,-7.640625,-6.421875,.569448,-7.810547,-3.85396,-1.070312,-7.810547,-4.177734,-1.070312,-7.875,0,4.254687,-7.125,-5.325,4.134043,-7.400391,-5.204355,3.489219,-7.640625,-4.559531,1.895879,-7.810547,-2.966191,-1.070312,-7.875,0,5.848437,-7.125,-2.94375,5.691685,-7.400391,-2.877056,4.853868,-7.640625,-2.520586,2.783648,-7.810547,-1.639761,-1.070312,-7.875,0,6.429688,-7.125,0,6.259766,-7.400391,0,5.351563,-7.640625,0,3.107422,-7.810547,0,-1.070312,-7.875,0,-9.070313,2.25,0,-8.992188,2.425781,.84375,-11.47583,2.405457,.84375,-11.40625,2.232422,0,-13.298828,2.263184,.84375,-13.132813,2.109375,0,-14.421631,1.877014,.84375,-14.203125,1.775391,0,-14.804688,1.125,.84375,-14.570313,1.125,0,-8.820313,2.8125,1.125,-11.628906,2.786134,1.125,-13.664063,2.601563,1.125,-14.902344,2.100586,1.125,-15.320313,1.125,1.125,-8.648438,3.199219,.84375,-11.781982,3.166809,.84375,-14.029297,2.939941,.84375,-15.383057,2.324158,.84375,-15.835938,1.125,.84375,-8.570313,3.375,0,-11.851563,3.339844,0,-14.195313,3.09375,0,-15.601563,2.425781,0,-16.070313,1.125,0,-8.570313,3.375,0,-8.648438,3.199219,-0.84375,-11.781982,3.166809,-0.84375,-11.851563,3.339844,0,-14.029297,2.939941,-0.84375,-14.195313,3.09375,0,-15.383057,2.324158,-0.84375,-15.601563,2.425781,0,-15.835938,1.125,-0.84375,-16.070313,1.125,0,-8.820313,2.8125,-1.125,-11.628906,2.786134,-1.125,-13.664063,2.601563,-1.125,-14.902344,2.100586,-1.125,-15.320313,1.125,-1.125,-8.992188,2.425781,-0.84375,-11.47583,2.405457,-0.84375,-13.298828,2.263184,-0.84375,-14.421631,1.877014,-0.84375,-14.804688,1.125,-0.84375,-9.070313,2.25,0,-11.40625,2.232422,0,-13.132813,2.109375,0,-14.203125,1.775391,0,-14.570313,1.125,0,-14.570313,1.125,0,-14.804688,1.125,.84375,-14.588013,.00705,.84375,-14.375,.105469,0,-13.90918,-1.275146,.84375,-13.757813,-1.125,0,-12.724976,-2.540863,.84375,-12.671875,-2.355469,0,-10.992188,-3.609375,.84375,-11.070313,-3.375,0,-15.320313,1.125,1.125,-15.056641,-0.209473,1.125,-14.242188,-1.605469,1.125,-12.841797,-2.94873,1.125,-10.820313,-4.125,1.125,-15.835938,1.125,.84375,-15.525269,-0.425995,.84375,-14.575195,-1.935791,.84375,-12.958618,-3.356598,.84375,-10.648438,-4.640625,.84375,-16.070313,1.125,0,-15.738281,-0.524414,0,-14.726563,-2.085938,0,-13.011719,-3.541992,0,-10.570313,-4.875,0,-16.070313,1.125,0,-15.835938,1.125,-0.84375,-15.525269,-0.425995,-0.84375,-15.738281,-0.524414,0,-14.575195,-1.935791,-0.84375,-14.726563,-2.085938,0,-12.958618,-3.356598,-0.84375,-13.011719,-3.541992,0,-10.648438,-4.640625,-0.84375,-10.570313,-4.875,0,-15.320313,1.125,-1.125,-15.056641,-0.209473,-1.125,-14.242188,-1.605469,-1.125,-12.841797,-2.94873,-1.125,-10.820313,-4.125,-1.125,-14.804688,1.125,-0.84375,-14.588013,.00705,-0.84375,-13.90918,-1.275146,-0.84375,-12.724976,-2.540863,-0.84375,-10.992188,-3.609375,-0.84375,-14.570313,1.125,0,-14.375,.105469,0,-13.757813,-1.125,0,-12.671875,-2.355469,0,-11.070313,-3.375,0,7.429688,-0.75,0,7.429688,-1.394531,1.85625,10.01123,-0.677124,1.676074,9.828125,-0.199219,0,11.101563,.84668,1.279688,10.867188,1.125,0,11.723145,2.629761,.883301,11.4375,2.730469,0,12.898438,4.125,.703125,12.429688,4.125,0,7.429688,-2.8125,2.475,10.414063,-1.728516,2.234766,11.617188,.234375,1.70625,12.351563,2.408203,1.177734,13.929688,4.125,.9375,7.429688,-4.230469,1.85625,10.816895,-2.779907,1.676074,12.132813,-0.37793,1.279688,12.97998,2.186646,.883301,14.960938,4.125,.703125,7.429688,-4.875,0,11,-3.257813,0,12.367188,-0.65625,0,13.265625,2.085938,0,15.429688,4.125,0,7.429688,-4.875,0,7.429688,-4.230469,-1.85625,10.816895,-2.779907,-1.676074,11,-3.257813,0,12.132813,-0.37793,-1.279688,12.367188,-0.65625,0,12.97998,2.186646,-0.883301,13.265625,2.085938,0,14.960938,4.125,-0.703125,15.429688,4.125,0,7.429688,-2.8125,-2.475,10.414063,-1.728516,-2.234766,11.617188,.234375,-1.70625,12.351563,2.408203,-1.177734,13.929688,4.125,-0.9375,7.429688,-1.394531,-1.85625,10.01123,-0.677124,-1.676074,11.101563,.84668,-1.279688,11.723145,2.629761,-0.883301,12.898438,4.125,-0.703125,7.429688,-0.75,0,9.828125,-0.199219,0,10.867188,1.125,0,11.4375,2.730469,0,12.429688,4.125,0,12.429688,4.125,0,12.898438,4.125,.703125,13.291077,4.346237,.65918,12.789063,4.335938,0,13.525879,4.422729,.5625,13.054688,4.40625,0,13.532898,4.350357,.46582,13.132813,4.335938,0,13.242188,4.125,.421875,12.929688,4.125,0,13.929688,4.125,.9375,14.395508,4.368896,.878906,14.5625,4.458984,.75,14.413086,4.38208,.621094,13.929688,4.125,.5625,14.960938,4.125,.703125,15.499939,4.391556,.65918,15.599121,4.495239,.5625,15.293274,4.413804,.46582,14.617188,4.125,.421875,15.429688,4.125,0,16.001953,4.401855,0,16.070313,4.511719,0,15.693359,4.428224,0,14.929688,4.125,0,15.429688,4.125,0,14.960938,4.125,-0.703125,15.499939,4.391556,-0.65918,16.001953,4.401855,0,15.599121,4.495239,-0.5625,16.070313,4.511719,0,15.293274,4.413804,-0.46582,15.693359,4.428224,0,14.617188,4.125,-0.421875,14.929688,4.125,0,13.929688,4.125,-0.9375,14.395508,4.368896,-0.878906,14.5625,4.458984,-0.75,14.413086,4.38208,-0.621094,13.929688,4.125,-0.5625,12.898438,4.125,-0.703125,13.291077,4.346237,-0.65918,13.525879,4.422729,-0.5625,13.532898,4.350357,-0.46582,13.242188,4.125,-0.421875,12.429688,4.125,0,12.789063,4.335938,0,13.054688,4.40625,0,13.132813,4.335938,0,12.929688,4.125,0,.501414,7.628906,.670256,.632813,7.628906,0,-1.070312,7.875,0,.429278,7.03125,.639395,.554688,7.03125,0,-0.162029,6.292969,.38696,-0.085937,6.292969,0,-0.147812,5.625,.3925,-0.070312,5.625,0,.140489,7.628906,1.210801,-1.070312,7.875,0,.084844,7.03125,1.155156,-0.370879,6.292969,.699434,-0.360312,5.625,.71,-0.400056,7.628906,1.571726,-1.070312,7.875,0,-0.430918,7.03125,1.49959,-0.683352,6.292969,.908284,-0.677812,5.625,.9225,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.070312,7.03125,1.625,-1.070312,6.292969,.984375,-1.070312,5.625,1,-1.740569,7.628906,1.571726,-1.070312,7.628906,1.703125,-1.070312,7.875,0,-1.709707,7.03125,1.49959,-1.070312,7.03125,1.625,-1.457273,6.292969,.908284,-1.070312,6.292969,.984375,-1.462812,5.625,.9225,-1.070312,5.625,1,-2.281113,7.628906,1.210801,-1.070312,7.875,0,-2.225469,7.03125,1.155156,-1.769746,6.292969,.699434,-1.780312,5.625,.71,-2.642038,7.628906,.670256,-1.070312,7.875,0,-2.569902,7.03125,.639395,-1.978596,6.292969,.38696,-1.992812,5.625,.3925,-2.773438,7.628906,0,-1.070312,7.875,0,-2.695313,7.03125,0,-2.054687,6.292969,0,-2.070312,5.625,0,-2.642038,7.628906,-0.670256,-2.773438,7.628906,0,-1.070312,7.875,0,-2.569902,7.03125,-0.639395,-2.695313,7.03125,0,-1.978596,6.292969,-0.38696,-2.054687,6.292969,0,-1.992812,5.625,-0.3925,-2.070312,5.625,0,-2.281113,7.628906,-1.210801,-1.070312,7.875,0,-2.225469,7.03125,-1.155156,-1.769746,6.292969,-0.699434,-1.780312,5.625,-0.71,-1.740569,7.628906,-1.571726,-1.070312,7.875,0,-1.709707,7.03125,-1.49959,-1.457273,6.292969,-0.908284,-1.462812,5.625,-0.9225,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-1.070312,7.03125,-1.625,-1.070312,6.292969,-0.984375,-1.070312,5.625,-1,-0.400056,7.628906,-1.571726,-1.070312,7.628906,-1.703125,-1.070312,7.875,0,-0.430918,7.03125,-1.49959,-1.070312,7.03125,-1.625,-0.683352,6.292969,-0.908284,-1.070312,6.292969,-0.984375,-0.677812,5.625,-0.9225,-1.070312,5.625,-1,.140489,7.628906,-1.210801,-1.070312,7.875,0,.084844,7.03125,-1.155156,-0.370879,6.292969,-0.699434,-0.360312,5.625,-0.71,.501414,7.628906,-0.670256,-1.070312,7.875,0,.429278,7.03125,-0.639395,-0.162029,6.292969,-0.38696,-0.147812,5.625,-0.3925,.632813,7.628906,0,-1.070312,7.875,0,.554688,7.03125,0,-0.085937,6.292969,0,-0.070312,5.625,0,-0.070312,5.625,0,-0.147812,5.625,.3925,1.034141,5.179688,.895391,1.210938,5.179688,0,2.735,4.875,1.619062,3.054688,4.875,0,4.262891,4.570313,2.26914,4.710938,4.570313,0,4.925938,4.125,2.55125,5.429688,4.125,0,-0.360312,5.625,.71,.549375,5.179688,1.619688,1.858438,4.875,2.92875,3.034375,4.570313,4.104687,3.544688,4.125,4.615,-0.677812,5.625,.9225,-0.174922,5.179688,2.104453,.54875,4.875,3.805313,1.198828,4.570313,5.333203,1.480938,4.125,5.99625,-1.070312,5.625,1,-1.070312,5.179688,2.28125,-1.070312,4.875,4.125,-1.070312,4.570313,5.78125,-1.070312,4.125,6.5,-1.070312,5.625,1,-1.462812,5.625,.9225,-1.965703,5.179688,2.104453,-1.070312,5.179688,2.28125,-2.689375,4.875,3.805313,-1.070312,4.875,4.125,-3.339453,4.570313,5.333203,-1.070312,4.570313,5.78125,-3.621562,4.125,5.99625,-1.070312,4.125,6.5,-1.780312,5.625,.71,-2.69,5.179688,1.619688,-3.999062,4.875,2.92875,-5.174999,4.570313,4.104687,-5.685312,4.125,4.615,-1.992812,5.625,.3925,-3.174765,5.179688,.895391,-4.875625,4.875,1.619062,-6.403516,4.570313,2.26914,-7.066563,4.125,2.55125,-2.070312,5.625,0,-3.351562,5.179688,0,-5.195313,4.875,0,-6.851563,4.570313,0,-7.570313,4.125,0,-2.070312,5.625,0,-1.992812,5.625,-0.3925,-3.174765,5.179688,-0.895391,-3.351562,5.179688,0,-4.875625,4.875,-1.619062,-5.195313,4.875,0,-6.403516,4.570313,-2.26914,-6.851563,4.570313,0,-7.066563,4.125,-2.55125,-7.570313,4.125,0,-1.780312,5.625,-0.71,-2.69,5.179688,-1.619688,-3.999062,4.875,-2.92875,-5.174999,4.570313,-4.104687,-5.685312,4.125,-4.615,-1.462812,5.625,-0.9225,-1.965703,5.179688,-2.104453,-2.689375,4.875,-3.805313,-3.339453,4.570313,-5.333203,-3.621562,4.125,-5.99625,-1.070312,5.625,-1,-1.070312,5.179688,-2.28125,-1.070312,4.875,-4.125,-1.070312,4.570313,-5.78125,-1.070312,4.125,-6.5,-1.070312,5.625,-1,-0.677812,5.625,-0.9225,-0.174922,5.179688,-2.104453,-1.070312,5.179688,-2.28125,.54875,4.875,-3.805313,-1.070312,4.875,-4.125,1.198828,4.570313,-5.333203,-1.070312,4.570313,-5.78125,1.480938,4.125,-5.99625,-1.070312,4.125,-6.5,-0.360312,5.625,-0.71,.549375,5.179688,-1.619688,1.858438,4.875,-2.92875,3.034375,4.570313,-4.104687,3.544688,4.125,-4.615,-0.147812,5.625,-0.3925,1.034141,5.179688,-0.895391,2.735,4.875,-1.619062,4.262891,4.570313,-2.26914,4.925938,4.125,-2.55125,-0.070312,5.625,0,1.210938,5.179688,0,3.054688,4.875,0,4.710938,4.570313,0,5.429688,4.125,0],normals:[-0.966742,-0.255752,0,-0.893014,-0.256345,-0.369882,-0.893437,.255996,-0.369102,-0.966824,.255443,0,-0.083877,.995843,-0.035507,-0.092052,.995754,0,.629724,.73186,.260439,.68205,.731305,0,.803725,.49337,.332584,.870301,.492521,0,-0.683407,-0.256728,-0.683407,-0.683531,.256068,-0.683531,-0.064925,.995776,-0.064925,.481399,.732469,.481399,.614804,.493997,.614804,-0.369882,-0.256345,-0.893014,-0.369102,.255996,-0.893437,-0.035507,.995843,-0.083877,.260439,.73186,.629724,.332584,.493369,.803725,-0.002848,-0.257863,-0.966177,-0.001923,.254736,-0.967009,-0.000266,.995734,-0.09227,24e-6,.731295,.682061,0,.492521,.870301,-0.002848,-0.257863,-0.966177,.379058,-0.3593,-0.852771,.37711,.149085,-0.914091,-0.001923,.254736,-0.967009,.027502,.992081,-0.122552,-0.000266,.995734,-0.09227,-0.26101,.726762,.635367,24e-6,.731295,.682061,-0.332485,.492546,.804271,0,.492521,.870301,.663548,-0.41079,-0.625264,.712664,.073722,-0.697621,.099726,.987509,-0.121983,-0.48732,.723754,.488569,-0.615242,.492602,.615484,.880028,-0.332906,-0.338709,.917276,.167113,-0.361493,.113584,.992365,-0.04807,-0.63415,.727508,.261889,-0.804126,.492634,.332705,.96669,-0.255738,.010454,.967442,.252962,.008103,.093436,.995624,.001281,-0.682167,.731196,-0.000343,-0.870322,.492483,-0.000054,.96669,-0.255738,.010454,.893014,-0.256345,.369882,.893437,.255996,.369102,.967442,.252962,.008103,.083877,.995843,.035507,.093436,.995624,.001281,-0.629724,.73186,-0.260439,-0.682167,.731196,-0.000343,-0.803725,.49337,-0.332584,-0.870322,.492483,-0.000054,.683407,-0.256728,.683407,.683531,.256068,.683531,.064925,.995776,.064925,-0.481399,.732469,-0.481399,-0.614804,.493997,-0.614804,.369882,-0.256345,.893014,.369102,.255996,.893437,.035507,.995843,.083877,-0.260439,.73186,-0.629724,-0.332584,.493369,-0.803725,0,-0.255752,.966742,0,.255443,.966824,0,.995754,.092052,0,.731305,-0.68205,0,.492521,-0.870301,0,-0.255752,.966742,-0.369882,-0.256345,.893014,-0.369102,.255996,.893437,0,.255443,.966824,-0.035507,.995843,.083877,0,.995754,.092052,.260439,.73186,-0.629724,0,.731305,-0.68205,.332584,.49337,-0.803725,0,.492521,-0.870301,-0.683407,-0.256728,.683407,-0.683531,.256068,.683531,-0.064925,.995776,.064925,.481399,.732469,-0.481399,.614804,.493997,-0.614804,-0.893014,-0.256345,.369882,-0.893437,.255996,.369102,-0.083877,.995843,.035507,.629724,.73186,-0.260439,.803725,.493369,-0.332584,-0.966742,-0.255752,0,-0.966824,.255443,0,-0.092052,.995754,0,.68205,.731305,0,.870301,.492521,0,.870301,.492521,0,.803725,.49337,.332584,.845438,.403546,.349835,.915321,.402725,0,.869996,.336859,.360047,.941808,.336151,0,.904193,.205791,.37428,.97869,.205342,0,.921879,-0.06637,.381752,.997804,-0.06624,0,.614804,.493997,.614804,.646802,.404096,.646802,.665655,.337351,.665655,.691923,.20612,.691923,.705543,-0.06648,.705542,.332584,.493369,.803725,.349835,.403546,.845438,.360047,.336859,.869996,.37428,.205791,.904193,.381752,-0.066369,.921879,0,.492521,.870301,0,.402725,.915321,0,.336151,.941808,0,.205342,.97869,0,-0.06624,.997804,0,.492521,.870301,-0.332485,.492546,.804271,-0.349835,.403546,.845438,0,.402725,.915321,-0.360047,.336859,.869996,0,.336151,.941808,-0.37428,.205791,.904193,0,.205342,.97869,-0.381752,-0.06637,.921879,0,-0.06624,.997804,-0.615242,.492602,.615484,-0.646802,.404096,.646802,-0.665655,.337351,.665655,-0.691923,.20612,.691923,-0.705542,-0.06648,.705543,-0.804126,.492634,.332705,-0.845438,.403546,.349835,-0.869996,.336859,.360047,-0.904193,.205791,.37428,-0.921879,-0.066369,.381752,-0.870322,.492483,-0.000054,-0.915321,.402725,0,-0.941808,.336151,0,-0.97869,.205342,0,-0.997804,-0.06624,0,-0.870322,.492483,-0.000054,-0.803725,.49337,-0.332584,-0.845438,.403546,-0.349835,-0.915321,.402725,0,-0.869996,.336859,-0.360047,-0.941808,.336151,0,-0.904193,.205791,-0.37428,-0.97869,.205342,0,-0.921879,-0.06637,-0.381752,-0.997804,-0.06624,0,-0.614804,.493997,-0.614804,-0.646802,.404096,-0.646802,-0.665655,.337351,-0.665655,-0.691923,.20612,-0.691923,-0.705543,-0.06648,-0.705542,-0.332584,.493369,-0.803725,-0.349835,.403546,-0.845438,-0.360047,.336859,-0.869996,-0.37428,.205791,-0.904193,-0.381752,-0.066369,-0.921879,0,.492521,-0.870301,0,.402725,-0.915321,0,.336151,-0.941808,0,.205342,-0.97869,0,-0.06624,-0.997804,0,.492521,-0.870301,.332584,.49337,-0.803725,.349835,.403546,-0.845438,0,.402725,-0.915321,.360047,.336859,-0.869996,0,.336151,-0.941808,.37428,.205791,-0.904193,0,.205342,-0.97869,.381752,-0.06637,-0.921879,0,-0.06624,-0.997804,.614804,.493997,-0.614804,.646802,.404096,-0.646802,.665655,.337351,-0.665655,.691923,.20612,-0.691923,.705542,-0.06648,-0.705543,.803725,.493369,-0.332584,.845438,.403546,-0.349835,.869996,.336859,-0.360047,.904193,.205791,-0.37428,.921879,-0.066369,-0.381752,.870301,.492521,0,.915321,.402725,0,.941808,.336151,0,.97869,.205342,0,.997804,-0.06624,0,.997804,-0.06624,0,.921879,-0.06637,.381752,.831437,-0.43618,.344179,.900182,-0.435513,0,.673512,-0.684666,.278594,.729611,-0.683863,0,.640399,-0.720924,.264874,.693951,-0.720022,0,.732949,-0.608995,.303167,.79395,-0.607983,0,.705543,-0.06648,.705542,.636092,-0.436778,.636092,.514965,-0.68529,.514965,.489651,-0.721446,.489651,.560555,-0.609554,.560555,.381752,-0.066369,.921879,.344179,-0.43618,.831437,.278595,-0.684666,.673512,.264874,-0.720924,.640399,.303167,-0.608995,.732949,0,-0.06624,.997804,0,-0.435513,.900182,0,-0.683863,.729611,0,-0.720022,.693951,0,-0.607983,.79395,0,-0.06624,.997804,-0.381752,-0.06637,.921879,-0.344179,-0.43618,.831437,0,-0.435513,.900182,-0.278594,-0.684666,.673512,0,-0.683863,.729611,-0.264874,-0.720924,.640399,0,-0.720022,.693951,-0.303167,-0.608995,.732949,0,-0.607983,.79395,-0.705542,-0.06648,.705543,-0.636092,-0.436778,.636092,-0.514965,-0.68529,.514965,-0.489651,-0.721446,.489651,-0.560555,-0.609554,.560555,-0.921879,-0.066369,.381752,-0.831437,-0.43618,.344179,-0.673512,-0.684666,.278595,-0.640399,-0.720924,.264874,-0.732949,-0.608995,.303167,-0.997804,-0.06624,0,-0.900182,-0.435513,0,-0.729611,-0.683863,0,-0.693951,-0.720022,0,-0.79395,-0.607983,0,-0.997804,-0.06624,0,-0.921879,-0.06637,-0.381752,-0.831437,-0.43618,-0.344179,-0.900182,-0.435513,0,-0.673512,-0.684666,-0.278594,-0.729611,-0.683863,0,-0.640399,-0.720924,-0.264874,-0.693951,-0.720022,0,-0.732949,-0.608995,-0.303167,-0.79395,-0.607983,0,-0.705543,-0.06648,-0.705542,-0.636092,-0.436778,-0.636092,-0.514965,-0.68529,-0.514965,-0.489651,-0.721446,-0.489651,-0.560555,-0.609554,-0.560555,-0.381752,-0.066369,-0.921879,-0.344179,-0.43618,-0.831437,-0.278595,-0.684666,-0.673512,-0.264874,-0.720924,-0.640399,-0.303167,-0.608995,-0.732949,0,-0.06624,-0.997804,0,-0.435513,-0.900182,0,-0.683863,-0.729611,0,-0.720022,-0.693951,0,-0.607983,-0.79395,0,-0.06624,-0.997804,.381752,-0.06637,-0.921879,.344179,-0.43618,-0.831437,0,-0.435513,-0.900182,.278594,-0.684666,-0.673512,0,-0.683863,-0.729611,.264874,-0.720924,-0.640399,0,-0.720022,-0.693951,.303167,-0.608995,-0.732949,0,-0.607983,-0.79395,.705542,-0.06648,-0.705543,.636092,-0.436778,-0.636092,.514965,-0.68529,-0.514965,.489651,-0.721446,-0.489651,.560555,-0.609554,-0.560555,.921879,-0.066369,-0.381752,.831437,-0.43618,-0.344179,.673512,-0.684666,-0.278595,.640399,-0.720924,-0.264874,.732949,-0.608995,-0.303167,.997804,-0.06624,0,.900182,-0.435513,0,.729611,-0.683863,0,.693951,-0.720022,0,.79395,-0.607983,0,.79395,-0.607983,0,.732949,-0.608995,.303167,.57623,-0.781801,.238217,.62386,-0.781536,0,.163628,-0.984208,.067527,.177291,-0.984159,0,.045422,-0.998792,.018736,.049207,-0.998789,0,0,-1,0,.560555,-0.609554,.560555,.440416,-0.782348,.440416,.124903,-0.984276,.124903,.034662,-0.998798,.034662,0,-1,0,.303167,-0.608995,.732949,.238217,-0.781801,.57623,.067527,-0.984208,.163628,.018736,-0.998792,.045422,0,-1,0,0,-0.607983,.79395,0,-0.781536,.62386,0,-0.984159,.177291,0,-0.998789,.049207,0,-1,0,0,-0.607983,.79395,-0.303167,-0.608995,.732949,-0.238217,-0.781801,.57623,0,-0.781536,.62386,-0.067527,-0.984208,.163628,0,-0.984159,.177291,-0.018736,-0.998792,.045422,0,-0.998789,.049207,0,-1,0,-0.560555,-0.609554,.560555,-0.440416,-0.782348,.440416,-0.124903,-0.984276,.124903,-0.034662,-0.998798,.034662,0,-1,0,-0.732949,-0.608995,.303167,-0.57623,-0.781801,.238217,-0.163628,-0.984208,.067527,-0.045422,-0.998792,.018736,0,-1,0,-0.79395,-0.607983,0,-0.62386,-0.781536,0,-0.177291,-0.984159,0,-0.049207,-0.998789,0,0,-1,0,-0.79395,-0.607983,0,-0.732949,-0.608995,-0.303167,-0.57623,-0.781801,-0.238217,-0.62386,-0.781536,0,-0.163628,-0.984208,-0.067527,-0.177291,-0.984159,0,-0.045422,-0.998792,-0.018736,-0.049207,-0.998789,0,0,-1,0,-0.560555,-0.609554,-0.560555,-0.440416,-0.782348,-0.440416,-0.124903,-0.984276,-0.124903,-0.034662,-0.998798,-0.034662,0,-1,0,-0.303167,-0.608995,-0.732949,-0.238217,-0.781801,-0.57623,-0.067527,-0.984208,-0.163628,-0.018736,-0.998792,-0.045422,0,-1,0,0,-0.607983,-0.79395,0,-0.781536,-0.62386,0,-0.984159,-0.177291,0,-0.998789,-0.049207,0,-1,0,0,-0.607983,-0.79395,.303167,-0.608995,-0.732949,.238217,-0.781801,-0.57623,0,-0.781536,-0.62386,.067527,-0.984208,-0.163628,0,-0.984159,-0.177291,.018736,-0.998792,-0.045422,0,-0.998789,-0.049207,0,-1,0,.560555,-0.609554,-0.560555,.440416,-0.782348,-0.440416,.124903,-0.984276,-0.124903,.034662,-0.998798,-0.034662,0,-1,0,.732949,-0.608995,-0.303167,.57623,-0.781801,-0.238217,.163628,-0.984208,-0.067527,.045422,-0.998792,-0.018736,0,-1,0,.79395,-0.607983,0,.62386,-0.781536,0,.177291,-0.984159,0,.049207,-0.998789,0,0,-1,0,.007786,-0.99997,-0.000216,.007039,-0.812495,.582926,.036127,-0.837257,.545614,.039138,-0.999233,-0.000989,.161846,-0.810421,.563048,.179512,-0.983746,-0.004369,.482365,-0.595148,.642746,.612299,-0.790557,-0.01046,.73872,-0.114594,.664199,.986152,-0.165708,-0.00667,-0.001909,.162121,.986769,.002762,.017107,.99985,.010533,.073398,.997247,-0.066041,.13007,.989303,-0.094427,.016594,.995393,-0.009203,.871509,.490293,-0.048606,.840609,.539457,-0.223298,.80288,.552739,-0.596365,.559971,.575135,-0.803337,.068236,.591603,-0.010561,.999944,103e-6,-0.058798,.99827,71e-5,-0.28071,.959787,.003269,-0.749723,.661738,.004268,-0.997351,.072714,.002059,-0.010561,.999944,103e-6,-0.008792,.871493,-0.49033,-0.046494,.841178,-0.538756,-0.058798,.99827,71e-5,-0.217909,.806807,-0.549161,-0.28071,.959787,.003269,-0.597291,.560026,-0.574121,-0.749723,.661738,.004268,-0.804,.062913,-0.591292,-0.997351,.072714,.002059,-0.001806,.161691,-0.98684,.002031,.014555,-0.999892,.009215,.060069,-0.998152,-0.059334,.113865,-0.991723,-0.086899,.01229,-0.996141,.006418,-0.812379,-0.583095,.033783,-0.837512,-0.545373,.157113,-0.811947,-0.56219,.484406,-0.589366,-0.646528,.73887,-0.10132,-0.666187,.007786,-0.99997,-0.000216,.039138,-0.999233,-0.000989,.179512,-0.983746,-0.004369,.612299,-0.790557,-0.01046,.986152,-0.165708,-0.00667,.986152,-0.165708,-0.00667,.73872,-0.114594,.664199,.725608,.259351,.637361,.946512,.32265,-0.003357,.645945,.461988,.607719,.82583,.56387,-0.007452,.531615,.63666,.558614,.650011,.759893,-0.006937,.424964,.681717,.59554,.532429,.846459,-0.005245,-0.094427,.016594,.995393,-0.049562,-0.019755,.998576,-0.037816,-0.035624,.99865,-0.037914,-0.036512,.998614,-0.168854,-0.297945,.93953,-0.803337,.068236,.591603,-0.742342,-0.299166,.599523,-0.619602,-0.529406,.579502,-0.483708,-0.68576,.543837,-0.445293,-0.794355,.413177,-0.997351,.072714,.002059,-0.926513,-0.376258,.001996,-0.75392,-0.656952,.004317,-0.566224,-0.824244,.003461,-0.481804,-0.876277,.00185,-0.997351,.072714,.002059,-0.804,.062913,-0.591292,-0.744675,-0.294425,-0.598977,-0.926513,-0.376258,.001996,-0.621949,-0.528114,-0.578165,-0.75392,-0.656952,.004317,-0.481171,-0.68834,-0.542828,-0.566224,-0.824244,.003461,-0.438055,-0.797035,-0.415744,-0.481804,-0.876277,.00185,-0.086899,.01229,-0.996141,-0.044337,-0.017056,-0.998871,-0.026176,-0.028166,-0.99926,-0.025294,-0.028332,-0.999278,-0.157482,-0.289392,-0.944167,.73887,-0.10132,-0.666187,.728244,.25241,-0.637142,.647055,.459725,-0.608254,.522994,.640657,-0.56217,.409978,.682857,-0.604669,.986152,-0.165708,-0.00667,.946512,.32265,-0.003357,.82583,.56387,-0.007452,.650011,.759893,-0.006937,.532429,.846459,-0.005245,-0.230787,.972982,-0.006523,-0.152877,.687211,.71019,-0.316721,.63775,.702113,-0.548936,.835863,-0.001511,-0.601067,.471452,.64533,-0.875671,.482806,.009893,-0.635889,.44609,.629801,-0.877554,.479097,.019092,-0.435746,.601008,.670011,-0.69619,.717439,.024497,.111113,-0.08507,.99016,.22331,.00654,.974726,.190097,.154964,.969458,.005271,.189482,.98187,-0.011752,.246688,.969024,.343906,-0.722796,.599412,.572489,-0.567656,.591627,.787436,-0.256459,.560512,.647097,-0.306374,.698141,.427528,-0.499343,.753576,.410926,-0.911668,.001284,.67152,-0.740986,-0.000899,.922026,-0.38706,-0.007253,.84691,-0.531556,-0.013854,.535924,-0.844201,-0.010505,.410926,-0.911668,.001284,.341188,-0.722823,-0.600931,.578664,-0.561139,-0.591838,.67152,-0.740986,-0.000899,.784869,-0.25102,-0.566542,.922026,-0.38706,-0.007253,.642681,-0.302257,-0.70399,.84691,-0.531556,-0.013854,.418589,-0.500042,-0.758117,.535924,-0.844201,-0.010505,.115806,-0.079139,-0.990114,.232811,.012565,-0.972441,.206662,.153601,-0.96628,.0245,.161443,-0.986578,.003382,.211115,-0.977455,-0.134912,.687491,-0.713551,-0.31954,.633073,-0.705063,-0.603902,.461442,-0.649903,-0.631815,.437169,-0.640072,-0.424306,.612706,-0.66675,-0.230787,.972982,-0.006523,-0.548936,.835863,-0.001511,-0.875671,.482806,.009893,-0.877554,.479097,.019092,-0.69619,.717439,.024497,-0.69619,.717439,.024497,-0.435746,.601008,.670011,-0.259858,.791937,.552548,-0.425801,.904753,.010805,.009539,.99972,-0.021674,.022046,.999756,.001623,.410157,.332912,-0.849082,.999598,.025875,.011556,.541523,-0.548619,-0.637001,.709587,-0.704552,.009672,-0.011752,.246688,.969024,.046311,.455223,.889172,-0.010688,.988794,.1489,-0.044376,.682946,-0.72912,.122824,.009233,-0.992385,.427528,-0.499343,.753576,.481839,-0.18044,.85748,.455272,.736752,.499925,-0.220542,.907193,-0.358277,-0.235919,.65725,-0.715797,.535924,-0.844201,-0.010505,.728094,-0.6853,-0.015585,.888738,.458112,-0.016679,-0.260098,.965582,8e-4,-0.371611,.928378,-0.004418,.535924,-0.844201,-0.010505,.418589,-0.500042,-0.758117,.480165,-0.178362,-0.858853,.728094,-0.6853,-0.015585,.488102,.716802,-0.497947,.888738,.458112,-0.016679,-0.222004,.905399,.361892,-0.260098,.965582,8e-4,-0.235405,.66318,.710477,-0.371611,.928378,-0.004418,.003382,.211115,-0.977455,.05872,.437702,-0.8972,.001326,.986459,-0.164002,-0.04419,.681675,.730319,.138801,-0.034188,.98973,-0.424306,.612706,-0.66675,-0.25889,.797206,-0.54538,.01227,.999739,.019287,.398632,.35489,.845663,.537564,-0.581398,.610738,-0.69619,.717439,.024497,-0.425801,.904753,.010805,.022046,.999756,.001623,.999598,.025875,.011556,.709587,-0.704552,.009672,.76264,.565035,.314825,.82454,.565804,17e-6,0,1,0,.847982,-0.397998,.350034,.917701,-0.397272,34e-6,.864141,-0.355261,.356441,.935269,-0.353939,113e-6,.720992,.625625,.297933,.780712,.62489,75e-6,.583357,.565165,.583338,0,1,0,.648485,-0.398726,.648448,.660872,-0.355894,.660748,.551862,.62529,.55178,.314824,.565051,.762629,0,1,0,.350045,-0.397976,.847988,.356474,-0.355199,.864153,.297983,.625515,.721067,-0.000017,.565804,.82454,0,1,0,-0.000034,-0.397272,.917701,-0.000113,-0.353939,.935269,-0.000075,.62489,.780712,-0.314825,.565035,.76264,-0.000017,.565804,.82454,0,1,0,-0.350034,-0.397998,.847982,-0.000034,-0.397272,.917701,-0.356441,-0.355261,.864141,-0.000113,-0.353939,.935269,-0.297933,.625625,.720992,-0.000075,.62489,.780712,-0.583338,.565165,.583357,0,1,0,-0.648448,-0.398726,.648485,-0.660748,-0.355894,.660872,-0.55178,.62529,.551862,-0.762629,.565051,.314824,0,1,0,-0.847988,-0.397976,.350045,-0.864153,-0.355199,.356474,-0.721067,.625515,.297983,-0.82454,.565804,-0.000017,0,1,0,-0.917701,-0.397272,-0.000034,-0.935269,-0.353939,-0.000113,-0.780712,.62489,-0.000075,-0.76264,.565035,-0.314825,-0.82454,.565804,-0.000017,0,1,0,-0.847982,-0.397998,-0.350034,-0.917701,-0.397272,-0.000034,-0.864141,-0.355261,-0.356441,-0.935269,-0.353939,-0.000113,-0.720992,.625625,-0.297933,-0.780712,.62489,-0.000075,-0.583357,.565165,-0.583338,0,1,0,-0.648485,-0.398726,-0.648448,-0.660872,-0.355894,-0.660748,-0.551862,.62529,-0.55178,-0.314824,.565051,-0.762629,0,1,0,-0.350045,-0.397976,-0.847988,-0.356474,-0.355199,-0.864153,-0.297983,.625515,-0.721067,17e-6,.565804,-0.82454,0,1,0,34e-6,-0.397272,-0.917701,113e-6,-0.353939,-0.935269,75e-6,.62489,-0.780712,.314825,.565035,-0.76264,17e-6,.565804,-0.82454,0,1,0,.350034,-0.397998,-0.847982,34e-6,-0.397272,-0.917701,.356441,-0.355261,-0.864141,113e-6,-0.353939,-0.935269,.297933,.625625,-0.720992,75e-6,.62489,-0.780712,.583338,.565165,-0.583357,0,1,0,.648448,-0.398726,-0.648485,.660748,-0.355894,-0.660872,.55178,.62529,-0.551862,.762629,.565051,-0.314824,0,1,0,.847988,-0.397976,-0.350045,.864153,-0.355199,-0.356474,.721067,.625515,-0.297983,.82454,.565804,17e-6,0,1,0,.917701,-0.397272,34e-6,.935269,-0.353939,113e-6,.780712,.62489,75e-6,.780712,.62489,75e-6,.720992,.625625,.297933,.217978,.971775,.090216,.236583,.971611,0,.159589,.984977,.065961,.173084,.984907,0,.350498,.925311,.14474,.379703,.925108,0,.48559,.850653,.201474,.526673,.850068,0,.551862,.62529,.55178,.166631,.971838,.166631,.121908,.985026,.121908,.267668,.925585,.267668,.371315,.851029,.371315,.297983,.625515,.721067,.090216,.971775,.217978,.065961,.984977,.159589,.14474,.925311,.350498,.201475,.850653,.48559,-0.000075,.62489,.780712,0,.971611,.236583,0,.984907,.173084,0,.925108,.379703,0,.850068,.526673,-0.000075,.62489,.780712,-0.297933,.625625,.720992,-0.090216,.971775,.217978,0,.971611,.236583,-0.065961,.984977,.159589,0,.984907,.173084,-0.14474,.925311,.350498,0,.925108,.379703,-0.201474,.850653,.48559,0,.850068,.526673,-0.55178,.62529,.551862,-0.166631,.971838,.166631,-0.121908,.985026,.121908,-0.267668,.925585,.267668,-0.371315,.851029,.371315,-0.721067,.625515,.297983,-0.217978,.971775,.090216,-0.159589,.984977,.065961,-0.350498,.925311,.14474,-0.48559,.850653,.201475,-0.780712,.62489,-0.000075,-0.236583,.971611,0,-0.173084,.984907,0,-0.379703,.925108,0,-0.526673,.850068,0,-0.780712,.62489,-0.000075,-0.720992,.625625,-0.297933,-0.217978,.971775,-0.090216,-0.236583,.971611,0,-0.159589,.984977,-0.065961,-0.173084,.984907,0,-0.350498,.925311,-0.14474,-0.379703,.925108,0,-0.48559,.850653,-0.201474,-0.526673,.850068,0,-0.551862,.62529,-0.55178,-0.166631,.971838,-0.166631,-0.121908,.985026,-0.121908,-0.267668,.925585,-0.267668,-0.371315,.851029,-0.371315,-0.297983,.625515,-0.721067,-0.090216,.971775,-0.217978,-0.065961,.984977,-0.159589,-0.14474,.925311,-0.350498,-0.201475,.850653,-0.48559,75e-6,.62489,-0.780712,0,.971611,-0.236583,0,.984907,-0.173084,0,.925108,-0.379703,0,.850068,-0.526673,75e-6,.62489,-0.780712,.297933,.625625,-0.720992,.090216,.971775,-0.217978,0,.971611,-0.236583,.065961,.984977,-0.159589,0,.984907,-0.173084,.14474,.925311,-0.350498,0,.925108,-0.379703,.201474,.850653,-0.48559,0,.850068,-0.526673,.55178,.62529,-0.551862,.166631,.971838,-0.166631,.121908,.985026,-0.121908,.267668,.925585,-0.267668,.371315,.851029,-0.371315,.721067,.625515,-0.297983,.217978,.971775,-0.090216,.159589,.984977,-0.065961,.350498,.925311,-0.14474,.48559,.850653,-0.201475,.780712,.62489,75e-6,.236583,.971611,0,.173084,.984907,0,.379703,.925108,0,.526673,.850068,0],textureCoords:[2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,.75,2,.75,1.975,1,1.975,.75,1.95,1,1.95,.75,1.925,1,1.925,.75,1.9,1,1.9,.5,2,.5,1.975,.5,1.95,.5,1.925,.5,1.9,.25,2,.25,1.975,.25,1.95,.25,1.925,.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,2,1.75,2,1.75,1.975,2,1.975,1.75,1.95,2,1.95,1.75,1.925,2,1.925,1.75,1.9,2,1.9,1.5,2,1.5,1.975,1.5,1.95,1.5,1.925,1.5,1.9,1.25,2,1.25,1.975,1.25,1.95,1.25,1.925,1.25,1.9,1,2,1,1.975,1,1.95,1,1.925,1,1.9,1,2,.75,2,.75,1.975,1,1.975,.75,1.95,1,1.95,.75,1.925,1,1.925,.75,1.9,1,1.9,.5,2,.5,1.975,.5,1.95,.5,1.925,.5,1.9,.25,2,.25,1.975,.25,1.95,.25,1.925,.25,1.9,0,2,0,1.975,0,1.95,0,1.925,0,1.9,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,.75,1.9,.75,1.675,1,1.675,.75,1.45,1,1.45,.75,1.225,1,1.225,.75,1,1,1,.5,1.9,.5,1.675,.5,1.45,.5,1.225,.5,1,.25,1.9,.25,1.675,.25,1.45,.25,1.225,.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1.9,1.75,1.9,1.75,1.675,2,1.675,1.75,1.45,2,1.45,1.75,1.225,2,1.225,1.75,1,2,1,1.5,1.9,1.5,1.675,1.5,1.45,1.5,1.225,1.5,1,1.25,1.9
,1.25,1.675,1.25,1.45,1.25,1.225,1.25,1,1,1.9,1,1.675,1,1.45,1,1.225,1,1,1,1.9,.75,1.9,.75,1.675,1,1.675,.75,1.45,1,1.45,.75,1.225,1,1.225,.75,1,1,1,.5,1.9,.5,1.675,.5,1.45,.5,1.225,.5,1,.25,1.9,.25,1.675,.25,1.45,.25,1.225,.25,1,0,1.9,0,1.675,0,1.45,0,1.225,0,1,2,1,1.75,1,1.75,.85,2,.85,1.75,.7,2,.7,1.75,.55,2,.55,1.75,.4,2,.4,1.5,1,1.5,.85,1.5,.7,1.5,.55,1.5,.4,1.25,1,1.25,.85,1.25,.7,1.25,.55,1.25,.4,1,1,1,.85,1,.7,1,.55,1,.4,1,1,.75,1,.75,.85,1,.85,.75,.7,1,.7,.75,.55,1,.55,.75,.4,1,.4,.5,1,.5,.85,.5,.7,.5,.55,.5,.4,.25,1,.25,.85,.25,.7,.25,.55,.25,.4,0,1,0,.85,0,.7,0,.55,0,.4,2,1,1.75,1,1.75,.85,2,.85,1.75,.7,2,.7,1.75,.55,2,.55,1.75,.4,2,.4,1.5,1,1.5,.85,1.5,.7,1.5,.55,1.5,.4,1.25,1,1.25,.85,1.25,.7,1.25,.55,1.25,.4,1,1,1,.85,1,.7,1,.55,1,.4,1,1,.75,1,.75,.85,1,.85,.75,.7,1,.7,.75,.55,1,.55,.75,.4,1,.4,.5,1,.5,.85,.5,.7,.5,.55,.5,.4,.25,1,.25,.85,.25,.7,.25,.55,.25,.4,0,1,0,.85,0,.7,0,.55,0,.4,2,.4,1.75,.4,1.75,.3,2,.3,1.75,.2,2,.2,1.75,.1,2,.1,1.75,0,1.5,.4,1.5,.3,1.5,.2,1.5,.1,1.5,0,1.25,.4,1.25,.3,1.25,.2,1.25,.1,1.25,0,1,.4,1,.3,1,.2,1,.1,1,0,1,.4,.75,.4,.75,.3,1,.3,.75,.2,1,.2,.75,.1,1,.1,.75,0,.5,.4,.5,.3,.5,.2,.5,.1,.5,0,.25,.4,.25,.3,.25,.2,.25,.1,.25,0,0,.4,0,.3,0,.2,0,.1,0,0,2,.4,1.75,.4,1.75,.3,2,.3,1.75,.2,2,.2,1.75,.1,2,.1,1.75,0,1.5,.4,1.5,.3,1.5,.2,1.5,.1,1.5,0,1.25,.4,1.25,.3,1.25,.2,1.25,.1,1.25,0,1,.4,1,.3,1,.2,1,.1,1,0,1,.4,.75,.4,.75,.3,1,.3,.75,.2,1,.2,.75,.1,1,.1,.75,0,.5,.4,.5,.3,.5,.2,.5,.1,.5,0,.25,.4,.25,.3,.25,.2,.25,.1,.25,0,0,.4,0,.3,0,.2,0,.1,0,0,1,1,.875,1,.875,.875,1,.875,.875,.75,1,.75,.875,.625,1,.625,.875,.5,1,.5,.75,1,.75,.875,.75,.75,.75,.625,.75,.5,.625,1,.625,.875,.625,.75,.625,.625,.625,.5,.5,1,.5,.875,.5,.75,.5,.625,.5,.5,.5,1,.375,1,.375,.875,.5,.875,.375,.75,.5,.75,.375,.625,.5,.625,.375,.5,.5,.5,.25,1,.25,.875,.25,.75,.25,.625,.25,.5,.125,1,.125,.875,.125,.75,.125,.625,.125,.5,0,1,0,.875,0,.75,0,.625,0,.5,1,.5,.875,.5,.875,.375,1,.375,.875,.25,1,.25,.875,.125,1,.125,.875,0,1,0,.75,.5,.75,.375,.75,.25,.75,.125,.75,0,.625,.5,.625,.375,.625,.25,.625,.125,.625,0,.5,.5,.5,.375,.5,.25,.5,.125,.5,0,.5,.5,.375,.5,.375,.375,.5,.375,.375,.25,.5,.25,.375,.125,.5,.125,.375,0,.5,0,.25,.5,.25,.375,.25,.25,.25,.125,.25,0,.125,.5,.125,.375,.125,.25,.125,.125,.125,0,0,.5,0,.375,0,.25,0,.125,0,0,.5,0,.625,0,.625,.225,.5,.225,.625,.45,.5,.45,.625,.675,.5,.675,.625,.9,.5,.9,.75,0,.75,.225,.75,.45,.75,.675,.75,.9,.875,0,.875,.225,.875,.45,.875,.675,.875,.9,1,0,1,.225,1,.45,1,.675,1,.9,0,0,.125,0,.125,.225,0,.225,.125,.45,0,.45,.125,.675,0,.675,.125,.9,0,.9,.25,0,.25,.225,.25,.45,.25,.675,.25,.9,.375,0,.375,.225,.375,.45,.375,.675,.375,.9,.5,0,.5,.225,.5,.45,.5,.675,.5,.9,.5,.9,.625,.9,.625,.925,.5,.925,.625,.95,.5,.95,.625,.975,.5,.975,.625,1,.5,1,.75,.9,.75,.925,.75,.95,.75,.975,.75,1,.875,.9,.875,.925,.875,.95,.875,.975,.875,1,1,.9,1,.925,1,.95,1,.975,1,1,0,.9,.125,.9,.125,.925,0,.925,.125,.95,0,.95,.125,.975,0,.975,.125,1,0,1,.25,.9,.25,.925,.25,.95,.25,.975,.25,1,.375,.9,.375,.925,.375,.95,.375,.975,.375,1,.5,.9,.5,.925,.5,.95,.5,.975,.5,1,.875,.75,1,.75,1,1,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,.75,.875,1,.75,.5,.75,.25,.75,0,.625,.75,.75,1,.625,.5,.625,.25,.625,0,.5,.75,.625,1,.5,.5,.5,.25,.5,0,.375,.75,.5,.75,.5,1,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,.75,.375,1,.25,.5,.25,.25,.25,0,.125,.75,.25,1,.125,.5,.125,.25,.125,0,0,.75,.125,1,0,.5,0,.25,0,0,.875,.75,1,.75,1,1,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,.75,.875,1,.75,.5,.75,.25,.75,0,.625,.75,.75,1,.625,.5,.625,.25,.625,0,.5,.75,.625,1,.5,.5,.5,.25,.5,0,.375,.75,.5,.75,.5,1,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,.75,.375,1,.25,.5,.25,.25,.25,0,.125,.75,.25,1,.125,.5,.125,.25,.125,0,0,.75,.125,1,0,.5,0,.25,0,0,1,1,.875,1,.875,.75,1,.75,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,1,.75,.75,.75,.5,.75,.25,.75,0,.625,1,.625,.75,.625,.5,.625,.25,.625,0,.5,1,.5,.75,.5,.5,.5,.25,.5,0,.5,1,.375,1,.375,.75,.5,.75,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,1,.25,.75,.25,.5,.25,.25,.25,0,.125,1,.125,.75,.125,.5,.125,.25,.125,0,0,1,0,.75,0,.5,0,.25,0,0,1,1,.875,1,.875,.75,1,.75,.875,.5,1,.5,.875,.25,1,.25,.875,0,1,0,.75,1,.75,.75,.75,.5,.75,.25,.75,0,.625,1,.625,.75,.625,.5,.625,.25,.625,0,.5,1,.5,.75,.5,.5,.5,.25,.5,0,.5,1,.375,1,.375,.75,.5,.75,.375,.5,.5,.5,.375,.25,.5,.25,.375,0,.5,0,.25,1,.25,.75,.25,.5,.25,.25,.25,0,.125,1,.125,.75,.125,.5,.125,.25,.125,0,0,1,0,.75,0,.5,0,.25,0,0],indices:[0,1,2,2,3,0,3,2,4,4,5,3,5,4,6,6,7,5,7,6,8,8,9,7,1,10,11,11,2,1,2,11,12,12,4,2,4,12,13,13,6,4,6,13,14,14,8,6,10,15,16,16,11,10,11,16,17,17,12,11,12,17,18,18,13,12,13,18,19,19,14,13,15,20,21,21,16,15,16,21,22,22,17,16,17,22,23,23,18,17,18,23,24,24,19,18,25,26,27,27,28,25,28,27,29,29,30,28,30,29,31,31,32,30,32,31,33,33,34,32,26,35,36,36,27,26,27,36,37,37,29,27,29,37,38,38,31,29,31,38,39,39,33,31,35,40,41,41,36,35,36,41,42,42,37,36,37,42,43,43,38,37,38,43,44,44,39,38,40,45,46,46,41,40,41,46,47,47,42,41,42,47,48,48,43,42,43,48,49,49,44,43,50,51,52,52,53,50,53,52,54,54,55,53,55,54,56,56,57,55,57,56,58,58,59,57,51,60,61,61,52,51,52,61,62,62,54,52,54,62,63,63,56,54,56,63,64,64,58,56,60,65,66,66,61,60,61,66,67,67,62,61,62,67,68,68,63,62,63,68,69,69,64,63,65,70,71,71,66,65,66,71,72,72,67,66,67,72,73,73,68,67,68,73,74,74,69,68,75,76,77,77,78,75,78,77,79,79,80,78,80,79,81,81,82,80,82,81,83,83,84,82,76,85,86,86,77,76,77,86,87,87,79,77,79,87,88,88,81,79,81,88,89,89,83,81,85,90,91,91,86,85,86,91,92,92,87,86,87,92,93,93,88,87,88,93,94,94,89,88,90,95,96,96,91,90,91,96,97,97,92,91,92,97,98,98,93,92,93,98,99,99,94,93,100,101,102,102,103,100,103,102,104,104,105,103,105,104,106,106,107,105,107,106,108,108,109,107,101,110,111,111,102,101,102,111,112,112,104,102,104,112,113,113,106,104,106,113,114,114,108,106,110,115,116,116,111,110,111,116,117,117,112,111,112,117,118,118,113,112,113,118,119,119,114,113,115,120,121,121,116,115,116,121,122,122,117,116,117,122,123,123,118,117,118,123,124,124,119,118,125,126,127,127,128,125,128,127,129,129,130,128,130,129,131,131,132,130,132,131,133,133,134,132,126,135,136,136,127,126,127,136,137,137,129,127,129,137,138,138,131,129,131,138,139,139,133,131,135,140,141,141,136,135,136,141,142,142,137,136,137,142,143,143,138,137,138,143,144,144,139,138,140,145,146,146,141,140,141,146,147,147,142,141,142,147,148,148,143,142,143,148,149,149,144,143,150,151,152,152,153,150,153,152,154,154,155,153,155,154,156,156,157,155,157,156,158,158,159,157,151,160,161,161,152,151,152,161,162,162,154,152,154,162,163,163,156,154,156,163,164,164,158,156,160,165,166,166,161,160,161,166,167,167,162,161,162,167,168,168,163,162,163,168,169,169,164,163,165,170,171,171,166,165,166,171,172,172,167,166,167,172,173,173,168,167,168,173,174,174,169,168,175,176,177,177,178,175,178,177,179,179,180,178,180,179,181,181,182,180,182,181,183,183,184,182,176,185,186,186,177,176,177,186,187,187,179,177,179,187,188,188,181,179,181,188,189,189,183,181,185,190,191,191,186,185,186,191,192,192,187,186,187,192,193,193,188,187,188,193,194,194,189,188,190,195,196,196,191,190,191,196,197,197,192,191,192,197,198,198,193,192,193,198,199,199,194,193,200,201,202,202,203,200,203,202,204,204,205,203,205,204,206,206,207,205,207,206,208,208,209,207,201,210,211,211,202,201,202,211,212,212,204,202,204,212,213,213,206,204,206,213,214,214,208,206,210,215,216,216,211,210,211,216,217,217,212,211,212,217,218,218,213,212,213,218,219,219,214,213,215,220,221,221,216,215,216,221,222,222,217,216,217,222,223,223,218,217,218,223,224,224,219,218,225,226,227,227,228,225,228,227,229,229,230,228,230,229,231,231,232,230,232,231,233,233,234,232,226,235,236,236,227,226,227,236,237,237,229,227,229,237,238,238,231,229,231,238,239,239,233,231,235,240,241,241,236,235,236,241,242,242,237,236,237,242,243,243,238,237,238,243,244,244,239,238,240,245,246,246,241,240,241,246,247,247,242,241,242,247,248,248,243,242,243,248,249,249,244,243,250,251,252,252,253,250,253,252,254,254,255,253,255,254,256,256,257,255,257,256,258,258,259,257,251,260,261,261,252,251,252,261,262,262,254,252,254,262,263,263,256,254,256,263,264,264,258,256,260,265,266,266,261,260,261,266,267,267,262,261,262,267,268,268,263,262,263,268,269,269,264,263,265,270,271,271,266,265,266,271,272,272,267,266,267,272,273,273,268,267,268,273,274,274,269,268,275,276,277,277,278,275,278,277,279,279,280,278,280,279,281,281,282,280,282,281,283,283,284,282,276,285,286,286,277,276,277,286,287,287,279,277,279,287,288,288,281,279,281,288,289,289,283,281,285,290,291,291,286,285,286,291,292,292,287,286,287,292,293,293,288,287,288,293,294,294,289,288,290,295,296,296,291,290,291,296,297,297,292,291,292,297,298,298,293,292,293,298,299,299,294,293,300,301,302,302,303,300,303,302,304,304,305,303,305,304,306,306,307,305,307,306,308,301,309,310,310,302,301,302,310,311,311,304,302,304,311,312,312,306,304,306,312,313,309,314,315,315,310,309,310,315,316,316,311,310,311,316,317,317,312,311,312,317,318,314,319,320,320,315,314,315,320,321,321,316,315,316,321,322,322,317,316,317,322,323,324,325,326,326,327,324,327,326,328,328,329,327,329,328,330,330,331,329,331,330,332,325,333,334,334,326,325,326,334,335,335,328,326,328,335,336,336,330,328,330,336,337,333,338,339,339,334,333,334,339,340,340,335,334,335,340,341,341,336,335,336,341,342,338,343,344,344,339,338,339,344,345,345,340,339,340,345,346,346,341,340,341,346,347,348,349,350,350,351,348,351,350,352,352,353,351,353,352,354,354,355,353,355,354,356,349,357,358,358,350,349,350,358,359,359,352,350,352,359,360,360,354,352,354,360,361,357,362,363,363,358,357,358,363,364,364,359,358,359,364,365,365,360,359,360,365,366,362,367,368,368,363,362,363,368,369,369,364,363,364,369,370,370,365,364,365,370,371,372,373,374,374,375,372,375,374,376,376,377,375,377,376,378,378,379,377,379,378,380,373,381,382,382,374,373,374,382,383,383,376,374,376,383,384,384,378,376,378,384,385,381,386,387,387,382,381,382,387,388,388,383,382,383,388,389,389,384,383,384,389,390,386,391,392,392,387,386,387,392,393,393,388,387,388,393,394,394,389,388,389,394,395,396,397,398,398,399,396,399,398,400,400,401,399,401,400,402,402,403,401,403,402,404,404,405,403,397,406,407,407,398,397,398,407,408,408,400,398,400,408,409,409,402,400,402,409,410,410,404,402,406,411,412,412,407,406,407,412,413,413,408,407,408,413,414,414,409,408,409,414,415,415,410,409,411,416,417,417,412,411,412,417,418,418,413,412,413,418,419,419,414,413,414,419,420,420,415,414,421,422,423,423,424,421,424,423,425,425,426,424,426,425,427,427,428,426,428,427,429,429,430,428,422,431,432,432,423,422,423,432,433,433,425,423,425,433,434,434,427,425,427,434,435,435,429,427,431,436,437,437,432,431,432,437,438,438,433,432,433,438,439,439,434,433,434,439,440,440,435,434,436,441,442,442,437,436,437,442,443,443,438,437,438,443,444,444,439,438,439,444,445,445,440,439,446,447,448,448,449,446,449,448,450,450,451,449,451,450,452,452,453,451,453,452,454,454,455,453,447,456,457,457,448,447,448,457,458,458,450,448,450,458,459,459,452,450,452,459,460,460,454,452,456,461,462,462,457,456,457,462,463,463,458,457,458,463,464,464,459,458,459,464,465,465,460,459,461,466,467,467,462,461,462,467,468,468,463,462,463,468,469,469,464,463,464,469,470,470,465,464,471,472,473,473,474,471,474,473,475,475,476,474,476,475,477,477,478,476,478,477,479,479,480,478,472,481,482,482,473,472,473,482,483,483,475,473,475,483,484,484,477,475,477,484,485,485,479,477,481,486,487,487,482,481,482,487,488,488,483,482,483,488,489,489,484,483,484,489,490,490,485,484,486,491,492,492,487,486,487,492,493,493,488,487,488,493,494,494,489,488,489,494,495,495,490,489,496,497,498,498,499,496,499,498,500,500,501,499,501,500,502,502,503,501,503,502,504,504,505,503,497,506,507,507,498,497,498,507,508,508,500,498,500,508,509,509,502,500,502,509,510,510,504,502,506,511,512,512,507,506,507,512,513,513,508,507,508,513,514,514,509,508,509,514,515,515,510,509,511,516,517,517,512,511,512,517,518,518,513,512,513,518,519,519,514,513,514,519,520,520,515,514,521,522,523,523,524,521,524,523,525,525,526,524,526,525,527,527,528,526,528,527,529,529,530,528,522,531,532,532,523,522,523,532,533,533,525,523,525,533,534,534,527,525,527,534,535,535,529,527,531,536,537,537,532,531,532,537,538,538,533,532,533,538,539,539,534,533,534,539,540,540,535,534,536,541,542,542,537,536,537,542,543,543,538,537,538,543,544,544,539,538,539,544,545,545,540,539,546,547,548,548,549,546,549,548,550,550,551,549,551,550,552,552,553,551,553,552,554,554,555,553,547,556,557,557,548,547,548,557,558,558,550,548,550,558,559,559,552,550,552,559,560,560,554,552,556,561,562,562,557,556,557,562,563,563,558,557,558,563,564,564,559,558,559,564,565,565,560,559,561,566,567,567,562,561,562,567,568,568,563,562,563,568,569,569,564,563,564,569,570,570,565,564,571,572,573,573,574,571,574,573,575,575,576,574,576,575,577,577,578,576,578,577,579,579,580,578,572,581,582,582,573,572,573,582,583,583,575,573,575,583,584,584,577,575,577,584,585,585,579,577,581,586,587,587,582,581,582,587,588,588,583,582,583,588,589,589,584,583,584,589,590,590,585,584,586,591,592,592,587,586,587,592,593,593,588,587,588,593,594,594,589,588,589,594,595,595,590,589,596,597,598,597,596,599,599,600,597,600,599,601,601,602,600,602,601,603,603,604,602,605,596,606,596,605,607,607,599,596,599,607,608,608,601,599,601,608,609,609,603,601,610,605,611,605,610,612,612,607,605,607,612,613,613,608,607,608,613,614,614,609,608,615,610,616,610,615,617,617,612,610,612,617,618,618,613,612,613,618,619,619,614,613,620,621,622,621,620,623,623,624,621,624,623,625,625,626,624,626,625,627,627,628,626,629,620,630,620,629,631,631,623,620,623,631,632,632,625,623,625,632,633,633,627,625,634,629,635,629,634,636,636,631,629,631,636,637,637,632,631,632,637,638,638,633,632,639,634,640,634,639,641,641,636,634,636,641,642,642,637,636,637,642,643,643,638,637,644,645,646,645,644,647,647,648,645,648,647,649,649,650,648,650,649,651,651,652,650,653,644,654,644,653,655,655,647,644,647,655,656,656,649,647,649,656,657,657,651,649,658,653,659,653,658,660,660,655,653,655,660,661,661,656,655,656,661,662,662,657,656,663,658,664,658,663,665,665,660,658,660,665,666,666,661,660,661,666,667,667,662,661,668,669,670,669,668,671,671,672,669,672,671,673,673,674,672,674,673,675,675,676,674,677,668,678,668,677,679,679,671,668,671,679,680,680,673,671,673,680,681,681,675,673,682,677,683,677,682,684,684,679,677,679,684,685,685,680,679,680,685,686,686,681,680,687,682,688,682,687,689,689,684,682,684,689,690,690,685,684,685,690,691,691,686,685,692,693,694,694,695,692,695,694,696,696,697,695,697,696,698,698,699,697,699,698,700,700,701,699,693,702,703,703,694,693,694,703,704,704,696,694,696,704,705,705,698,696,698,705,706,706,700,698,702,707,708,708,703,702,703,708,709,709,704,703,704,709,710,710,705,704,705,710,711,711,706,705,707,712,713,713,708,707,708,713,714,714,709,708,709,714,715,715,710,709,710,715,716,716,711,710,717,718,719,719,720,717,720,719,721,721,722,720,722,721,723,723,724,722,724,723,725,725,726,724,718,727,728,728,719,718,719,728,729,729,721,719,721,729,730,730,723,721,723,730,731,731,725,723,727,732,733,733,728,727,728,733,734,734,729,728,729,734,735,735,730,729,730,735,736,736,731,730,732,737,738,738,733,732,733,738,739,739,734,733,734,739,740,740,735,734,735,740,741,741,736,735,742,743,744,744,745,742,745,744,746,746,747,745,747,746,748,748,749,747,749,748,750,750,751,749,743,752,753,753,744,743,744,753,754,754,746,744,746,754,755,755,748,746,748,755,756,756,750,748,752,757,758,758,753,752,753,758,759,759,754,753,754,759,760,760,755,754,755,760,761,761,756,755,757,762,763,763,758,757,758,763,764,764,759,758,759,764,765,765,760,759,760,765,766,766,761,760,767,768,769,769,770,767,770,769,771,771,772,770,772,771,773,773,774,772,774,773,775,775,776,774,768,777,778,778,769,768,769,778,779,779,771,769,771,779,780,780,773,771,773,780,781,781,775,773,777,782,783,783,778,777,778,783,784,784,779,778,779,784,785,785,780,779,780,785,786,786,781,780,782,787,788,788,783,782,783,788,789,789,784,783,784,789,790,790,785,784,785,790,791,791,786,785]};return Jax.Class.create(Jax.Mesh,{initialize:function($super,e){this.size=e&&e.size||1,$super(e)},init:function(t,n,r,i,s){var o,u,a=null;for(o=0;o<e.vertices.length;o++)if(a==null||e.vertices[o]>a)a=e.vertices[o];u=this.size/a;for(o=0;o<e.vertices.length;o++)t.push(e.vertices[o]*u);for(o=0;o<e.normals.length;o++)i.push(e.normals[o]);for(o=0;o<e.textureCoords.length;o++)r.push(e.textureCoords[o]);for(o=0;o<e.indices.length;o++)s.push(e.indices[o])}})}(),Jax.shaders={},Jax._shader_data={},Jax.import_shader_code=function(e,t){var n="IMPORT_"+e+"_"+t;return"#ifndef "+n+"\n"+"#define "+n+" 1\n"+Jax.shader_data(e)[t]+"#endif\n"},Jax.shader_data=function(e){return Jax._shader_data[e]=Jax._shader_data[e]||{name:e},Jax._shader_data[e]},Jax.views=new Jax.ViewManager,Jax.routes=new Jax.RouteSet,Jax.loaded=!0,Jax.render_speed=16,Jax.update_speed=33,Jax.max_lights=undefined,Jax.uptime=0,Jax.uptime_tracker=new Date,Jax.shutdown=function(){Jax.uptime_interval&&clearInterval(Jax.uptime_interval),Jax.uptime_interval=null,Jax.SHUTDOWN_IN_PROGRESS=!0},Jax.restart=function(){Jax.SHUTDOWN_IN_PROGRESS=!1,Jax.uptime_interval||(Jax.uptime_interval=setInterval(function(){Jax.uptime=(new Date-Jax.uptime_tracker)/1e3},33))},Jax.restart();var LightSource=Jax.Scene.LightSource,Material=Jax.Material;typeof exports!="undefined"&&(exports.Jax=Jax,exports.mat4=mat4,exports.mat3=mat3,exports.vec3=vec3,exports.glMatrixArrayType=glMatrixArrayType,exports.quat4=quat4),Jax.getGlobal().ApplicationHelper=Jax.Helper.create({}),function(){Jax.views.push("Teapot/index",function(){return this.glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),this.world.render()})}.call(this),function(){Jax.getGlobal().ApplicationController=Jax.Controller.create("Application",{helpers:[]})}(),function(){var e;e={forward:0,backward:0,left:0,right:0},Jax.Controller.create("Teapot",ApplicationController,{size:1,rotation_speed:1,index:function(){var e,t;return this.teapot=new Jax.Model({position:[0,0,-5],direction:[3,0,3],mesh:new Jax.Mesh.Cube({material:"teapot"})}),e=new Jax.Model({mesh:new Jax.Mesh.Sphere({radius:25,material:Material.find("skybox")})}),this.skybox=this.world.addObject(e),this.world.addObject(this.teapot),this.world.addLightSource("sun"),this.player.camera.lookAt([0,0,-5],[0,1.25,-3]),t=this,window.parent.addEventListener("keydown",function(e){return t.key_pressed(e)},!1),window.parent.addEventListener("keyup",function(e){return t.key_released(e)},!1)},mouse_dragged:function(e){return this.player.camera.pitch(.01*e.diffy),this.player.camera.yaw(.01*-e.diffx)},key_pressed:function(t){switch(t.keyCode){case KeyEvent.DOM_VK_UP:return e.forward=-1;case KeyEvent.DOM_VK_DOWN:return e.backward=1;case KeyEvent.DOM_VK_LEFT:return e.left=1;case KeyEvent.DOM_VK_RIGHT:return e.right=-1}},key_released:function(t){switch(t.keyCode){case KeyEvent.DOM_VK_UP:return e.forward=0;case KeyEvent.DOM_VK_DOWN:return e.backward=0;case KeyEvent.DOM_VK_LEFT:return e.left=0;case KeyEvent.DOM_VK_RIGHT:return e.right=0}},update:function(t){var n,r;r=1.5*t,this.teapot.camera.move((e.forward+e.backward)*r),n=Math.PI/90,e.left?this.teapot.camera.rotate(n,0,1,0):e.right&&this.teapot.camera.rotate(-n,0,1,0);if(e.forward||e.backward||e.left||e.right)return this.player.camera.lookAt(this.teapot.camera.getPosition(this.player.camera.getPosition))}})}.call(this),Jax.shader_data("skybox").common='// Shared variables save on graphics memory and allow you to "piggy-back" off of\n// variables defined in other shaders:\n\nshared uniform mat3 nMatrix;\nshared uniform mat4 mvMatrix, pMatrix;\n\nshared varying vec2 vTexCoords;\nshared varying vec3 vNormal;\nshared varying vec4 vBaseColor;\n\nvarying vec3 vPos;\n\n// If a variable isn\'t shared, it will be defined specifically for this shader.\n// If this shader is used twice in one materials, unshared variables will be\n// defined twice -- once for each use of the shader.\n\n//   uniform sampler2D Texture;\n//   uniform float TextureScaleX, TextureScaleY;\n',Jax.shader_data("functions").noise="/**\n * Classic and 'improved' (simplex) Perlin noise.\n *\n * This implementation attempts to use texture-based lookups if the client\n * hardware can support it. This is no problem in fragment shaders but can\n * be an issue in vertex shaders, where VTL is not supported by about 20%\n * of clients.\n *\n * In the event this is a vertex shader *and* the client doesn't support\n * VTL, the functions will fall back to 'ashima' noise\n * (https://github.com/ashima/webgl-noise) for a slower, non-texture-based\n * implementation.\n **/\n\n \n<%if (shader_type != 'vertex' || Jax.Shader.max_vertex_textures > 0) {%>\n\n\n/*\n * 2D, 3D and 4D Perlin noise, classic and simplex, in a GLSL fragment shader.\n *\n * Classic noise is implemented by the functions:\n * float cnoise(vec2 P)\n * float cnoise(vec3 P)\n * float cnoise(vec4 P)\n *\n * Simplex noise is implemented by the functions:\n * float snoise(vec2 P)\n * float snoise(vec3 P)\n * float snoise(vec4 P)\n *\n * Author: Stefan Gustavson ITN-LiTH (stegu@itn.liu.se) 2004-12-05\n * You may use, modify and redistribute this code free of charge,\n * provided that my name and this notice appears intact.\n */\n\n/*\n * NOTE: there is a formal problem with the dependent texture lookups.\n * A texture coordinate of exactly 1.0 will wrap to 0.0, so strictly speaking,\n * an error occurs every 256 units of the texture domain, and the same gradient\n * is used for two adjacent noise cells. One solution is to set the texture\n * wrap mode to \"CLAMP\" and do the wrapping explicitly in GLSL with the \"mod\"\n * operator. This could also give you noise with repetition intervals other\n * than 256 without any extra cost.\n * This error is not even noticeable to the eye even if you isolate the exact\n * position in the domain where it occurs and know exactly what to look for.\n * The noise pattern is still visually correct, so I left the bug in there.\n * \n * The value of classic 4D noise goes above 1.0 and below -1.0 at some\n * points. Not much and only very sparsely, but it happens.\n */\n\n\n/*\n * \"permTexture\" is a 256x256 texture that is used for both the permutations\n * and the 2D and 3D gradient lookup. For details, see the main C program.\n * \"simplexTexture\" is a small look-up table to determine a simplex traversal\n * order for 3D and 4D simplex noise. Details are in the C program.\n * \"gradTexture\" is a 256x256 texture with 4D gradients, similar to\n * \"permTexture\" but with the permutation index in the alpha component\n * replaced by the w component of the 4D gradient.\n * 2D classic noise uses only permTexture.\n * 2D simplex noise uses permTexture and simplexTexture.\n * 3D classic noise uses only permTexture.\n * 3D simplex noise uses permTexture and simplexTexture.\n * 4D classic noise uses permTexture and gradTexture.\n * 4D simplex noise uses all three textures.\n */\nuniform sampler2D permTexture;\n// sampler1D not supported in WebGL\n//uniform sampler1D simplexTexture;\nuniform sampler2D simplexTexture;\nuniform sampler2D gradTexture;\n\n/*\n * Both 2D and 3D texture coordinates are defined, for testing purposes.\n */\n//varying vec2 v_texCoord2D;\n//varying vec3 v_texCoord3D;\n//varying vec4 v_color;\n\n/*\n * To create offsets of one texel and one half texel in the\n * texture lookup, we need to know the texture image size.\n */\n#define ONE 0.00390625\n#define ONEHALF 0.001953125\n// The numbers above are 1/256 and 0.5/256, change accordingly\n// if you change the code to use another texture size.\n\n\n/*\n * The interpolation function. This could be a 1D texture lookup\n * to get some more speed, but it's not the main part of the algorithm.\n */\nfloat fade(float t) {\n  // return t*t*(3.0-2.0*t); // Old fade, yields discontinuous second derivative\n  return t*t*t*(t*(t*6.0-15.0)+10.0); // Improved fade, yields C2-continuous noise\n}\n\n\n/*\n * 2D classic Perlin noise. Fast, but less useful than 3D noise.\n */\nfloat cnoise(vec2 P)\n{\n  vec2 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled and offset for texture lookup\n  vec2 Pf = fract(P);             // Fractional part for interpolation\n\n  // Noise contribution from lower left corner\n  vec2 grad00 = texture2D(permTexture, Pi).rg * 4.0 - 1.0;\n  float n00 = dot(grad00, Pf);\n\n  // Noise contribution from lower right corner\n  vec2 grad10 = texture2D(permTexture, Pi + vec2(ONE, 0.0)).rg * 4.0 - 1.0;\n  float n10 = dot(grad10, Pf - vec2(1.0, 0.0));\n\n  // Noise contribution from upper left corner\n  vec2 grad01 = texture2D(permTexture, Pi + vec2(0.0, ONE)).rg * 4.0 - 1.0;\n  float n01 = dot(grad01, Pf - vec2(0.0, 1.0));\n\n  // Noise contribution from upper right corner\n  vec2 grad11 = texture2D(permTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 1.0;\n  float n11 = dot(grad11, Pf - vec2(1.0, 1.0));\n\n  // Blend contributions along x\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade(Pf.x));\n\n  // Blend contributions along y\n  float n_xy = mix(n_x.x, n_x.y, fade(Pf.y));\n\n  // We're done, return the final noise value.\n  return n_xy;\n}\n\n\n/*\n * 3D classic noise. Slower, but a lot more useful than 2D noise.\n */\nfloat cnoise(vec3 P)\n{\n  vec3 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                  // and offset 1/2 texel to sample texel centers\n  vec3 Pf = fract(P);     // Fractional part for interpolation\n\n  // Noise contributions from (x=0, y=0), z=0 and z=1\n  float perm00 = texture2D(permTexture, Pi.xy).a ;\n  vec3  grad000 = texture2D(permTexture, vec2(perm00, Pi.z)).rgb * 4.0 - 1.0;\n  float n000 = dot(grad000, Pf);\n  vec3  grad001 = texture2D(permTexture, vec2(perm00, Pi.z + ONE)).rgb * 4.0 - 1.0;\n  float n001 = dot(grad001, Pf - vec3(0.0, 0.0, 1.0));\n\n  // Noise contributions from (x=0, y=1), z=0 and z=1\n  float perm01 = texture2D(permTexture, Pi.xy + vec2(0.0, ONE)).a ;\n  vec3  grad010 = texture2D(permTexture, vec2(perm01, Pi.z)).rgb * 4.0 - 1.0;\n  float n010 = dot(grad010, Pf - vec3(0.0, 1.0, 0.0));\n  vec3  grad011 = texture2D(permTexture, vec2(perm01, Pi.z + ONE)).rgb * 4.0 - 1.0;\n  float n011 = dot(grad011, Pf - vec3(0.0, 1.0, 1.0));\n\n  // Noise contributions from (x=1, y=0), z=0 and z=1\n  float perm10 = texture2D(permTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n  vec3  grad100 = texture2D(permTexture, vec2(perm10, Pi.z)).rgb * 4.0 - 1.0;\n  float n100 = dot(grad100, Pf - vec3(1.0, 0.0, 0.0));\n  vec3  grad101 = texture2D(permTexture, vec2(perm10, Pi.z + ONE)).rgb * 4.0 - 1.0;\n  float n101 = dot(grad101, Pf - vec3(1.0, 0.0, 1.0));\n\n  // Noise contributions from (x=1, y=1), z=0 and z=1\n  float perm11 = texture2D(permTexture, Pi.xy + vec2(ONE, ONE)).a ;\n  vec3  grad110 = texture2D(permTexture, vec2(perm11, Pi.z)).rgb * 4.0 - 1.0;\n  float n110 = dot(grad110, Pf - vec3(1.0, 1.0, 0.0));\n  vec3  grad111 = texture2D(permTexture, vec2(perm11, Pi.z + ONE)).rgb * 4.0 - 1.0;\n  float n111 = dot(grad111, Pf - vec3(1.0, 1.0, 1.0));\n\n  // Blend contributions along x\n  vec4 n_x = mix(vec4(n000, n001, n010, n011),\n                 vec4(n100, n101, n110, n111), fade(Pf.x));\n\n  // Blend contributions along y\n  vec2 n_xy = mix(n_x.xy, n_x.zw, fade(Pf.y));\n\n  // Blend contributions along z\n  float n_xyz = mix(n_xy.x, n_xy.y, fade(Pf.z));\n\n  // We're done, return the final noise value.\n  return n_xyz;\n}\n\n\n/*\n * 4D classic noise. Slow, but very useful. 4D simplex noise is a lot faster.\n *\n * This function performs 8 texture lookups and 16 dependent texture lookups,\n * 16 dot products, 4 mix operations and a lot of additions and multiplications.\n * Needless to say, it's not super fast. But it's not dead slow either.\n */\nfloat cnoise(vec4 P)\n{\n  vec4 Pi = ONE*floor(P)+ONEHALF; // Integer part, scaled so +1 moves one texel\n                                  // and offset 1/2 texel to sample texel centers\n  vec4 Pf = fract(P);      // Fractional part for interpolation\n\n  // \"n0000\" is the noise contribution from (x=0, y=0, z=0, w=0), and so on\n  float perm00xy = texture2D(permTexture, Pi.xy).a ;\n  float perm00zw = texture2D(permTexture, Pi.zw).a ;\n  vec4 grad0000 = texture2D(gradTexture, vec2(perm00xy, perm00zw)).rgba * 4.0 -1.0;\n  float n0000 = dot(grad0000, Pf);\n\n  float perm01zw = texture2D(permTexture, Pi.zw  + vec2(0.0, ONE)).a ;\n  vec4  grad0001 = texture2D(gradTexture, vec2(perm00xy, perm01zw)).rgba * 4.0 - 1.0;\n  float n0001 = dot(grad0001, Pf - vec4(0.0, 0.0, 0.0, 1.0));\n\n  float perm10zw = texture2D(permTexture, Pi.zw  + vec2(ONE, 0.0)).a ;\n  vec4  grad0010 = texture2D(gradTexture, vec2(perm00xy, perm10zw)).rgba * 4.0 - 1.0;\n  float n0010 = dot(grad0010, Pf - vec4(0.0, 0.0, 1.0, 0.0));\n\n  float perm11zw = texture2D(permTexture, Pi.zw  + vec2(ONE, ONE)).a ;\n  vec4  grad0011 = texture2D(gradTexture, vec2(perm00xy, perm11zw)).rgba * 4.0 - 1.0;\n  float n0011 = dot(grad0011, Pf - vec4(0.0, 0.0, 1.0, 1.0));\n\n  float perm01xy = texture2D(permTexture, Pi.xy + vec2(0.0, ONE)).a ;\n  vec4  grad0100 = texture2D(gradTexture, vec2(perm01xy, perm00zw)).rgba * 4.0 - 1.0;\n  float n0100 = dot(grad0100, Pf - vec4(0.0, 1.0, 0.0, 0.0));\n\n  vec4  grad0101 = texture2D(gradTexture, vec2(perm01xy, perm01zw)).rgba * 4.0 - 1.0;\n  float n0101 = dot(grad0101, Pf - vec4(0.0, 1.0, 0.0, 1.0));\n\n  vec4  grad0110 = texture2D(gradTexture, vec2(perm01xy, perm10zw)).rgba * 4.0 - 1.0;\n  float n0110 = dot(grad0110, Pf - vec4(0.0, 1.0, 1.0, 0.0));\n\n  vec4  grad0111 = texture2D(gradTexture, vec2(perm01xy, perm11zw)).rgba * 4.0 - 1.0;\n  float n0111 = dot(grad0111, Pf - vec4(0.0, 1.0, 1.0, 1.0));\n\n  float perm10xy = texture2D(permTexture, Pi.xy + vec2(ONE, 0.0)).a ;\n  vec4  grad1000 = texture2D(gradTexture, vec2(perm10xy, perm00zw)).rgba * 4.0 - 1.0;\n  float n1000 = dot(grad1000, Pf - vec4(1.0, 0.0, 0.0, 0.0));\n\n  vec4  grad1001 = texture2D(gradTexture, vec2(perm10xy, perm01zw)).rgba * 4.0 - 1.0;\n  float n1001 = dot(grad1001, Pf - vec4(1.0, 0.0, 0.0, 1.0));\n\n  vec4  grad1010 = texture2D(gradTexture, vec2(perm10xy, perm10zw)).rgba * 4.0 - 1.0;\n  float n1010 = dot(grad1010, Pf - vec4(1.0, 0.0, 1.0, 0.0));\n\n  vec4  grad1011 = texture2D(gradTexture, vec2(perm10xy, perm11zw)).rgba * 4.0 - 1.0;\n  float n1011 = dot(grad1011, Pf - vec4(1.0, 0.0, 1.0, 1.0));\n\n  float perm11xy = texture2D(permTexture, Pi.xy + vec2(ONE, ONE)).a ;\n  vec4  grad1100 = texture2D(gradTexture, vec2(perm11xy, perm00zw)).rgba * 4.0 - 1.0;\n  float n1100 = dot(grad1100, Pf - vec4(1.0, 1.0, 0.0, 0.0));\n\n  vec4  grad1101 = texture2D(gradTexture, vec2(perm11xy, perm01zw)).rgba * 4.0 - 1.0;\n  float n1101 = dot(grad1101, Pf - vec4(1.0, 1.0, 0.0, 1.0));\n\n  vec4  grad1110 = texture2D(gradTexture, vec2(perm11xy, perm10zw)).rgba * 4.0 - 1.0;\n  float n1110 = dot(grad1110, Pf - vec4(1.0, 1.0, 1.0, 0.0));\n\n  vec4  grad1111 = texture2D(gradTexture, vec2(perm11xy, perm11zw)).rgba * 4.0 - 1.0;\n  float n1111 = dot(grad1111, Pf - vec4(1.0, 1.0, 1.0, 1.0));\n\n  // Blend contributions along x\n  float fadex = fade(Pf.x);\n  vec4 n_x0 = mix(vec4(n0000, n0001, n0010, n0011),\n                  vec4(n1000, n1001, n1010, n1011), fadex);\n  vec4 n_x1 = mix(vec4(n0100, n0101, n0110, n0111),\n                  vec4(n1100, n1101, n1110, n1111), fadex);\n\n  // Blend contributions along y\n  vec4 n_xy = mix(n_x0, n_x1, fade(Pf.y));\n\n  // Blend contributions along z\n  vec2 n_xyz = mix(n_xy.xy, n_xy.zw, fade(Pf.z));\n\n  // Blend contributions along w\n  float n_xyzw = mix(n_xyz.x, n_xyz.y, fade(Pf.w));\n\n  // We're done, return the final noise value.\n  return n_xyzw;\n}\n\n\n/*\n * 2D simplex noise. Somewhat slower but much better looking than classic noise.\n */\nfloat snoise(vec2 P) {\n\n// Skew and unskew factors are a bit hairy for 2D, so define them as constants\n// This is (sqrt(3.0)-1.0)/2.0\n#define F2 0.366025403784\n// This is (3.0-sqrt(3.0))/6.0\n#define G2 0.211324865405\n\n  // Skew the (x,y) space to determine which cell of 2 simplices we're in\n    float s = (P.x + P.y) * F2;   // Hairy factor for 2D skewing\n  vec2 Pi = floor(P + s);\n  float t = (Pi.x + Pi.y) * G2; // Hairy factor for unskewing\n  vec2 P0 = Pi - t; // Unskew the cell origin back to (x,y) space\n  Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n  vec2 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n  // For the 2D case, the simplex shape is an equilateral triangle.\n  // Find out whether we are above or below the x=y diagonal to\n  // determine which of the two triangles we're in.\n  vec2 o1;\n  if(Pf0.x > Pf0.y) o1 = vec2(1.0, 0.0);  // +x, +y traversal order\n  else o1 = vec2(0.0, 1.0);               // +y, +x traversal order\n\n  // Noise contribution from simplex origin\n  vec2 grad0 = texture2D(permTexture, Pi).rg * 4.0 - 1.0;\n  float t0 = 0.5 - dot(Pf0, Pf0);\n  float n0;\n  if (t0 < 0.0) n0 = 0.0;\n  else {\n    t0 *= t0;\n    n0 = t0 * t0 * dot(grad0, Pf0);\n  }\n\n  // Noise contribution from middle corner\n  vec2 Pf1 = Pf0 - o1 + G2;\n  vec2 grad1 = texture2D(permTexture, Pi + o1*ONE).rg * 4.0 - 1.0;\n  float t1 = 0.5 - dot(Pf1, Pf1);\n  float n1;\n  if (t1 < 0.0) n1 = 0.0;\n  else {\n    t1 *= t1;\n    n1 = t1 * t1 * dot(grad1, Pf1);\n  }\n  \n  // Noise contribution from last corner\n  vec2 Pf2 = Pf0 - vec2(1.0-2.0*G2);\n  vec2 grad2 = texture2D(permTexture, Pi + vec2(ONE, ONE)).rg * 4.0 - 1.0;\n  float t2 = 0.5 - dot(Pf2, Pf2);\n  float n2;\n  if(t2 < 0.0) n2 = 0.0;\n  else {\n    t2 *= t2;\n    n2 = t2 * t2 * dot(grad2, Pf2);\n  }\n\n  // Sum up and scale the result to cover the range [-1,1]\n  return 70.0 * (n0 + n1 + n2);\n}\n\n\n/*\n * 3D simplex noise. Comparable in speed to classic noise, better looking.\n */\nfloat snoise(vec3 P) {\n\n// The skewing and unskewing factors are much simpler for the 3D case\n#define F3 0.333333333333\n#define G3 0.166666666667\n\n  // Skew the (x,y,z) space to determine which cell of 6 simplices we're in\n  float s = (P.x + P.y + P.z) * F3; // Factor for 3D skewing\n  vec3 Pi = floor(P + s);\n  float t = (Pi.x + Pi.y + Pi.z) * G3;\n  vec3 P0 = Pi - t; // Unskew the cell origin back to (x,y,z) space\n  Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n  vec3 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n  // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n  // To find out which of the six possible tetrahedra we're in, we need to\n  // determine the magnitude ordering of x, y and z components of Pf0.\n  // The method below is explained briefly in the C code. It uses a small\n  // 1D texture as a lookup table. The table is designed to work for both\n  // 3D and 4D noise, so only 8 (only 6, actually) of the 64 indices are\n  // used here.\n  float c1 = (Pf0.x > Pf0.y) ? 0.5078125 : 0.0078125; // 1/2 + 1/128\n  float c2 = (Pf0.x > Pf0.z) ? 0.25 : 0.0;\n  float c3 = (Pf0.y > Pf0.z) ? 0.125 : 0.0;\n  float sindex = c1 + c2 + c3;\n  vec3 offsets = texture2D(simplexTexture, vec2(sindex, 0.0)).rgb;\n//  vec3 offsets = texture1D(simplexTexture, sindex).rgb;\n  vec3 o1 = step(0.375, offsets);\n  vec3 o2 = step(0.125, offsets);\n\n  // Noise contribution from simplex origin\n  float perm0 = texture2D(permTexture, Pi.xy).a;\n  vec3  grad0 = texture2D(permTexture, vec2(perm0, Pi.z)).rgb * 4.0 - 1.0;\n  float t0 = 0.6 - dot(Pf0, Pf0);\n  float n0;\n  if (t0 < 0.0) n0 = 0.0;\n  else {\n    t0 *= t0;\n    n0 = t0 * t0 * dot(grad0, Pf0);\n  }\n\n  // Noise contribution from second corner\n  vec3 Pf1 = Pf0 - o1 + G3;\n  float perm1 = texture2D(permTexture, Pi.xy + o1.xy*ONE).a;\n  vec3  grad1 = texture2D(permTexture, vec2(perm1, Pi.z + o1.z*ONE)).rgb * 4.0 - 1.0;\n  float t1 = 0.6 - dot(Pf1, Pf1);\n  float n1;\n  if (t1 < 0.0) n1 = 0.0;\n  else {\n    t1 *= t1;\n    n1 = t1 * t1 * dot(grad1, Pf1);\n  }\n  \n  // Noise contribution from third corner\n  vec3 Pf2 = Pf0 - o2 + 2.0 * G3;\n  float perm2 = texture2D(permTexture, Pi.xy + o2.xy*ONE).a;\n  vec3  grad2 = texture2D(permTexture, vec2(perm2, Pi.z + o2.z*ONE)).rgb * 4.0 - 1.0;\n  float t2 = 0.6 - dot(Pf2, Pf2);\n  float n2;\n  if (t2 < 0.0) n2 = 0.0;\n  else {\n    t2 *= t2;\n    n2 = t2 * t2 * dot(grad2, Pf2);\n  }\n  \n  // Noise contribution from last corner\n  vec3 Pf3 = Pf0 - vec3(1.0-3.0*G3);\n  float perm3 = texture2D(permTexture, Pi.xy + vec2(ONE, ONE)).a;\n  vec3  grad3 = texture2D(permTexture, vec2(perm3, Pi.z + ONE)).rgb * 4.0 - 1.0;\n  float t3 = 0.6 - dot(Pf3, Pf3);\n  float n3;\n  if(t3 < 0.0) n3 = 0.0;\n  else {\n    t3 *= t3;\n    n3 = t3 * t3 * dot(grad3, Pf3);\n  }\n\n  // Sum up and scale the result to cover the range [-1,1]\n  return 32.0 * (n0 + n1 + n2 + n3);\n}\n\n\n/*\n * 4D simplex noise. A lot faster than classic 4D noise, and better looking.\n */\n\nfloat snoise(vec4 P) {\n\n// The skewing and unskewing factors are hairy again for the 4D case\n// This is (sqrt(5.0)-1.0)/4.0\n#define F4 0.309016994375\n// This is (5.0-sqrt(5.0))/20.0\n#define G4 0.138196601125\n\n  // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n     float s = (P.x + P.y + P.z + P.w) * F4; // Factor for 4D skewing\n  vec4 Pi = floor(P + s);\n  float t = (Pi.x + Pi.y + Pi.z + Pi.w) * G4;\n  vec4 P0 = Pi - t; // Unskew the cell origin back to (x,y,z,w) space\n  Pi = Pi * ONE + ONEHALF; // Integer part, scaled and offset for texture lookup\n\n  vec4 Pf0 = P - P0;  // The x,y distances from the cell origin\n\n  // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n  // To find out which of the 24 possible simplices we're in, we need to\n  // determine the magnitude ordering of x, y, z and w components of Pf0.\n  // The method below is presented without explanation. It uses a small 1D\n  // texture as a lookup table. The table is designed to work for both\n  // 3D and 4D noise and contains 64 indices, of which only 24 are actually\n  // used. An extension to 5D would require a larger texture here.\n  float c1 = (Pf0.x > Pf0.y) ? 0.5078125 : 0.0078125; // 1/2 + 1/128\n  float c2 = (Pf0.x > Pf0.z) ? 0.25 : 0.0;\n  float c3 = (Pf0.y > Pf0.z) ? 0.125 : 0.0;\n  float c4 = (Pf0.x > Pf0.w) ? 0.0625 : 0.0;\n  float c5 = (Pf0.y > Pf0.w) ? 0.03125 : 0.0;\n  float c6 = (Pf0.z > Pf0.w) ? 0.015625 : 0.0;\n  float sindex = c1 + c2 + c3 + c4 + c5 + c6;\n  vec4 offsets = texture2D(simplexTexture, vec2(sindex, 0.0)).rgba;\n//  vec4 offsets = texture1D(simplexTexture, sindex).rgba;\n  vec4 o1 = step(0.625, offsets);\n  vec4 o2 = step(0.375, offsets);\n  vec4 o3 = step(0.125, offsets);\n\n  // Noise contribution from simplex origin\n  float perm0xy = texture2D(permTexture, Pi.xy).a;\n  float perm0zw = texture2D(permTexture, Pi.zw).a;\n  vec4  grad0 = texture2D(gradTexture, vec2(perm0xy, perm0zw)).rgba * 4.0 - 1.0;\n  float t0 = 0.6 - dot(Pf0, Pf0);\n  float n0;\n  if (t0 < 0.0) n0 = 0.0;\n  else {\n    t0 *= t0;\n    n0 = t0 * t0 * dot(grad0, Pf0);\n  }\n\n  // Noise contribution from second corner\n  vec4 Pf1 = Pf0 - o1 + G4;\n  o1 = o1 * ONE;\n  float perm1xy = texture2D(permTexture, Pi.xy + o1.xy).a;\n  float perm1zw = texture2D(permTexture, Pi.zw + o1.zw).a;\n  vec4  grad1 = texture2D(gradTexture, vec2(perm1xy, perm1zw)).rgba * 4.0 - 1.0;\n  float t1 = 0.6 - dot(Pf1, Pf1);\n  float n1;\n  if (t1 < 0.0) n1 = 0.0;\n  else {\n    t1 *= t1;\n    n1 = t1 * t1 * dot(grad1, Pf1);\n  }\n  \n  // Noise contribution from third corner\n  vec4 Pf2 = Pf0 - o2 + 2.0 * G4;\n  o2 = o2 * ONE;\n  float perm2xy = texture2D(permTexture, Pi.xy + o2.xy).a;\n  float perm2zw = texture2D(permTexture, Pi.zw + o2.zw).a;\n  vec4  grad2 = texture2D(gradTexture, vec2(perm2xy, perm2zw)).rgba * 4.0 - 1.0;\n  float t2 = 0.6 - dot(Pf2, Pf2);\n  float n2;\n  if (t2 < 0.0) n2 = 0.0;\n  else {\n    t2 *= t2;\n    n2 = t2 * t2 * dot(grad2, Pf2);\n  }\n  \n  // Noise contribution from fourth corner\n  vec4 Pf3 = Pf0 - o3 + 3.0 * G4;\n  o3 = o3 * ONE;\n  float perm3xy = texture2D(permTexture, Pi.xy + o3.xy).a;\n  float perm3zw = texture2D(permTexture, Pi.zw + o3.zw).a;\n  vec4  grad3 = texture2D(gradTexture, vec2(perm3xy, perm3zw)).rgba * 4.0 - 1.0;\n  float t3 = 0.6 - dot(Pf3, Pf3);\n  float n3;\n  if (t3 < 0.0) n3 = 0.0;\n  else {\n    t3 *= t3;\n    n3 = t3 * t3 * dot(grad3, Pf3);\n  }\n  \n  // Noise contribution from last corner\n  vec4 Pf4 = Pf0 - vec4(1.0-4.0*G4);\n  float perm4xy = texture2D(permTexture, Pi.xy + vec2(ONE, ONE)).a;\n  float perm4zw = texture2D(permTexture, Pi.zw + vec2(ONE, ONE)).a;\n  vec4  grad4 = texture2D(gradTexture, vec2(perm4xy, perm4zw)).rgba * 4.0 - 1.0;\n  float t4 = 0.6 - dot(Pf4, Pf4);\n  float n4;\n  if(t4 < 0.0) n4 = 0.0;\n  else {\n    t4 *= t4;\n    n4 = t4 * t4 * dot(grad4, Pf4);\n  }\n\n  // Sum up and scale the result to cover the range [-1,1]\n  return 27.0 * (n0 + n1 + n2 + n3 + n4);\n}\n\n<%\n} else {\n// non-texture-based implementation:\n// Ian McEwan, Ashima Arts.\n// Copyright (C) 2011 Ashima Arts. All rights reserved.\n// Distributed under the MIT License. See LICENSE file.\n%>\n\nvec4 permute(vec4 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nvec3 permute(vec3 x)\n{\n  return mod(((x*34.0)+1.0)*x, 289.0);\n}\n\nfloat permute(float x)\n{\n  return floor(mod(((x*34.0)+1.0)*x, 289.0));\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat taylorInvSqrt(float r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 grad4(float j, vec4 ip)\n{\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n  vec4 p,s;\n\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n  s = vec4(lessThan(p, vec4(0.0)));\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n  return p;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nvec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec2 P, vec2 rep)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod(Pi, rep.xyxy); // To create noise with explicit period\n  Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = 2.0 * fract(i / 41.0) - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 / 7.0;\n  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 / 7.0;\n  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod(Pi0, 289.0);\n  Pi1 = mod(Pi1, 289.0);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n// Classic Perlin noise, periodic version\nfloat cnoise(vec4 P, vec4 rep)\n{\n  vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n  vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 / 7.0;\n  vec4 gy00 = floor(gx00) / 7.0;\n  vec4 gz00 = floor(gy00) / 6.0;\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 / 7.0;\n  vec4 gy01 = floor(gx01) / 7.0;\n  vec4 gz01 = floor(gy01) / 6.0;\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 / 7.0;\n  vec4 gy10 = floor(gx10) / 7.0;\n  vec4 gz10 = floor(gy10) / 6.0;\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 / 7.0;\n  vec4 gy11 = floor(gx11) / 7.0;\n  vec4 gz11 = floor(gy11) / 6.0;\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626, // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i = floor(v + dot(v, C.yy) );\n  vec2 x0 = v - i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod(i, 289.0); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Inlined for speed: m *= taylorInvSqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x = a0.x * x0.x + h.x * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nfloat snoise(vec3 v)\n{\n  const vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i = floor(v + dot(v, C.yyy) );\n  vec3 x0 = v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxx;\n  // x1 = x0 - i1 + 1.0 * C.xxx;\n  // x2 = x0 - i2 + 2.0 * C.xxx;\n  // x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod(i, 289.0 );\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3 ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ ); // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\nfloat snoise(vec4 v)\n{\n  const vec4 C = vec4( 0.138196601125011, // (5 - sqrt(5))/20 G4\n                        0.276393202250021, // 2 * G4\n                        0.414589803375032, // 3 * G4\n                       -0.447213595499958); // -1 + 4 * G4\n\n  // (sqrt(5) - 1)/4 = F4, used once below\n  #define F4 0.309016994374947451\n\n// First corner\n  vec4 i = floor(v + dot(v, vec4(F4)) );\n  vec4 x0 = v - i + dot(i, C.xxxx);\n\n// Other corners\n\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\n  vec4 i0;\n  vec3 isX = step( x0.yzw, x0.xxx );\n  vec3 isYZ = step( x0.zww, x0.yyz );\n// i0.x = dot( isX, vec3( 1.0 ) );\n  i0.x = isX.x + isX.y + isX.z;\n  i0.yzw = 1.0 - isX;\n// i0.y += dot( isYZ.xy, vec2( 1.0 ) );\n  i0.y += isYZ.x + isYZ.y;\n  i0.zw += 1.0 - isYZ.xy;\n  i0.z += isYZ.z;\n  i0.w += 1.0 - isYZ.z;\n\n  // i0 now contains the unique values 0,1,2,3 in each channel\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\n\n  // x0 = x0 - 0.0 + 0.0 * C.xxxx\n  // x1 = x0 - i1 + 0.0 * C.xxxx\n  // x2 = x0 - i2 + 0.0 * C.xxxx\n  // x3 = x0 - i3 + 0.0 * C.xxxx\n  // x4 = x0 - 1.0 + 4.0 * C.xxxx\n  vec4 x1 = x0 - i1 + C.xxxx;\n  vec4 x2 = x0 - i2 + C.yyyy;\n  vec4 x3 = x0 - i3 + C.zzzz;\n  vec4 x4 = x0 + C.wwww;\n\n  // Permutations\n  i = mod(i, 289.0);\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\n  vec4 j1 = permute( permute( permute( permute (\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\n\n  // Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\n  // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n  vec4 p0 = grad4(j0, ip);\n  vec4 p1 = grad4(j1.x, ip);\n  vec4 p2 = grad4(j1.y, ip);\n  vec4 p3 = grad4(j1.z, ip);\n  vec4 p4 = grad4(j1.w, ip);\n\n  // Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n  p4 *= taylorInvSqrt(dot(p4,p4));\n\n  // Mix contributions from the five corners\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);\n  m0 = m0 * m0;\n  m1 = m1 * m1;\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\n\n}\n\n<% } %>\n"
,Jax.shader_data("skybox").fragment='<%= Jax.import_shader_code("functions", "noise") %>\n\nuniform float TIME;\n\nvec3 cloudColor = vec3(0.85,0.85,0.85);\n\nvoid main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  ambient = specular = vec4(0);\n  \n  // gradient the sky color based on Y position.\n  // We know the sky sphere has a radius 25, so Y is in range -2.5..2.5 (we divided by 10 in vshader).\n  vec3 minSkyColor = vec3(0.2235294117647059, 0.4, 0.7568627450980392),\n       maxSkyColor = vec3(0.5058823529411764, 0.6549019607843137, 0.8392156862745098);\n  \n  diffuse = vec4(mix(minSkyColor, maxSkyColor, abs(vPos.y)/2.5), 1.0);\n  \n  \n\n  float t = TIME * 0.025;\n  float cloudThickness = snoise(vec4(vPos, t)) +\n                         0.5 * snoise(vec4(vPos*2.0, t)) +\n                         0.25 * snoise(vec4(vPos*4.0, t)) +\n                         0.125 * snoise(vec4(vPos*8.0, t)) +\n                         0.0625 * snoise(vec4(vPos*16.0, t));\n  \n  cloudThickness = (cloudThickness+1.0)/2.0;\n\n  diffuse.rgb = mix(diffuse.rgb, cloudColor, cloudThickness);\n}\n',Jax.Material.Skybox=Jax.Class.create(Jax.Material,{initialize:function($super,e){e=Jax.Util.normalizeOptions(e,{shader:"skybox"}),$super(e)},setVariables:function(e,t,n,r){r.set("mvMatrix",e.getModelViewMatrix()),r.set("nMatrix",e.getNormalMatrix()),r.set("pMatrix",e.getProjectionMatrix()),r.set("TIME",Jax.uptime),Jax.noise.bind(e,r),r.set("VERTEX_POSITION",t.getVertexBuffer()),r.set("VERTEX_COLOR",t.getColorBuffer()),r.set("VERTEX_NORMAL",t.getNormalBuffer()),r.set("VERTEX_TEXCOORDS",t.getTextureCoordsBuffer())}}),Jax.shader_data("skybox").vertex="shared attribute vec4 VERTEX_POSITION, VERTEX_COLOR;\nshared attribute vec3 VERTEX_NORMAL;\nshared attribute vec2 VERTEX_TEXCOORDS;\n\nvoid main(void) {\n  vPos = VERTEX_POSITION.xyz / 10.0;\n  gl_Position = pMatrix * mvMatrix * VERTEX_POSITION;\n  \n  vTexCoords = VERTEX_TEXCOORDS;\n  \n//  vNormal = VERTEX_NORMAL;\n//  vColor = VERTEX_COLOR;\n}\n",Jax.shader_data("basic").common="shared uniform mat4 ivMatrix, mvMatrix, pMatrix, vMatrix;\nshared uniform mat3 vnMatrix, nMatrix;\n\nshared uniform vec4 materialDiffuse, materialAmbient, materialSpecular;\nshared uniform float materialShininess;\n\nshared uniform int PASS_TYPE;\n\nshared varying vec2 vTexCoords;\nshared varying vec3 vNormal, vSurfacePos;\nshared varying vec4 vBaseColor;\n",Jax.shader_data("basic").fragment="void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  ambient = materialAmbient * vBaseColor;\n  diffuse = materialDiffuse * vBaseColor;\n  specular = materialSpecular * vBaseColor;\n}\n",Jax.shader_data("basic").vertex="shared attribute vec2 VERTEX_TEXCOORDS;\nshared attribute vec3 VERTEX_NORMAL;\nshared attribute vec4 VERTEX_POSITION, VERTEX_COLOR, VERTEX_TANGENT;\n\nvoid main(void) {\n  vBaseColor = VERTEX_COLOR;\n  vNormal = nMatrix * VERTEX_NORMAL;\n  vTexCoords = VERTEX_TEXCOORDS;\n\n  vSurfacePos = (mvMatrix * VERTEX_POSITION).xyz;\n\n  gl_Position = pMatrix * mvMatrix * VERTEX_POSITION;\n}\n",Jax.shader_data("depthmap").common="shared uniform mat4 pMatrix;\n",Jax.shader_data("functions").depth_map="vec4 pack_depth(const in float depth)\n{\n  const vec4 bit_shift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n  const vec4 bit_mask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n  vec4 res = fract(depth * bit_shift);\n  res -= res.xxyz * bit_mask;\n  return res;\n}\n\n/*\nfloat linearize(in float z) {\n  float A = pMatrix[2].z, B = pMatrix[3].z;\n  float n = - B / (1.0 - A); // camera z near\n  float f =   B / (1.0 + A); // camera z far\n  return (2.0 * n) / (f + n - z * (f - n));\n}\n*/\n\nfloat unpack_depth(const in vec4 rgba_depth)\n{\n  const vec4 bit_shift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n  float depth = dot(rgba_depth, bit_shift);\n  return depth;\n}\n",Jax.shader_data("depthmap").fragment='<%= Jax.import_shader_code("functions", "depth_map") %>\n\nvoid main(void) {\n  vec4 pos = gl_FragCoord;\n  import(exPos, pos = exPos);\n  gl_FragColor = pack_depth(pos.z);\n}\n',Jax.Material.Depthmap=Jax.Class.create(Jax.Material,{initialize:function($super){$super({shader:"depthmap"})}}),Jax.shader_data("depthmap").vertex="shared attribute vec4 VERTEX_POSITION;\n    \nshared uniform mat4 mvMatrix;\n            \nvoid main(void) {\n  vec4 pos = pMatrix * mvMatrix * VERTEX_POSITION;\n  import(Position, pos = Position);\n  \n  gl_Position = pos;\n}\n",Jax.shader_data("fog").common="uniform vec4 FogColor;\n\nuniform int Algorithm;\n\nuniform float Scale;\nuniform float End;\nuniform float Density;\n",Jax.shader_data("fog").fragment="const float LOG2 = 1.442695;\n\nvoid main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  float fog;\n  float error = 0.0;\n  float distance = length(gl_FragCoord.z / gl_FragCoord.w);\n\n  if (Algorithm == <%=Jax.LINEAR%>) {\n    fog = (End - distance) * Scale;\n  } else if (Algorithm == <%=Jax.EXPONENTIAL%>) {\n    fog = exp(-Density * distance);\n  } else if (Algorithm == <%=Jax.EXP2%>) {\n    fog = exp2(-Density * Density * distance * distance * LOG2);\n  } else {\n    /* error condition, output red */\n    ambient = diffuse = specular = vec4(1,0,0,1);\n    error = 1.0;\n  }\n\n  if (error != 1.0) {\n    fog = clamp(fog, 0.0, 1.0);\n  \n    ambient  = mix(FogColor,  ambient,  fog);\n    diffuse  = mix(FogColor,  diffuse,  fog);\n  }\n}\n",Jax.LINEAR=1,Jax.EXPONENTIAL=2,Jax.EXP2=3,Jax.Material.Fog=Jax.Class.create(Jax.Material,{initialize:function($super,e){e=Jax.Util.normalizeOptions(e,{shader:"fog",algorithm:Jax.EXP2,start:10,end:100,density:.0015,color:[1,1,1,1]}),e.color=Jax.Util.colorize(e.color),e.color=[e.color[0],e.color[1],e.color[2],e.color[3]];if(typeof e.algorithm=="string"){var t=e.algorithm;e.algorithm=Jax[t];if(!e.algorithm)throw new Error("Jax: Fog algorithm must be one of LINEAR, EXPONENTIAL, or EXP2")}$super(e)},setVariables:function(e,t,n,r){r.set("End",this.end),r.set("Scale",1/(this.end-this.start)),r.set("Algorithm",this.algorithm),r.set("Density",this.density),r.set("FogColor",this.color)}}),Jax.shader_data("fog").vertex="shared attribute vec4 VERTEX_POSITION;\n\nshared uniform mat4 mvMatrix, pMatrix;\n\nconst float LOG2 = 1.442695;\n\nvoid main(void) {\n  vec4 pos = mvMatrix * VERTEX_POSITION;\n  gl_Position = pMatrix * pos;\n}\n",Jax.shader_data("functions").lights="/* see http://jax.thoughtsincomputation.com/2011/05/webgl-apps-crashing-on-windows-7/ */\n//const struct LightSource {\n//  int enabled;\n//  int type;\n//  vec3 position; // in world space\n//  vec3 direction; // in world space\n//  vec4 ambient, diffuse, specular;\n//  float constant_attenuation, linear_attenuation, quadratic_attenuation;\n//  float spotExponent, spotCosCutoff;\n//};\n\nshared uniform bool LIGHT_ENABLED;\nshared uniform int LIGHT_TYPE;\nshared uniform vec3 LIGHT_POSITION, LIGHT_DIRECTION;\nshared uniform vec4 LIGHT_AMBIENT, LIGHT_DIFFUSE, LIGHT_SPECULAR;\nshared uniform float LIGHT_ATTENUATION_CONSTANT, LIGHT_ATTENUATION_LINEAR, LIGHT_ATTENUATION_QUADRATIC,\n                     LIGHT_SPOT_EXPONENT, LIGHT_SPOT_COS_CUTOFF;\n\nfloat calcAttenuation(in vec3 ecPosition3,\n                      out vec3 lightDirection)\n{\n//  lightDirection = vec3(vnMatrix * -light.position) - ecPosition3;\n  lightDirection = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  float d = length(lightDirection);\n  \n  return 1.0 / (LIGHT_ATTENUATION_CONSTANT + LIGHT_ATTENUATION_LINEAR * d + LIGHT_ATTENUATION_QUADRATIC * d * d);\n}\n\nvoid DirectionalLight(in vec3 normal,\n                      inout vec4 ambient,\n                      inout vec4 diffuse,\n                      inout vec4 specular)\n{\n  vec3 nLDir = normalize(vnMatrix * -normalize(LIGHT_DIRECTION));\n  vec3 halfVector = normalize(nLDir + vec3(0,0,1));\n  float pf;\n    \n  float NdotD  = max(0.0, dot(normal, nLDir));\n  float NdotHV = max(0.0, dot(normal, halfVector));\n    \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n    \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\n/* Use when attenuation != (1,0,0) */\nvoid PointLightWithAttenuation(in vec3 ecPosition3,\n                               in vec3 normal,\n                               inout vec4 ambient,\n                               inout vec4 diffuse,\n                               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n\n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n\n/* Use for better performance when attenuation == (1,0,0) */\nvoid PointLightWithoutAttenuation(in vec3 ecPosition3,\n                                  in vec3 normal,\n                                  inout vec4 ambient,\n                                  inout vec4 diffuse,\n                                  inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float d;     // distance from surface to light source\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  \n  VP = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition3;\n  d = length(VP);\n  VP = normalize(VP);\n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT;\n  diffuse += LIGHT_DIFFUSE * NdotD;\n  specular += LIGHT_SPECULAR * pf;\n}\n\nvoid SpotLight(in vec3 ecPosition3,\n               in vec3 normal,\n               inout vec4 ambient,\n               inout vec4 diffuse,\n               inout vec4 specular)\n{\n  float NdotD; // normal . light direction\n  float NdotHV;// normal . half vector\n  float pf;    // specular factor\n  float attenuation;\n  vec3 VP;     // direction from surface to light position\n  vec3 halfVector; // direction of maximum highlights\n  float spotDot; // cosine of angle between spotlight\n  float spotAttenuation; // spotlight attenuation factor\n  \n  attenuation = calcAttenuation(ecPosition3, VP);\n  VP = normalize(VP);\n  \n  // See if point on surface is inside cone of illumination\n  spotDot = dot(-VP, normalize(vnMatrix*LIGHT_DIRECTION));\n  if (spotDot < LIGHT_SPOT_COS_CUTOFF)\n    spotAttenuation = 0.0;\n  else spotAttenuation = pow(spotDot, LIGHT_SPOT_EXPONENT);\n  \n  attenuation *= spotAttenuation;\n  \n  halfVector = normalize(VP+vec3(0,0,1));\n  NdotD = max(0.0, dot(normal, VP));\n  NdotHV= max(0.0, dot(normal, halfVector));\n  \n  if (NdotD == 0.0) pf = 0.0;\n  else pf = pow(NdotHV, materialShininess);\n  \n  ambient += LIGHT_AMBIENT * attenuation;\n  diffuse += LIGHT_DIFFUSE * NdotD * attenuation;\n  specular += LIGHT_SPECULAR * pf * attenuation;\n}\n",Jax.shader_data("lighting").common='<%= Jax.import_shader_code("functions", "lights") %>\n\nshared uniform bool LIGHTING_ENABLED;\n\nshared varying vec3 vLightDir;\n',Jax.shader_data("lighting").fragment="void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  vec4 _ambient = vec4(0,0,0,0), _diffuse = vec4(0,0,0,0), _specular = vec4(0,0,0,0);\n  vec3 nNormal = normalize(vNormal);\n\n  if (LIGHTING_ENABLED) {\n    if (LIGHT_TYPE == <%=Jax.DIRECTIONAL_LIGHT%>)\n      DirectionalLight(nNormal, _ambient, _diffuse, _specular);\n    else\n      if (LIGHT_TYPE == <%=Jax.POINT_LIGHT%>)\n        if (LIGHT_ATTENUATION_CONSTANT == 1.0 && LIGHT_ATTENUATION_LINEAR == 0.0 && LIGHT_ATTENUATION_QUADRATIC == 0.0)\n          PointLightWithoutAttenuation(vSurfacePos, nNormal, _ambient, _diffuse, _specular);\n        else\n          PointLightWithAttenuation(vSurfacePos, nNormal, _ambient, _diffuse, _specular);\n      else\n        if (LIGHT_TYPE == <%=Jax.SPOT_LIGHT%>)\n          SpotLight(vSurfacePos, nNormal, _ambient, _diffuse, _specular);\n        else\n        { // error condition, output 100% red\n          _ambient = _diffuse = _specular = vec4(1,0,0,1);\n        }\n  } else {\n    _ambient = vec4(1,1,1,1);\n    _diffuse = _specular = vec4(0,0,0,0);\n  }\n\n  /*\n    Light colors will be multiplied by material colors. Light can't really be transparent,\n    so we'll use alpha to represent intensity. This means we must multiply resultant light\n    colors by light alpha, and then hard-code alpha 1 to avoid polluting transparency.\n    \n    The reason we use LIGHT_*.a instead of _*.a is because _*.a has been tainted by attenuation.\n    A light's intensity, regardless of distance or relative brightness, has not actually changed;\n    attenuation has been factored into color already; we don't want to square the atten amt.\n  */\n  ambient *= vec4(_ambient.rgb * LIGHT_AMBIENT.a, 1.0);\n  diffuse *= vec4(_diffuse.rgb * LIGHT_DIFFUSE.a, 1.0);\n  specular *= vec4(_specular.rgb * LIGHT_SPECULAR.a, 1.0);\n}\n",Jax.Material.Lighting=Jax.Class.create(Jax.Material,{initialize:function($super,e){$super(Jax.Util.normalizeOptions(e,{shader:"lighting"}))},setVariables:function(e,t,n,r){var i=e.world.lighting.getLight();r.set({LIGHTING_ENABLED:e.world.lighting.isEnabled()&&!n.unlit,LIGHT_POSITION:i.getPosition(),LIGHT_DIRECTION:i.getDirection(),LIGHT_AMBIENT:i.getAmbientColor(),LIGHT_DIFFUSE:i.getDiffuseColor(),LIGHT_SPECULAR:i.getSpecularColor(),LIGHT_ATTENUATION_CONSTANT:i.getConstantAttenuation(),LIGHT_ATTENUATION_LINEAR:i.getLinearAttenuation(),LIGHT_ATTENUATION_QUADRATIC:i.getQuadraticAttenuation(),LIGHT_SPOT_EXPONENT:i.getSpotExponent(),LIGHT_SPOT_COS_CUTOFF:i.getSpotCosCutoff(),LIGHT_ENABLED:i.isEnabled(),LIGHT_TYPE:i.getType()})}}),Jax.shader_data("lighting").vertex="shared attribute vec2 VERTEX_TEXCOORDS;\nshared attribute vec3 VERTEX_NORMAL;\nshared attribute vec4 VERTEX_POSITION, VERTEX_COLOR, VERTEX_TANGENT;\n\nvoid main(void) {\n  vLightDir = normalize(vnMatrix * -normalize(LIGHT_DIRECTION));\n}\n",Jax.shader_data("normal_map").common='<%= Jax.import_shader_code("functions", "lights") %>\n\nuniform sampler2D NormalMap;\n\nshared uniform mat4 mvMatrix, pMatrix, vMatrix;\nshared uniform mat3 nMatrix;\n\nshared varying vec2 vTexCoords;\n\nvarying vec3 vEyeDir;\nvarying vec3 vLightDir;\nvarying float vAttenuation;\n',Jax.shader_data("normal_map").fragment="void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  // ambient was applied by the basic shader; applying it again will simply brighten some fragments\n  // beyond their proper ambient value. So, we really need to apply the bump shader ONLY to diffuse+specular.\n\n  if (PASS_TYPE != <%=Jax.Scene.AMBIENT_PASS%>) {\n    vec3 nLightDir = normalize(vLightDir);\n    vec3 nEyeDir = normalize(vEyeDir);\n    vec4 color = texture2D(NormalMap, vTexCoords);\n    vec3 map = //nMatrix * \n               normalize(color.xyz * 2.0 - 1.0);\n             \n    float litColor = max(dot(map, nLightDir), 0.0) * vAttenuation;\n\n    // specular\n    vec3 reflectDir = reflect(nLightDir, map);\n    float spec = max(dot(nEyeDir, reflectDir), 0.0);\n    spec = pow(spec, materialShininess);\n\n    // Treat alpha in the normal map as a specular map; if it's unused it will be 1 and this\n    // won't matter.\n    spec *= color.a;\n  \n    diffuse *= litColor;\n    specular *= spec;\n  }\n}\n",Jax.Material.NormalMap=Jax.Class.create(Jax.Material,{initialize:function($super,e){this.map=Jax.Material.Texture.normalizeTexture(e),$super({shader:"normal_map"})},setVariables:function(e,t,n,r){r.texture("NormalMap",this.map,e),r.set("VERTEX_TANGENT",t.getTangentBuffer())}}),Jax.shader_data("normal_map").vertex="shared attribute vec4 VERTEX_POSITION;\nshared attribute vec2 VERTEX_TEXCOORDS;\nshared attribute vec4 VERTEX_TANGENT;\nshared attribute vec3 VERTEX_NORMAL;\n\nvoid main(void) {\n  // ambient was applied by the basic shader; applying it again will simply brighten some fragments\n  // beyond their proper ambient value. So, we really need to apply the bump shader ONLY to diffuse+specular.\n\n  if (PASS_TYPE != <%=Jax.Scene.AMBIENT_PASS%>) {\n    vec3 ecPosition = vec3(mvMatrix * VERTEX_POSITION);\n\n    gl_Position = pMatrix * mvMatrix * VERTEX_POSITION;\n    vTexCoords = VERTEX_TEXCOORDS;\n\n    vEyeDir = vec3(mvMatrix * VERTEX_POSITION);\n  \n    vec3 n = normalize(nMatrix * VERTEX_NORMAL);\n    vec3 t = normalize(nMatrix * VERTEX_TANGENT.xyz);\n    vec3 b = cross(n, t) * VERTEX_TANGENT.w;\n  \n    vec3 v, p;\n  \n    vAttenuation = 1.0;\n  \n    if (LIGHT_TYPE == <%=Jax.POINT_LIGHT%>)\n      if (LIGHT_ATTENUATION_CONSTANT == 1.0 && LIGHT_ATTENUATION_LINEAR == 0.0 && LIGHT_ATTENUATION_QUADRATIC == 0.0) {\n        // no change to attenuation, but we still need P\n        p = vec3(ivMatrix * vec4(LIGHT_POSITION, 1.0)) - ecPosition;\n      }\n      else {\n        // attenuation calculation figures out P for us, so we may as well use it\n        vAttenuation = calcAttenuation(ecPosition, p);\n      }\n    else\n      if (LIGHT_TYPE == <%=Jax.SPOT_LIGHT%>) {\n        // attenuation calculation figures out P for us, so we may as well use it\n        vAttenuation = calcAttenuation(ecPosition, p);\n      }\n      else\n      { // directional light -- all we need is P\n        p = vec3(vnMatrix * -normalize(LIGHT_DIRECTION));\n      }\n    \n    \n    \n    v.x = dot(p, t);\n    v.y = dot(p, b);\n    v.z = dot(p, n);\n    vLightDir = normalize(p);\n  \n    v.x = dot(vEyeDir, t);\n    v.y = dot(vEyeDir, b);\n    v.z = dot(vEyeDir, n);\n    vEyeDir = normalize(v);\n  }\n}\n",Jax.shader_data("paraboloid").common="shared uniform mat4 mvMatrix;\nshared uniform float DP_SHADOW_NEAR, DP_SHADOW_FAR;\nshared uniform float DP_DIRECTION;\n\nvarying float vClip;\nvarying vec4 vPos;\n",Jax.shader_data("paraboloid").exports=Jax.shader_data("paraboloid").exports||{},Jax.shader_data("paraboloid").exports.exPos="vec4",Jax.shader_data("paraboloid").fragment="void main(void) {\n  /* because we do our own projection, we also have to do our own clipping */\n  /* if vClip is less than 0, it's behind the near plane and can be dropped. */\n  if (vClip < 0.0) discard;\n  \n  export(vec4, exPos, vPos);\n//  gl_FragColor = pack_depth(vPos.z);\n}\n",Jax.Material.Paraboloid=Jax.Class.create(Jax.Material,{initialize:function($super,e){$super(Jax.Util.normalizeOptions(e,{shader:"paraboloid"}))},setVariables:function(e,t,n,r){r.set({DP_SHADOW_NEAR:.1,DP_SHADOW_FAR:500,DP_DIRECTION:n&&n.direction||1})}}),Jax.shader_data("paraboloid").exports=Jax.shader_data("paraboloid").exports||{},Jax.shader_data("paraboloid").exports.Position="vec4",Jax.shader_data("paraboloid").vertex="shared attribute vec4 VERTEX_POSITION;\n                \nvoid main(void) {\n  /*\n    we do our own projection to form the paraboloid, so we\n    can ignore the projection matrix entirely.\n   */\n  vec4 pos = mvMatrix * VERTEX_POSITION;\n\n  pos = vec4(pos.xyz / pos.w, pos.w);\n\n  pos.z *= DP_DIRECTION;\n\n  float L = length(pos.xyz);\n  pos /= L;\n  vClip = pos.z;\n\n  pos.z += 1.0;\n  pos.x /= pos.z;\n  pos.y /= pos.z;\n  pos.z = (L - DP_SHADOW_NEAR) / (DP_SHADOW_FAR - DP_SHADOW_NEAR);\n  pos.w = 1.0;\n\n  vPos = pos;\n  export(vec4, Position, pos);\n  gl_Position = pos;\n}\n",Jax.shader_data("picking").common="uniform float INDEX;\nvarying vec4 vColor;\n",Jax.shader_data("picking").fragment="void main(void) {\n  if (INDEX == -1.0) discard;\n  gl_FragColor = vColor;\n}\n",Jax.Material.Picking=Jax.Class.create(Jax.Material,{initialize:function($super){$super({shader:"picking"})},setVariables:function(e,t,n,r){model_index=n.model_index,model_index==undefined&&(model_index=-1),r.set("INDEX",model_index)}}),Jax.shader_data("picking").vertex="shared attribute vec4 VERTEX_POSITION;\n\nshared uniform mat4 mvMatrix, pMatrix;\n\nvoid main(void) {\n  gl_Position = pMatrix * mvMatrix * VERTEX_POSITION;\n  \n  /*\n    Note that the agorithm here must be followed exactly on the JS side in order\n    to reconstitute the index when it is read.\n    \n    This supports 65,535 objects. If more are needed, we could feasibly open up\n    the alpha channel, as long as blending is disabled. Need to do more tests\n    on this first, however.\n  */\n  \n  \n  // equivalent to [ int(INDEX/256), INDEX % 256 ] / 255. The last division\n  // is necessary to scale to the [0..1] range.\n  \n  float d = 1.0 / 255.0;\n  float f = floor(INDEX / 256.0);\n  vColor = vec4(f * d, (INDEX - 256.0 * f) * d, 1.0, 1.0);\n}\n",Jax.shader_data("shadow_map").common='<%= Jax.import_shader_code("functions", "lights") %>\n\nshared uniform mat4 mMatrix;\n\nuniform bool SHADOWMAP_ENABLED;\nuniform sampler2D SHADOWMAP0, SHADOWMAP1;\nuniform mat4 SHADOWMAP_MATRIX;\nuniform bool SHADOWMAP_PCF_ENABLED;\nuniform float DP_SHADOW_NEAR, DP_SHADOW_FAR;\n\nvarying vec4 vShadowCoord;\n\nvarying vec4 vDP0, vDP1;\n//varying float vDPz, vDPDepth;\n\n',Jax.shader_data("shadow_map").fragment='<%= Jax.import_shader_code("functions", "depth_map") %>\n\nfloat dp_lookup() {\n  float map_depth, depth;\n  vec4 rgba_depth;\n      \n  if (vDP0.w > 0.0) {\n    rgba_depth = texture2D(SHADOWMAP0, vDP0.xy);\n    depth = vDP1.w;//P0.z;\n  } else {\n    rgba_depth = texture2D(SHADOWMAP1, vDP1.xy);\n    depth = vDP1.w;//P1.z;\n  }\n      \n      \n  map_depth = unpack_depth(rgba_depth);\n      \n  if (map_depth + 0.00005 < depth) return 0.0;\n  else return 1.0;\n}\n      \nfloat pcf_lookup(float s, vec2 offset) {\n  /*\n    s is the projected depth of the current vShadowCoord relative to the shadow\'s camera. This represents\n    a *potentially* shadowed surface about to be drawn.\n    \n    d is the actual depth stored within the SHADOWMAP texture (representing the visible surface).\n  \n    if the surface to be drawn is further back than the light-visible surface, then the surface is\n    shadowed because it has a greater depth. Less-or-equal depth means it\'s either in front of, or it *is*\n    the light-visible surface.\n  */\n  vec2 texcoord = (vShadowCoord.xy/vShadowCoord.w)+offset;\n  vec4 rgba_depth = texture2D(SHADOWMAP0, texcoord);\n  float d = unpack_depth(rgba_depth);\n  return (s - d > 0.00002) ? 0.0 : 1.0;\n}\n\nvoid main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n//ambient = vec4(0);\n  if (PASS_TYPE != <%=Jax.Scene.AMBIENT_PASS%> && SHADOWMAP_ENABLED) {\n    float visibility = 1.0;\n    float s = vShadowCoord.z / vShadowCoord.w;\n    if (LIGHT_TYPE == <%=Jax.POINT_LIGHT%>) {\n      visibility = dp_lookup();\n    } else {\n      vec2 offset = vec2(0.0, 0.0);\n      if (!SHADOWMAP_PCF_ENABLED)\n        visibility = pcf_lookup(s, offset);\n      else {\n        // do PCF filtering\n        float dx, dy;\n        visibility = 0.0;\n        for (float dx = -1.5; dx <= 1.5; dx += 1.0)\n          for (float dy = -1.5; dy <= 1.5; dy += 1.0) {\n            offset.x = dx/2048.0;\n            offset.y = dy/2048.0;\n            visibility += pcf_lookup(s, offset);\n          }\n        visibility /= 16.0;\n      }\n    }\n\n    diffuse *= visibility;\n    specular *= visibility;\n  }\n}\n',Jax.Material.ShadowMap=Jax.Class.create(Jax.Material,{initialize:function($super){$super({shader:"shadow_map"})},setVariables:function(e,t,n,r){var i=e.world.lighting.getLight(),s=i.isShadowMapEnabled();r.set({DP_SHADOW_NEAR:.1,DP_SHADOW_FAR:500,SHADOWMAP_PCF_ENABLED:!1,SHADOWMAP_ENABLED:s});if(s){r.set({SHADOWMAP_MATRIX:i.getShadowMatrix()});var o,u;o=i.getShadowMapTextures(e)[0],u=i.getShadowMapTextures(e)[1],o&&r.texture("SHADOWMAP0",o,e),u&&r.texture("SHADOWMAP1",u,e)}}}),Jax.shader_data("shadow_map").vertex="void main(void) {\n  if (PASS_TYPE != <%=Jax.Scene.AMBIENT_PASS%> && SHADOWMAP_ENABLED) {\n    vShadowCoord = SHADOWMAP_MATRIX * mMatrix * VERTEX_POSITION;\n    \n    /* Perform dual-paraboloid shadow map calculations - for point lights only */\n    vec4 p = vShadowCoord;\n    vec3 pos = p.xyz / p.w;\n          \n    float L = length(pos.xyz);\n    vDP0.xyz = pos / L;\n    vDP1.xyz = pos / L;\n      \n    vDP0.w = pos.z;    \n    //vDPz = pos.z;\n          \n    vDP0.z = 1.0 + vDP0.z;\n    vDP0.x /= vDP0.z;\n    vDP0.y /= vDP0.z;\n    vDP0.z = (L - DP_SHADOW_NEAR) / (DP_SHADOW_FAR - DP_SHADOW_NEAR);\n          \n    vDP0.x =  0.5 * vDP0.x + 0.5;\n    vDP0.y =  0.5 * vDP0.y + 0.5;\n          \n    vDP1.z = 1.0 - vDP1.z;\n    vDP1.x /= vDP1.z;\n    vDP1.y /= vDP1.z;\n    vDP1.z = (L - DP_SHADOW_NEAR) / (DP_SHADOW_FAR - DP_SHADOW_NEAR);\n      \n    vDP1.x =  0.5 * vDP1.x + 0.5;\n    vDP1.y =  0.5 * vDP1.y + 0.5;\n          \n    float map_depth, depth;\n    vec4 rgba_depth;\n      \n    if (vDP0.w > 0.0) {    \n    //if (vDPz > 0.0) {\n      vDP1.w = vDP0.z;\n      //vDPDepth = vDP0.z;\n    } else {\n      vDP1.w = vDP1.z;\n      //vDPDepth = vDP1.z;\n    }\n  }\n}\n",Jax.shader_data("texture").common="uniform sampler2D Texture;\nuniform float TextureScaleX, TextureScaleY;\n\nshared varying vec2 vTexCoords;\n",Jax.shader_data("texture").fragment="void main(inout vec4 ambient, inout vec4 diffuse, inout vec4 specular) {\n  vec4 t = texture2D(Texture, vTexCoords * vec2(TextureScaleX, TextureScaleY));\n\n  ambient  *= t;\n  diffuse  *= t;\n  specular *= t;\n \n  ambient.a  *= t.a;\n  diffuse.a  *= t.a;\n  specular.a *= t.a;\n}\n",Jax.Material.Texture=Jax.Class.create(Jax.Material,{initialize:function($super,e){this.texture=Jax.Material.Texture.normalizeTexture(e),$super({shader:"texture"})},setVariables:function(e,t,n,r){r.texture("Texture",this.texture,e),r.set("TextureScaleX",this.texture.options.scale_x||this.texture.options.scale||1),r.set("TextureScaleY",this.texture.options.scale_y||this.texture.options.scale||1)}}),Jax.Material.Texture.normalizeTexture=function(e){return e.isKindOf&&e.isKindOf(Jax.Texture)?e:new Jax.Texture(e)},Jax.shader_data("texture").vertex="shared attribute vec4 VERTEX_POSITION;\nshared attribute vec2 VERTEX_TEXCOORDS;\n\nshared uniform mat4 mvMatrix, pMatrix;\n\nvoid main(void) {\n  gl_Position = pMatrix * mvMatrix * VERTEX_POSITION;\n  vTexCoords = VERTEX_TEXCOORDS;\n}\n",LightSource.addResources({sun:{shadowcaster:!0,enabled:!0,direction:{x:1,y:1,z:1.5},type:"DIRECTIONAL_LIGHT",attenuation:{constant:0,linear:1,quadratic:0},color:{ambient:{red:.2,green:.2,blue:.2,alpha:1},diffuse:{red:.5,green:.5,blue:.5,alpha:1},specular:{red:.2,green:.2,blue:.2,alpha:1}}}}),Material.addResources({skybox:{ambient:{red:1,green:.2,blue:.2,alpha:1},diffuse:{red:1,green:1,blue:1,alpha:1},specular:{red:1,green:1,blue:1,alpha:1},shininess:30,layers:[{type:"Skybox"}]}}),Material.addResources({teapot:{ambient:{red:.2,green:.2,blue:.2,alpha:1},diffuse:{red:1,green:1,blue:1,alpha:1},specular:{red:1,green:1,blue:1,alpha:1},shininess:30,layers:[{type:"Lighting"}]}}),Material.addResources({basic:{}}),Material.addResources({"default":{layers:[{type:"Lighting"}]}}),Material.addResources({depthmap:{type:"Depthmap"}}),Material.addResources({"paraboloid-depthmap":{type:"Paraboloid",layers:[{type:"Depthmap"}]}}),Material.addResources({picking:{type:"Picking"}});for(var shaderName in Jax._shader_data)if(!(Jax.shaders[shaderName]instanceof Jax.Shader)){var descriptor=Jax._shader_data[shaderName];Jax.shaders[shaderName]=new Jax.Shader(descriptor)};


var maintainCanvasAspectRatio = function() {

    window.context.canvas.width  = window.innerWidth;
    window.context.canvas.height = window.innerHeight;

    window.context.player.camera.perspective(window.context.canvas);

};


setTimeout(function() {
    var canvas = document.getElementById('canvas');
    canvas.width  = window.innerWidth;
    canvas.height = window.innerHeight;

    window.context = new Jax.Context('canvas');
//    window.context.fillStyle = "#000";

    window.context.redirectTo("teapot");

    maintainCanvasAspectRatio();

});


window.addEventListener('resize', maintainCanvasAspectRatio, false);
